<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Local Employment CART Analysis – Pathways taken after high school - Northeast</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6bd9cfa162949bde0a231f530c97869d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="site_libs/selectize-0.12.0/selectize.min.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Pathways taken after high school - Northeast</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Summary</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-prep-and-summaries" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-fa-gear" role="img">
</i> 
 <span class="menu-text">Data Prep and Summaries</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-prep-and-summaries">    
        <li>
    <a class="dropdown-item" href="./k12enrollment.html">
 <span class="dropdown-text">K12Enrollment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./k12orgs.html">
 <span class="dropdown-text">K12Orgs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./act.html">
 <span class="dropdown-text">ACT</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ap.html">
 <span class="dropdown-text">AP</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./cteenrollment.html">
 <span class="dropdown-text">CTEEnrollment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ctedemographics.html">
 <span class="dropdown-text">CTEDemographics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./assessments.html">
 <span class="dropdown-text">Assessments</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sat.html">
 <span class="dropdown-text">SAT</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./nscenrollment.html">
 <span class="dropdown-text">National Student Clearinghouse - Enrollment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./nsccompletions.html">
 <span class="dropdown-text">National Student Clearinghouse - Completions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./emp_states_each_year.html">
 <span class="dropdown-text">Employment states each year</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./unemployment.html">
 <span class="dropdown-text">Unemployment</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./avgwages.html">
 <span class="dropdown-text">Average wages</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-analysis" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-fa-gear" role="img">
</i> 
 <span class="menu-text">Analysis</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-analysis">    
        <li>
    <a class="dropdown-item" href="./analysis_categorizing_range_schools.html">
 <span class="dropdown-text">Categorizing range schools</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./analysis_mca.html">
 <span class="dropdown-text">Multiple Correspondence Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./analysis_dep_var_states.html">
 <span class="dropdown-text">Dependent Variable States</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./analysis_local_employment_ct.html">
 <span class="dropdown-text">Local Employment Cross-tabs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./analysis_local_employment_CART.html">
 <span class="dropdown-text">Local Employment CART Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./analysis_post_secondary_pathways.html">
 <span class="dropdown-text">Post-secondary pathways</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#methodology" id="toc-methodology" class="nav-link active" data-scroll-target="#methodology">Methodology</a>
  <ul class="collapse">
  <li><a href="#process" id="toc-process" class="nav-link" data-scroll-target="#process">Process</a></li>
  <li><a href="#how-to-interpret-a-decision-tree" id="toc-how-to-interpret-a-decision-tree" class="nav-link" data-scroll-target="#how-to-interpret-a-decision-tree">How to Interpret a Decision Tree</a>
  <ul class="collapse">
  <li><a href="#root-node-top-node" id="toc-root-node-top-node" class="nav-link" data-scroll-target="#root-node-top-node"><strong>1. Root Node (Top Node)</strong></a></li>
  <li><a href="#branches-edges" id="toc-branches-edges" class="nav-link" data-scroll-target="#branches-edges"><strong>2. Branches (Edges)</strong></a></li>
  <li><a href="#internal-nodes" id="toc-internal-nodes" class="nav-link" data-scroll-target="#internal-nodes"><strong>3. Internal Nodes</strong></a></li>
  <li><a href="#leaf-nodes-terminal-nodes" id="toc-leaf-nodes-terminal-nodes" class="nav-link" data-scroll-target="#leaf-nodes-terminal-nodes"><strong>4. Leaf Nodes (Terminal Nodes)</strong></a></li>
  <li><a href="#tips-for-interpreting" id="toc-tips-for-interpreting" class="nav-link" data-scroll-target="#tips-for-interpreting"><strong>Tips for Interpreting</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#meaningful-emp-in-mn-vs.-meaningful-emp-in-ne" id="toc-meaningful-emp-in-mn-vs.-meaningful-emp-in-ne" class="nav-link" data-scroll-target="#meaningful-emp-in-mn-vs.-meaningful-emp-in-ne">Meaningful emp in MN vs.&nbsp;meaningful emp in NE</a>
  <ul class="collapse">
  <li><a href="#one-year-after-graduation" id="toc-one-year-after-graduation" class="nav-link" data-scroll-target="#one-year-after-graduation">One year after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model" id="toc-base-model" class="nav-link" data-scroll-target="#base-model">Base model</a></li>
  <li><a href="#pre-pruning" id="toc-pre-pruning" class="nav-link" data-scroll-target="#pre-pruning">Pre-pruning</a></li>
  <li><a href="#post-pruning" id="toc-post-pruning" class="nav-link" data-scroll-target="#post-pruning">Post-pruning</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#five-years-after-graduation" id="toc-five-years-after-graduation" class="nav-link" data-scroll-target="#five-years-after-graduation">Five years after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-1" id="toc-base-model-1" class="nav-link" data-scroll-target="#base-model-1">Base model</a></li>
  <li><a href="#pre-pruning-1" id="toc-pre-pruning-1" class="nav-link" data-scroll-target="#pre-pruning-1">Pre-pruning</a></li>
  <li><a href="#post-pruning-1" id="toc-post-pruning-1" class="nav-link" data-scroll-target="#post-pruning-1">Post-pruning</a></li>
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">Summary</a></li>
  </ul></li>
  <li><a href="#ten-years-after-graduation" id="toc-ten-years-after-graduation" class="nav-link" data-scroll-target="#ten-years-after-graduation">Ten years after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-2" id="toc-base-model-2" class="nav-link" data-scroll-target="#base-model-2">Base model</a></li>
  <li><a href="#pre-pruning-2" id="toc-pre-pruning-2" class="nav-link" data-scroll-target="#pre-pruning-2">Pre-pruning</a></li>
  <li><a href="#post-pruning-2" id="toc-post-pruning-2" class="nav-link" data-scroll-target="#post-pruning-2">Post-pruning</a></li>
  <li><a href="#summary-2" id="toc-summary-2" class="nav-link" data-scroll-target="#summary-2">Summary</a></li>
  </ul></li>
  <li><a href="#important-variables-through-time" id="toc-important-variables-through-time" class="nav-link" data-scroll-target="#important-variables-through-time">Important variables through time</a></li>
  </ul></li>
  <li><a href="#not-meaningful-or-attending-post-secondary-vs-meaningful-emp-in-ne" id="toc-not-meaningful-or-attending-post-secondary-vs-meaningful-emp-in-ne" class="nav-link" data-scroll-target="#not-meaningful-or-attending-post-secondary-vs-meaningful-emp-in-ne">Not meaningful or attending post-secondary vs meaningful emp in NE</a>
  <ul class="collapse">
  <li><a href="#one-year-after-graduation-1" id="toc-one-year-after-graduation-1" class="nav-link" data-scroll-target="#one-year-after-graduation-1">One year after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-3" id="toc-base-model-3" class="nav-link" data-scroll-target="#base-model-3">Base model</a></li>
  <li><a href="#pre-pruning-3" id="toc-pre-pruning-3" class="nav-link" data-scroll-target="#pre-pruning-3">Pre-pruning</a></li>
  <li><a href="#post-pruning-3" id="toc-post-pruning-3" class="nav-link" data-scroll-target="#post-pruning-3">Post-pruning</a></li>
  <li><a href="#summary-3" id="toc-summary-3" class="nav-link" data-scroll-target="#summary-3">Summary</a></li>
  </ul></li>
  <li><a href="#five-year-after-graduation" id="toc-five-year-after-graduation" class="nav-link" data-scroll-target="#five-year-after-graduation">Five year after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-4" id="toc-base-model-4" class="nav-link" data-scroll-target="#base-model-4">Base model</a></li>
  <li><a href="#pre-pruning-4" id="toc-pre-pruning-4" class="nav-link" data-scroll-target="#pre-pruning-4">Pre-pruning</a></li>
  <li><a href="#post-pruning-4" id="toc-post-pruning-4" class="nav-link" data-scroll-target="#post-pruning-4">Post-pruning</a></li>
  <li><a href="#summary-4" id="toc-summary-4" class="nav-link" data-scroll-target="#summary-4">Summary</a></li>
  </ul></li>
  <li><a href="#ten-year-after-graduation" id="toc-ten-year-after-graduation" class="nav-link" data-scroll-target="#ten-year-after-graduation">Ten year after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-5" id="toc-base-model-5" class="nav-link" data-scroll-target="#base-model-5">Base model</a></li>
  <li><a href="#pre-pruning-5" id="toc-pre-pruning-5" class="nav-link" data-scroll-target="#pre-pruning-5">Pre-pruning</a></li>
  <li><a href="#post-pruning-5" id="toc-post-pruning-5" class="nav-link" data-scroll-target="#post-pruning-5">Post-pruning</a></li>
  <li><a href="#summary-5" id="toc-summary-5" class="nav-link" data-scroll-target="#summary-5">Summary</a></li>
  </ul></li>
  <li><a href="#important-variables-through-time-1" id="toc-important-variables-through-time-1" class="nav-link" data-scroll-target="#important-variables-through-time-1">Important variables through time</a></li>
  </ul></li>
  <li><a href="#no-mn-employment-record-vs-meaningful-emp-in-ne" id="toc-no-mn-employment-record-vs-meaningful-emp-in-ne" class="nav-link" data-scroll-target="#no-mn-employment-record-vs-meaningful-emp-in-ne">No MN employment record vs meaningful emp in NE</a>
  <ul class="collapse">
  <li><a href="#one-year-after-graduation-2" id="toc-one-year-after-graduation-2" class="nav-link" data-scroll-target="#one-year-after-graduation-2">One year after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-6" id="toc-base-model-6" class="nav-link" data-scroll-target="#base-model-6">Base model</a></li>
  <li><a href="#pre-pruning-6" id="toc-pre-pruning-6" class="nav-link" data-scroll-target="#pre-pruning-6">Pre-pruning</a></li>
  <li><a href="#post-pruning-6" id="toc-post-pruning-6" class="nav-link" data-scroll-target="#post-pruning-6">Post-pruning</a></li>
  <li><a href="#summary-6" id="toc-summary-6" class="nav-link" data-scroll-target="#summary-6">Summary</a></li>
  </ul></li>
  <li><a href="#five-year-after-graduation-1" id="toc-five-year-after-graduation-1" class="nav-link" data-scroll-target="#five-year-after-graduation-1">Five year after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-7" id="toc-base-model-7" class="nav-link" data-scroll-target="#base-model-7">Base model</a></li>
  <li><a href="#pre-pruning-7" id="toc-pre-pruning-7" class="nav-link" data-scroll-target="#pre-pruning-7">Pre-pruning</a></li>
  <li><a href="#post-pruning-7" id="toc-post-pruning-7" class="nav-link" data-scroll-target="#post-pruning-7">Post-pruning</a></li>
  <li><a href="#summary-7" id="toc-summary-7" class="nav-link" data-scroll-target="#summary-7">Summary</a></li>
  </ul></li>
  <li><a href="#ten-years-after-graduation-1" id="toc-ten-years-after-graduation-1" class="nav-link" data-scroll-target="#ten-years-after-graduation-1">Ten years after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-8" id="toc-base-model-8" class="nav-link" data-scroll-target="#base-model-8">Base model</a></li>
  <li><a href="#pre-pruning-8" id="toc-pre-pruning-8" class="nav-link" data-scroll-target="#pre-pruning-8">Pre-pruning</a></li>
  <li><a href="#post-pruning-8" id="toc-post-pruning-8" class="nav-link" data-scroll-target="#post-pruning-8">Post-pruning</a></li>
  <li><a href="#summary-8" id="toc-summary-8" class="nav-link" data-scroll-target="#summary-8">Summary</a></li>
  </ul></li>
  <li><a href="#important-variables-through-time-2" id="toc-important-variables-through-time-2" class="nav-link" data-scroll-target="#important-variables-through-time-2">Important variables through time</a></li>
  </ul></li>
  <li><a href="#meaningful-emp-in-ne" id="toc-meaningful-emp-in-ne" class="nav-link" data-scroll-target="#meaningful-emp-in-ne">Meaningful emp in NE</a>
  <ul class="collapse">
  <li><a href="#one-year-after-graduation-3" id="toc-one-year-after-graduation-3" class="nav-link" data-scroll-target="#one-year-after-graduation-3">One year after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-9" id="toc-base-model-9" class="nav-link" data-scroll-target="#base-model-9">Base model</a></li>
  <li><a href="#pre-pruning-9" id="toc-pre-pruning-9" class="nav-link" data-scroll-target="#pre-pruning-9">Pre-pruning</a></li>
  <li><a href="#post-pruning-9" id="toc-post-pruning-9" class="nav-link" data-scroll-target="#post-pruning-9">Post-pruning</a></li>
  <li><a href="#summary-9" id="toc-summary-9" class="nav-link" data-scroll-target="#summary-9">Summary</a></li>
  </ul></li>
  <li><a href="#five-years-after-graduation-1" id="toc-five-years-after-graduation-1" class="nav-link" data-scroll-target="#five-years-after-graduation-1">Five years after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-10" id="toc-base-model-10" class="nav-link" data-scroll-target="#base-model-10">Base model</a></li>
  <li><a href="#pre-pruning-10" id="toc-pre-pruning-10" class="nav-link" data-scroll-target="#pre-pruning-10">Pre-pruning</a></li>
  <li><a href="#post-pruning-10" id="toc-post-pruning-10" class="nav-link" data-scroll-target="#post-pruning-10">Post-pruning</a></li>
  <li><a href="#summary-10" id="toc-summary-10" class="nav-link" data-scroll-target="#summary-10">Summary</a></li>
  </ul></li>
  <li><a href="#ten-years-after-graduation-2" id="toc-ten-years-after-graduation-2" class="nav-link" data-scroll-target="#ten-years-after-graduation-2">Ten years after graduation</a>
  <ul class="collapse">
  <li><a href="#base-model-11" id="toc-base-model-11" class="nav-link" data-scroll-target="#base-model-11">Base model</a></li>
  <li><a href="#pre-pruning-11" id="toc-pre-pruning-11" class="nav-link" data-scroll-target="#pre-pruning-11">Pre-pruning</a></li>
  <li><a href="#post-pruning-11" id="toc-post-pruning-11" class="nav-link" data-scroll-target="#post-pruning-11">Post-pruning</a></li>
  <li><a href="#summary-11" id="toc-summary-11" class="nav-link" data-scroll-target="#summary-11">Summary</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#summary-across-time" id="toc-summary-across-time" class="nav-link" data-scroll-target="#summary-across-time">Summary across time</a>
  <ul class="collapse">
  <li><a href="#one-year-after-graduating-high-school" id="toc-one-year-after-graduating-high-school" class="nav-link" data-scroll-target="#one-year-after-graduating-high-school">One year after graduating high school</a></li>
  <li><a href="#five-year-after-graduating-high-school" id="toc-five-year-after-graduating-high-school" class="nav-link" data-scroll-target="#five-year-after-graduating-high-school">Five year after graduating high school</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Local Employment CART Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 2%">
<col style="width: 7%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">PersonID</th>
<th style="text-align: left;">grad.year.covid</th>
<th style="text-align: right;">economic.status</th>
<th style="text-align: left;">range.school</th>
<th style="text-align: right;">pseo.participant</th>
<th style="text-align: right;">SpecialEdStatus</th>
<th style="text-align: left;">RaceEthnicity</th>
<th style="text-align: left;">Dem_Desc</th>
<th style="text-align: left;">took.ACT</th>
<th style="text-align: left;">cte.achievement</th>
<th style="text-align: right;">english.learner</th>
<th style="text-align: left;">ps.grad</th>
<th style="text-align: left;">ps.grad.InstitutionSector</th>
<th style="text-align: left;">highest.cred.level</th>
<th style="text-align: left;">ps.grad.location</th>
<th style="text-align: right;">ACTCompositeScore</th>
<th style="text-align: right;">MCA.M</th>
<th style="text-align: right;">MCA.R</th>
<th style="text-align: right;">MCA.S</th>
<th style="text-align: right;">total.cte.courses.taken</th>
<th style="text-align: left;">grad.year.1</th>
<th style="text-align: left;">grad.year.5</th>
<th style="text-align: left;">grad.year.10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6140596</td>
<td style="text-align: left;">Pre-covid grad</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Range school</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Urban/town/rural mix</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">CTE Concentrator or Completor</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">Attending ps</td>
<td style="text-align: left;">Not meaningful, not attending ps</td>
<td style="text-align: left;">After 2023</td>
</tr>
<tr class="even">
<td style="text-align: right;">1986818</td>
<td style="text-align: left;">Post-covid grad</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Non-range school</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Urban/town/rural mix</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CTE Concentrator or Completor</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Never attended ps</td>
<td style="text-align: left;">No college</td>
<td style="text-align: left;">Never attended ps</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">Not meaningful, not attending ps</td>
<td style="text-align: left;">After 2023</td>
<td style="text-align: left;">After 2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11614284</td>
<td style="text-align: left;">Post-covid grad</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Non-range school</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Town/rural mix</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">CTE Participant</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Attending ps</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">After 2023</td>
<td style="text-align: left;">After 2023</td>
<td style="text-align: left;">After 2023</td>
</tr>
<tr class="even">
<td style="text-align: right;">8332752</td>
<td style="text-align: left;">Pre-covid grad</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Non-range school</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Urban/town/rural mix</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">CTE Participant</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Master degree or higher</td>
<td style="text-align: left;">In MN</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">Attending ps</td>
<td style="text-align: left;">Attending ps</td>
<td style="text-align: left;">After 2023</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6569729</td>
<td style="text-align: left;">Pre-covid grad</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Non-range school</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Entirely rural</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No CTE</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Attending ps</td>
<td style="text-align: left;">Meaningful emp MN</td>
<td style="text-align: left;">Meaningful emp MN</td>
</tr>
<tr class="even">
<td style="text-align: right;">357415</td>
<td style="text-align: left;">Pre-covid grad</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Non-range school</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">White</td>
<td style="text-align: left;">Urban/town/rural mix</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No CTE</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Associate degree</td>
<td style="text-align: left;">In region</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Attending ps</td>
<td style="text-align: left;">After 2023</td>
<td style="text-align: left;">After 2023</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PersonID</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="odd">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="even">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="even">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="even">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="odd">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="even">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="even">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grad.year.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grad.year.10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>We will use a tree-based method for classification - CART analysis. This type of analysis involves stratifying and/or segmenting the predictor space into a number of simple regions. Essentially, it’s another way to see which independent variables play a role in if an individual has meaningful employment in the local region X. We will be using the independent variables that were identified as being important in the multiple correspondence analysis.</p>
<p>There are a number of states at which we categorize individuals in the dataset;</p>
<ol type="1">
<li>Has meaningful employment in the Northeast region.</li>
<li>Has meaningful employment in Minnesota, but not in Northeast Minnesota.</li>
<li>Is attending post-secondary.</li>
<li>Has a MN employment record but it’s not meaningful, and not attending post-secondary.</li>
<li>Does not have a MN employment record and is not attending post-secondary.</li>
</ol>
<p>There are three “times” in which we checked to see if the individual had meaningful employment within these geographies;</p>
<ol type="1">
<li>one year after graduating high school</li>
<li>five years after graduation, and</li>
<li>ten years after graduation.</li>
</ol>
<p>Meaningful employment is determined by whether an individual worked 1,000 hours for an employer during time X. In addition, if the individual is working for an employer but not meaningful at time X but worked 1,000 hours for that employer during another year it’s still considered “meaningful”.</p>
<p>Due to time x potentially being passed the date of the latest data (2023) for some individuals, the analysis below will filter out all individuals where time x is after 2023.</p>
<p>The primary independent variables that the cross tables indicated as important are;</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$grad.year.covid
[1] "factor"

$economic.status
[1] "factor"

$range.school
[1] "factor"

$pseo.participant
[1] "factor"

$SpecialEdStatus
[1] "factor"

$RaceEthnicity
[1] "factor"

$Dem_Desc
[1] "factor"

$took.ACT
[1] "factor"

$cte.achievement
[1] "factor"

$english.learner
[1] "factor"

$ps.grad
[1] "factor"

$ps.grad.InstitutionSector
[1] "factor"

$highest.cred.level
[1] "factor"

$ps.grad.location
[1] "factor"

$ACTCompositeScore
[1] "numeric"

$MCA.M
[1] "numeric"

$MCA.R
[1] "numeric"

$MCA.S
[1] "numeric"

$total.cte.courses.taken
[1] "numeric"</code></pre>
</div>
</div>
<p><br></p>
<section id="methodology" class="level1">
<h1>Methodology</h1>
<p>We are going to use CART/Decision Trees to see which independent variables are important. One limitation of this method is that the dependent variable must be binary. So, how do we do this.</p>
<p>First, I would like to see what variables maybe playing a role in whether an individual has meaningful employment in the region at three times after graduating high school;</p>
<ol type="1">
<li>one year after graduating high school</li>
<li>five years after graduating high school</li>
<li>ten years after graduating high school.</li>
</ol>
<p>So the question is how to figure out the other side of the binary. If I throw the remaining categories into the other binary category, I may end up with a pretty muddy picture. For example, the variables that may play a role in whether someone has meaningful employment in MN vs.&nbsp;not having a MN employment record may be very different, yet they would be in the same group. This would make the decision tree hard to interpret.</p>
<p>To get around this, it might be best to analyze everything a few different ways;</p>
<ul>
<li>Meaningful employment in the region vs.
<ol type="1">
<li>meaningful employment in MN</li>
<li>not meaningful and not attending post-secondary</li>
<li>no MN employment record.</li>
</ol></li>
<li>Meaningful employment in the region vs.&nbsp;all other categories aggregated</li>
</ul>
<p><br></p>
<section id="process" class="level2">
<h2 class="anchored" data-anchor-id="process">Process</h2>
<p>I’m using a three step process to try and figure out which variables are most important.</p>
<ol type="1">
<li>Create a base model that let’s the decision tree full grow.</li>
<li>Create a pre-pruned model that will place parameters on it in order to get a simpler tree. The parameters will be the following;
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n</li>
<li>minbucket: round(minsplit / 3)</li>
<li>If these parameters provide a tree with no splits, then I will use maxdepth = 6, eliminate the minbucket parameter, and reduce the minsplit until I get the highest accuracy possible.</li>
</ul></li>
<li>Create a post-pruned model, which will use cp in order to get a simpler decision tree. I use either of the following to identify the cp value;
<ul>
<li>cp with the lowest xerror, if this has a lot of nsplits and creates an overly complicated tree, then I will use the cp with the next lowest xerror that is within the standard error the of cp with the lowest xerror.</li>
</ul></li>
</ol>
<p><br></p>
</section>
<section id="how-to-interpret-a-decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="how-to-interpret-a-decision-tree">How to Interpret a Decision Tree</h2>
<p>Each <strong>node</strong> and <strong>branch</strong> in a decision tree represents a <strong>decision rule</strong> based on the data. Here’s how to read it from <strong>top (root) to bottom (leaves)</strong>:</p>
<section id="root-node-top-node" class="level3">
<h3 class="anchored" data-anchor-id="root-node-top-node"><strong>1. Root Node (Top Node)</strong></h3>
<p>This is where the first and most important split happens. The variable here has the <strong>highest information gain</strong> (i.e., it reduces uncertainty the most).</p>
<p>Example: <code>ps.grad.location = In region, Inside and outside region</code></p>
<p>This is the first key factor that separates groups with different employment outcomes.</p>
</section>
<section id="branches-edges" class="level3">
<h3 class="anchored" data-anchor-id="branches-edges"><strong>2. Branches (Edges)</strong></h3>
<p>Represent decision outcomes (e.g., <code>Yes</code>, <code>No</code>, or thresholds like <code>ACTCompositeScore &gt; 19.5</code>). They <strong>funnel observations</strong> down different paths based on their attribute values.</p>
</section>
<section id="internal-nodes" class="level3">
<h3 class="anchored" data-anchor-id="internal-nodes"><strong>3. Internal Nodes</strong></h3>
<p>Each of these applies a <strong>new decision rule</strong>, further narrowing the group. The tree uses variables in order of importance — high up = more impact.</p>
</section>
<section id="leaf-nodes-terminal-nodes" class="level3">
<h3 class="anchored" data-anchor-id="leaf-nodes-terminal-nodes"><strong>4. Leaf Nodes (Terminal Nodes)</strong></h3>
<p>Each leaf shows:</p>
<ul>
<li>The <strong>predicted class or outcome</strong></li>
<li>A <strong>probability</strong>: how certain the model is about that prediction</li>
<li>A <strong>proportion</strong> or count: how many cases fall into that node</li>
</ul>
<p>Example:</p>
<ul>
<li>Prediction: No meaningful emp NE</li>
<li>Probability: 0.84 (i.e., 84% chance)</li>
<li>Coverage: 77% of the population</li>
</ul>
</section>
<section id="tips-for-interpreting" class="level3">
<h3 class="anchored" data-anchor-id="tips-for-interpreting"><strong>Tips for Interpreting</strong></h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Element</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Top splits</strong></td>
<td>Most important predictors</td>
</tr>
<tr class="even">
<td><strong>Deeper paths</strong></td>
<td>More nuanced subgroups</td>
</tr>
<tr class="odd">
<td><strong>High-probability leaf</strong></td>
<td>Strong prediction confidence</td>
</tr>
<tr class="even">
<td><strong>Wide node coverage</strong></td>
<td>Large segment of data affected</td>
</tr>
</tbody>
</table>
<p>Putting It All Together</p>
<p>A path through the tree represents a <strong>rule</strong>:</p>
<p><em>If</em> <code>ps.grad.location</code> = “In region” AND <code>MCA.M</code> &lt; 3 AND <code>cte.achievement</code> = “Concentrator”<br>
</p>
<p><em>Then</em> predict “No meaningful emp NE” with 84% certainty.</p>
<p>This is what makes decision trees interpretable: each path is a <strong>clear if–then statement</strong>.</p>
<p><br></p>
</section>
</section>
</section>
<section id="meaningful-emp-in-mn-vs.-meaningful-emp-in-ne" class="level1">
<h1>Meaningful emp in MN vs.&nbsp;meaningful emp in NE</h1>
<p>This section will examine which variables seem to play a role in whether an individual has meaningful employment in the region, or in Minnesota.</p>
<p><br></p>
<section id="one-year-after-graduation" class="level2">
<h2 class="anchored" data-anchor-id="one-year-after-graduation">One year after graduation</h2>
<p>It probably doesn’t make sense to have a dataset with a bunch of post-secondary variables in it when exploring which variables make a difference in whether someone has meaningful workforce participation in the region one year after graduating high school. So I’m going to only include the variable ps.grad in the dataset.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="even">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grad.year.1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 5,308 individuals.The table below shows that a large majority of individuals have meaningful employment in the region - 79% compared to individuals with meaningful employment in MN, but not in the region.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-164a3f687a7e4b604ff3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-164a3f687a7e4b604ff3">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","Meaningful emp MN"],[4172,1136],["78.6%","21.4%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.1<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.1","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model" class="level3">
<h3 class="anchored" data-anchor-id="base-model">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(meaningful.emp.mn.grad.year<span class="fl">.1</span>), <span class="fu">nrow</span>(meaningful.emp.mn.grad.year<span class="fl">.1</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year<span class="fl">.1</span>[sample_ind,]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year<span class="fl">.1</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is 1.0410 and the nsplit is 2.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp MN grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore       cte.achievement         Dem_Desc               
 [4] economic.status         grad.year.covid         MCA.M                  
 [7] MCA.R                   MCA.S                   ps.grad                
[10] pseo.participant        RaceEthnicity           range.school           
[13] SpecialEdStatus         took.ACT                total.cte.courses.taken

Root node error: 805/3715 = 0.21669

n= 3715 

          CP nsplit rel error xerror     xstd
1 0.00186335      0   1.00000 1.0000 0.031194
2 0.00139752      2   0.99627 1.0410 0.031646
3 0.00124224     17   0.97143 1.0534 0.031779
4 0.00093168     26   0.96025 1.0646 0.031897
5 0.00082816     31   0.95528 1.0770 0.032026
6 0.00062112     34   0.95280 1.0882 0.032141
7 0.00041408     73   0.92422 1.1168 0.032428
8 0.00031056     85   0.91925 1.1677 0.032917
9 0.00000000     89   0.91801 1.1839 0.033066</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp MN grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>total.cte.courses.taken         cte.achievement           RaceEthnicity 
              32.371268               22.861325               19.163645 
      ACTCompositeScore                   MCA.R                Dem_Desc 
              16.944750               15.896150               13.540177 
                  MCA.S         economic.status                   MCA.M 
              10.935987               10.662975                9.539256 
                ps.grad        pseo.participant         SpecialEdStatus 
               9.413645                8.088472                7.880574 
               took.ACT         grad.year.covid            range.school 
               7.662680                6.657893                3.258216 
        english.learner 
               2.791154 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance meaningful emp MN grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7445072</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 265</li>
<li>minbucket: round(minsplit / 3) which is 89</li>
</ul>
<p>Unfortunately, these parameters produced a tree with zero splits. So the new parameters are the following;</p>
<ul>
<li>maxdepth: 6</li>
<li>minsplit:</li>
<li>minbuck: eliminated</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.1</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">50</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7878217</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .7878217 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp MN grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 50))

Variables actually used in tree construction:
[1] ACTCompositeScore       Dem_Desc                MCA.S                  
[4] ps.grad                 total.cte.courses.taken

Root node error: 805/3715 = 0.21669

n= 3715 

          CP nsplit rel error xerror     xstd
1 0.00186335      0   1.00000 1.0000 0.031194
2 0.00031056      2   0.99627 1.0087 0.031291
3 0.00000000      6   0.99503 1.0186 0.031402</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>Dem_Desc
<ul>
<li>Town/rural mix | Urban/town/rural mix: 33% probability that they have meaningful employment in the region
<ul>
<li>Meaningful emp in region: 30% probability if the have taken less than 9 total CTE courses</li>
<li>Meaningful emp in MN: 59% probability if they have taken more than 9 total CTE courses</li>
</ul></li>
<li>Entirely rural
<ul>
<li>Meaningful emp in region:
<ul>
<li>lower ACTCompositeScore</li>
<li>lower MCA.S score</li>
<li>ps.grad - attending post-secondary | never graduated from college</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ACTCompositeScore</li>
<li>Dem_Desc</li>
<li>total.cte.courses.taken</li>
<li>MCA.S</li>
<li>ps.grad</li>
</ul></li>
<li>Not as important
<ul>
<li>RaceEthnicity</li>
<li>MCA.M</li>
<li>cte.achievement</li>
<li>economic.status</li>
<li>grad.year.covid</li>
</ul></li>
<li>Missing
<ul>
<li>range.school</li>
<li>pseo.participant</li>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>english.learner</li>
<li>MCA.R</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ACTCompositeScore                Dem_Desc total.cte.courses.taken 
             4.81847835              4.61671130              2.65666794 
                  MCA.S                 ps.grad           RaceEthnicity 
             2.03904272              1.24104975              0.21808330 
                  MCA.M         cte.achievement         economic.status 
             0.16992023              0.10791737              0.10791737 
        grad.year.covid 
             0.05395868 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance meaningful emp MN grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model, <span class="at">cp =</span> .<span class="dv">00139752</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 3715 

           CP nsplit rel error   xerror       xstd
1 0.001863354      0 1.0000000 1.000000 0.03119386
2 0.001397520      2 0.9962733 1.040994 0.03164584

Variable importance
               Dem_Desc total.cte.courses.taken 
                     63                      37 

Node number 1: 3715 observations,    complexity param=0.001863354
  predicted class=Meaningful emp NE  expected loss=0.2166891  P(node) =1
    class counts:  2910   805
   probabilities: 0.783 0.217 
  left son=2 (3542 obs) right son=3 (173 obs)
  Primary splits:
      Dem_Desc                splits as  RLL,      improve=4.616711, (0 missing)
      total.cte.courses.taken &lt; 11.5 to the left,  improve=3.843278, (0 missing)
      ACTCompositeScore       &lt; 23.5 to the left,  improve=3.583423, (1953 missing)
      range.school            splits as  RL,       improve=3.576390, (0 missing)
      MCA.R                   &lt; 3.5  to the left,  improve=2.229432, (98 missing)

Node number 2: 3542 observations
  predicted class=Meaningful emp NE  expected loss=0.2111801  P(node) =0.953432
    class counts:  2794   748
   probabilities: 0.789 0.211 

Node number 3: 173 observations,    complexity param=0.001863354
  predicted class=Meaningful emp NE  expected loss=0.3294798  P(node) =0.04656797
    class counts:   116    57
   probabilities: 0.671 0.329 
  left son=6 (154 obs) right son=7 (19 obs)
  Primary splits:
      total.cte.courses.taken &lt; 8.5  to the left,  improve=2.6566680, (0 missing)
      pseo.participant        splits as  LR,       improve=1.4451130, (40 missing)
      MCA.R                   &lt; 1.5  to the left,  improve=1.2728280, (3 missing)
      RaceEthnicity           splits as  LLLRRR,   improve=1.0610490, (0 missing)
      ACTCompositeScore       &lt; 18.5 to the right, improve=0.9069979, (81 missing)

Node number 6: 154 observations
  predicted class=Meaningful emp NE  expected loss=0.2987013  P(node) =0.04145357
    class counts:   108    46
   probabilities: 0.701 0.299 

Node number 7: 19 observations
  predicted class=Meaningful emp MN  expected loss=0.4210526  P(node) =0.005114401
    class counts:     8    11
   probabilities: 0.421 0.579 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp MN grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
[1] Dem_Desc                total.cte.courses.taken

Root node error: 805/3715 = 0.21669

n= 3715 

         CP nsplit rel error xerror     xstd
1 0.0018634      0   1.00000  1.000 0.031194
2 0.0013975      2   0.99627  1.041 0.031646</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp MN grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7928437</code></pre>
</div>
</div>
<p><br></p>
<p>We now have a very simple tree, that might be a little too simple.</p>
<p>The tree nodes provide the following;</p>
<ul>
<li>Dem_Desc: Town/rural mix | Urban/town/rural mix
<ul>
<li>Yes: 22% probability that the individual will have meaningful employment in the region</li>
<li>Entirely rural:
<ul>
<li>Meaningful emp in region: Less than 9 CTE courses</li>
<li>Meaningful emp in MN: More than 9 CTE courses</li>
</ul></li>
</ul></li>
</ul>
<p>It tells me the following;</p>
<ul>
<li>Most important
<ul>
<li>Dem_Desc</li>
<li>total.cte.coures.taken</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Dem_Desc total.cte.courses.taken 
               4.616711                2.656668 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance meaningful emp MN grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The post-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.7445072        0.7878217         0.7928437</code></pre>
</div>
</div>
</section>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>The pre- and post-pruned trees provided better accuracy than the base model so let’s use the most important variables from both.</p>
<ul>
<li>Most important
<ul>
<li>ACTCompositeScore</li>
<li>Dem_Desc</li>
<li>total.cte.courses.taken</li>
<li>MCA.S</li>
<li>ps.grad</li>
</ul></li>
<li>Not as important
<ul>
<li>RaceEthnicity</li>
<li>MCA.M</li>
<li>cte.achievement</li>
<li>economic.status</li>
<li>grad.year.covid</li>
</ul></li>
<li>Missing
<ul>
<li>range.school</li>
<li>pseo.participant</li>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>english.learner</li>
<li>MCA.R</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="five-years-after-graduation" class="level2">
<h2 class="anchored" data-anchor-id="five-years-after-graduation">Five years after graduation</h2>
<p>We are now five years away from graduating high school, so including all of the post-secondary variables makes sense.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="even">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="even">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="even">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="odd">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="even">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="even">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grad.year.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 8,554 individuals.The table below shows that a large majority of individuals continue to have meaningful employment in the region - 64% compared to individuals with meaningful employment in MN, but not in the region.</p>
<p><br></p>
<p><br></p>
<section id="base-model-1" class="level3">
<h3 class="anchored" data-anchor-id="base-model-1">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(meaningful.emp.mn.grad.year<span class="fl">.5</span>), <span class="fu">nrow</span>(meaningful.emp.mn.grad.year<span class="fl">.5</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year<span class="fl">.5</span>[sample_ind,]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year<span class="fl">.5</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is .82700 and the nsplit is 10.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp MN grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] english.learner           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 2104/5987 = 0.35143

n= 5987 

           CP nsplit rel error  xerror     xstd
1  1.6112e-01      0   1.00000 1.00000 0.017557
2  5.9411e-03      1   0.83888 0.84791 0.016820
3  2.8517e-03      3   0.82700 0.83317 0.016735
4  2.3764e-03     10   0.79943 0.82700 0.016698
5  1.7427e-03     12   0.79468 0.82985 0.016715
6  1.4259e-03     17   0.78565 0.82795 0.016704
7  1.2674e-03     21   0.77994 0.82842 0.016707
8  1.1882e-03     26   0.77281 0.83413 0.016740
9  1.1090e-03     30   0.76663 0.83603 0.016751
10 1.0694e-03     33   0.76331 0.83603 0.016751
11 9.5057e-04     37   0.75903 0.84886 0.016825
12 7.1293e-04     44   0.75190 0.85979 0.016887
13 6.6540e-04     65   0.73574 0.89021 0.017051
14 6.3371e-04     76   0.72624 0.89449 0.017073
15 5.9411e-04     85   0.71958 0.89734 0.017088
16 5.7034e-04     98   0.71103 0.89734 0.017088
17 4.7529e-04    117   0.69867 0.91397 0.017172
18 4.0739e-04    145   0.68394 0.91825 0.017193
19 3.9607e-04    152   0.68108 0.91778 0.017191
20 3.5646e-04    158   0.67871 0.91730 0.017188
21 3.1686e-04    167   0.67490 0.92490 0.017225
22 2.3764e-04    170   0.67395 0.93298 0.017264
23 1.5843e-04    197   0.66730 0.94772 0.017333
24 9.5057e-05    200   0.66683 0.95010 0.017343
25 6.7898e-05    220   0.66445 0.95105 0.017348
26 5.9411e-05    227   0.66397 0.95485 0.017365
27 0.0000e+00    235   0.66350 0.95532 0.017367</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp MN grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector   total.cte.courses.taken 
               280.938265                 86.299312                 85.779084 
        ACTCompositeScore        highest.cred.level           cte.achievement 
                73.709631                 72.099639                 56.238277 
                    MCA.M                     MCA.R                  Dem_Desc 
                49.342138                 47.315646                 38.235947 
                    MCA.S              range.school           economic.status 
                26.852953                 23.127969                 22.548144 
            RaceEthnicity                  took.ACT           SpecialEdStatus 
                19.991499                 19.762647                 18.276104 
                  ps.grad          pseo.participant           english.learner 
                13.720027                 13.188223                  5.457592 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance meaningful emp MN grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6423841</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-1" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-1">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 428</li>
<li>minbucket: round(minsplit / 3) which is 143</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.5</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">428</span>, <span class="at">minbucket =</span> <span class="dv">143</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6801714</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .6801714 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp MN grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 428, 
        minbucket = 143))

Variables actually used in tree construction:
[1] Dem_Desc                  MCA.M                    
[3] ps.grad.InstitutionSector ps.grad.location         

Root node error: 2104/5987 = 0.35143

n= 5987 

         CP nsplit rel error  xerror     xstd
1 0.1611217      0   1.00000 1.00000 0.017557
2 0.0028517      1   0.83888 0.83888 0.016768
3 0.0000000      5   0.82700 0.85789 0.016876</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location: in region | Inside and outside region | Never attended ps | Outside region
<ul>
<li>In Minnesota: Meaningful emp in MN</li>
<li>Yes
<ul>
<li>Meaningful emp in region
<ul>
<li>ps.grad.InstitutionSector = 4</li>
<li>MCA.M &lt; 3</li>
<li>Town/rural mix | urban/town/rural mix</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>MCA.M</li>
<li>Dem_Desc</li>
</ul></li>
<li>Not as important
<ul>
<li>MCA.R</li>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>english.learner</li>
<li>MCA.S</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>Missing
<ul>
<li>economic.status</li>
<li>range.school</li>
<li>pseo.participant</li>
<li>RaceEthnicity</li>
<li>cte.achievement</li>
<li>ps.grad</li>
<li>ACTCompositeScore</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
             260.04934168               47.58615786               36.80012018 
                    MCA.M                  Dem_Desc                     MCA.R 
              19.49245600               10.09393151                7.26383129 
          SpecialEdStatus                  took.ACT           english.learner 
               3.14530947                2.93374157                0.98731687 
                    MCA.S   total.cte.courses.taken 
               0.29619506                0.03323096 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance meaningful emp MN grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-1" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-1">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 5987 

           CP nsplit rel error    xerror       xstd
1 0.161121673      0 1.0000000 1.0000000 0.01755724
2 0.005941065      1 0.8388783 0.8479087 0.01682003
3 0.002851711      3 0.8269962 0.8331749 0.01673463
4 0.002376426     10 0.7994297 0.8269962 0.01669804

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       57                        13                        13 
                    MCA.M                  Dem_Desc                     MCA.R 
                        5                         3                         2 
        ACTCompositeScore           cte.achievement                  took.ACT 
                        2                         2                         1 
  total.cte.courses.taken           SpecialEdStatus 
                        1                         1 

Node number 1: 5987 observations,    complexity param=0.1611217
  predicted class=Meaningful emp NE  expected loss=0.3514281  P(node) =1
    class counts:  3883  2104
   probabilities: 0.649 0.351 
  left son=2 (5234 obs) right son=3 (753 obs)
  Primary splits:
      ps.grad.location          splits as  RLRLLL,   improve=233.34000, (1501 missing)
      ps.grad.InstitutionSector splits as  RLRRLL,   improve=140.23560, (1501 missing)
      highest.cred.level        splits as  LRLRL,    improve=105.17190, (1501 missing)
      ACTCompositeScore         &lt; 25.5 to the left,  improve= 68.98453, (2241 missing)
      took.ACT                  splits as  LR,       improve= 54.54398, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  LLRRLL, agree=0.84, adj=0.044, (0 split)

Node number 2: 5234 observations,    complexity param=0.002851711
  predicted class=Meaningful emp NE  expected loss=0.2976691  P(node) =0.8742275
    class counts:  3676  1558
   probabilities: 0.702 0.298 
  left son=4 (1118 obs) right son=5 (4116 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RRRRLR,   improve=37.05252, (1501 missing)
      highest.cred.level        splits as  LRLRR,    improve=34.60694, (1501 missing)
      ps.grad.location          splits as  -L-RRR,   improve=25.54629, (1501 missing)
      ACTCompositeScore         &lt; 25.5 to the left,  improve=18.40502, (2125 missing)
      took.ACT                  splits as  LR,       improve=17.65120, (0 missing)
  Surrogate splits:
      highest.cred.level      splits as  LRLRR,    agree=0.996, adj=0.987, (0 split)
      ps.grad.location        splits as  -L-RRR,   agree=0.812, adj=0.372, (0 split)
      total.cte.courses.taken &lt; 13.5 to the right, agree=0.702, adj=0.001, (1501 split)

Node number 3: 753 observations,    complexity param=0.005941065
  predicted class=Meaningful emp MN  expected loss=0.2749004  P(node) =0.1257725
    class counts:   207   546
   probabilities: 0.275 0.725 
  left son=6 (140 obs) right son=7 (613 obs)
  Primary splits:
      highest.cred.level        splits as  RRLR-,    improve=22.13269, (0 missing)
      ps.grad.InstitutionSector splits as  RRLRL-,   improve=21.32314, (0 missing)
      MCA.R                     &lt; 3.5  to the left,  improve=18.68085, (8 missing)
      ACTCompositeScore         &lt; 21.5 to the left,  improve=15.70136, (116 missing)
      total.cte.courses.taken   &lt; 3.5  to the right, improve=11.32951, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RRLRL-,   agree=0.880, adj=0.357, (0 split)
      took.ACT                  splits as  LR,       agree=0.833, adj=0.100, (0 split)
      total.cte.courses.taken   &lt; 7.5  to the right, agree=0.826, adj=0.064, (0 split)
      MCA.R                     &lt; 2.5  to the left,  agree=0.815, adj=0.007, (0 split)

Node number 4: 1118 observations
  predicted class=Meaningful emp NE  expected loss=0.186941  P(node) =0.1867379
    class counts:   909   209
   probabilities: 0.813 0.187 

Node number 5: 4116 observations,    complexity param=0.002851711
  predicted class=Meaningful emp NE  expected loss=0.3277454  P(node) =0.6874896
    class counts:  2767  1349
   probabilities: 0.672 0.328 
  left son=10 (1420 obs) right son=11 (2696 obs)
  Primary splits:
      MCA.M            &lt; 2.5  to the left,  improve=19.49246, (75 missing)
      took.ACT         splits as  LR,       improve=18.91602, (0 missing)
      ps.grad.location splits as  -L-LLR,   improve=18.71552, (1498 missing)
      MCA.R            &lt; 3.5  to the left,  improve=15.35320, (111 missing)
      Dem_Desc         splits as  RRL,      improve=14.66697, (0 missing)
  Surrogate splits:
      MCA.R           &lt; 2.5  to the left,  agree=0.785, adj=0.373, (28 split)
      SpecialEdStatus splits as  RL,       agree=0.713, adj=0.161, (47 split)
      took.ACT        splits as  LR,       agree=0.709, adj=0.151, (0 split)
      english.learner splits as  RL,       agree=0.675, adj=0.051, (0 split)
      MCA.S           &lt; 1.5  to the left,  agree=0.663, adj=0.015, (0 split)

Node number 6: 140 observations,    complexity param=0.005941065
  predicted class=Meaningful emp NE  expected loss=0.4714286  P(node) =0.023384
    class counts:    74    66
   probabilities: 0.529 0.471 
  left son=12 (105 obs) right son=13 (35 obs)
  Primary splits:
      ACTCompositeScore         &lt; 21.5 to the left,  improve=5.926407, (65 missing)
      ps.grad.InstitutionSector splits as  R-LRL-,   improve=5.663466, (0 missing)
      MCA.R                     &lt; 3.5  to the left,  improve=3.329187, (1 missing)
      total.cte.courses.taken   &lt; 3.5  to the right, improve=1.925817, (0 missing)
      cte.achievement           splits as  LLR,      improve=1.839456, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  R-LRL-,   agree=0.853, adj=0.667, (65 split)
      MCA.R                     &lt; 3.5  to the left,  agree=0.747, adj=0.424, (0 split)
      cte.achievement           splits as  LLR,      agree=0.720, adj=0.364, (0 split)
      total.cte.courses.taken   &lt; 1.5  to the right, agree=0.707, adj=0.333, (0 split)
      MCA.M                     &lt; 3.5  to the left,  agree=0.680, adj=0.273, (0 split)

Node number 7: 613 observations
  predicted class=Meaningful emp MN  expected loss=0.2169657  P(node) =0.1023885
    class counts:   133   480
   probabilities: 0.217 0.783 

Node number 10: 1420 observations
  predicted class=Meaningful emp NE  expected loss=0.2591549  P(node) =0.2371806
    class counts:  1052   368
   probabilities: 0.741 0.259 

Node number 11: 2696 observations,    complexity param=0.002851711
  predicted class=Meaningful emp NE  expected loss=0.3638724  P(node) =0.450309
    class counts:  1715   981
   probabilities: 0.636 0.364 
  left son=22 (2486 obs) right son=23 (210 obs)
  Primary splits:
      ps.grad.location  splits as  -L-LLR,   improve=12.918470, (919 missing)
      Dem_Desc          splits as  RLL,      improve= 9.930507, (0 missing)
      ACTCompositeScore &lt; 25.5 to the left,  improve= 8.792800, (708 missing)
      took.ACT          splits as  LR,       improve= 8.326754, (0 missing)
      pseo.participant  splits as  LR,       improve= 6.817412, (428 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  LLRL-L, agree=0.885, adj=0.024, (0 split)
      highest.cred.level        splits as  LLRLL,  agree=0.884, adj=0.019, (0 split)

Node number 12: 105 observations
  predicted class=Meaningful emp NE  expected loss=0.3809524  P(node) =0.017538
    class counts:    65    40
   probabilities: 0.619 0.381 

Node number 13: 35 observations
  predicted class=Meaningful emp MN  expected loss=0.2571429  P(node) =0.005846
    class counts:     9    26
   probabilities: 0.257 0.743 

Node number 22: 2486 observations,    complexity param=0.002851711
  predicted class=Meaningful emp NE  expected loss=0.348753  P(node) =0.415233
    class counts:  1619   867
   probabilities: 0.651 0.349 
  left son=44 (2329 obs) right son=45 (157 obs)
  Primary splits:
      Dem_Desc                splits as  RLL,      improve=10.093930, (0 missing)
      ACTCompositeScore       &lt; 27.5 to the left,  improve= 7.038762, (702 missing)
      took.ACT                splits as  LR,       improve= 5.383636, (0 missing)
      pseo.participant        splits as  LR,       improve= 5.251776, (391 missing)
      total.cte.courses.taken &lt; 1.5  to the right, improve= 4.912416, (0 missing)

Node number 23: 210 observations,    complexity param=0.002851711
  predicted class=Meaningful emp MN  expected loss=0.4571429  P(node) =0.035076
    class counts:    96   114
   probabilities: 0.457 0.543 
  left son=46 (141 obs) right son=47 (69 obs)
  Primary splits:
      ACTCompositeScore &lt; 25.5 to the left,  improve=2.5297740, (6 missing)
      MCA.S             &lt; 2.5  to the left,  improve=2.4840430, (24 missing)
      Dem_Desc          splits as  RRL,      improve=2.0650490, (0 missing)
      MCA.M             &lt; 3.5  to the left,  improve=2.0508310, (0 missing)
      pseo.participant  splits as  RL,       improve=0.8187173, (37 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  LLLR--, agree=0.706, adj=0.104, (6 split)
      RaceEthnicity             splits as  RLLR-L, agree=0.681, adj=0.030, (0 split)

Node number 44: 2329 observations
  predicted class=Meaningful emp NE  expected loss=0.3370545  P(node) =0.3890095
    class counts:  1544   785
   probabilities: 0.663 0.337 

Node number 45: 157 observations,    complexity param=0.002851711
  predicted class=Meaningful emp MN  expected loss=0.477707  P(node) =0.02622348
    class counts:    75    82
   probabilities: 0.478 0.522 
  left son=90 (42 obs) right son=91 (115 obs)
  Primary splits:
      cte.achievement         splits as  LRR,      improve=5.191568, (0 missing)
      total.cte.courses.taken &lt; 3.5  to the right, improve=3.316969, (0 missing)
      pseo.participant        splits as  LR,       improve=1.946224, (24 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=1.526981, (13 missing)
      ACTCompositeScore       &lt; 22.5 to the left,  improve=1.247128, (36 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 6.5  to the right, agree=0.809, adj=0.286, (0 split)

Node number 46: 141 observations,    complexity param=0.002851711
  predicted class=Meaningful emp NE  expected loss=0.4893617  P(node) =0.02355103
    class counts:    72    69
   probabilities: 0.511 0.489 
  left son=92 (105 obs) right son=93 (36 obs)
  Primary splits:
      Dem_Desc                  splits as  RRL,      improve=4.066498, (0 missing)
      ps.grad.InstitutionSector splits as  RRRL--,   improve=2.251920, (0 missing)
      highest.cred.level        splits as  RLLR-,    improve=1.992605, (0 missing)
      MCA.S                     &lt; 2.5  to the left,  improve=1.456280, (16 missing)
      total.cte.courses.taken   &lt; 1.5  to the left,  improve=1.267440, (0 missing)

Node number 47: 69 observations
  predicted class=Meaningful emp MN  expected loss=0.3478261  P(node) =0.01152497
    class counts:    24    45
   probabilities: 0.348 0.652 

Node number 90: 42 observations
  predicted class=Meaningful emp NE  expected loss=0.3095238  P(node) =0.0070152
    class counts:    29    13
   probabilities: 0.690 0.310 

Node number 91: 115 observations
  predicted class=Meaningful emp MN  expected loss=0.4  P(node) =0.01920828
    class counts:    46    69
   probabilities: 0.400 0.600 

Node number 92: 105 observations
  predicted class=Meaningful emp NE  expected loss=0.4190476  P(node) =0.017538
    class counts:    61    44
   probabilities: 0.581 0.419 

Node number 93: 36 observations
  predicted class=Meaningful emp MN  expected loss=0.3055556  P(node) =0.006013028
    class counts:    11    25
   probabilities: 0.306 0.694 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp MN grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
[1] ACTCompositeScore         cte.achievement          
[3] Dem_Desc                  highest.cred.level       
[5] MCA.M                     ps.grad.InstitutionSector
[7] ps.grad.location         

Root node error: 2104/5987 = 0.35143

n= 5987 

         CP nsplit rel error  xerror     xstd
1 0.1611217      0   1.00000 1.00000 0.017557
2 0.0059411      1   0.83888 0.84791 0.016820
3 0.0028517      3   0.82700 0.83317 0.016735
4 0.0023764     10   0.79943 0.82700 0.016698</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp MN grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6926373</code></pre>
</div>
</div>
<p><br></p>
<p>The post-pruned tree has a bit more complexity and a bit higher accuracy.</p>
<p>The tree nodes provide the following;</p>
<ul>
<li>ps.grad.location: in region | Inside and outside region | Never attended ps | Outside region
<ul>
<li>In Minnesota: Meaningful emp in MN</li>
<li>Yes
<ul>
<li>Meaningful emp in region
<ul>
<li>ps.grad.InstitutionSector = 4</li>
<li>MCA.M &lt; 3</li>
<li>Town/rural mix | urban/town/rural mix</li>
<li>CTE Concentrator or Completor</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>The variables with most importance include;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>MCA.M</li>
<li>Dem_Desc</li>
</ul></li>
<li>Less importance
<ul>
<li>MCA.R</li>
<li>ACTCompositeScore</li>
<li>cte.achievement</li>
<li>took.ACT</li>
<li>total.cte.courses.taken</li>
<li>SpecialEdStatus</li>
<li>english.learner</li>
<li>MCA.S</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>range.school</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
             260.04934168               59.70593408               58.93281410 
                    MCA.M                  Dem_Desc                     MCA.R 
              21.10874880               14.16042932                9.93615520 
        ACTCompositeScore           cte.achievement                  took.ACT 
               8.45618077                7.34662516                5.14701096 
  total.cte.courses.taken           SpecialEdStatus           english.learner 
               4.91482114                3.14530947                0.98731687 
                    MCA.S             RaceEthnicity 
               0.29619506                0.07551564 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance meaningful emp MN grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The post-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.6423841        0.6801714         0.6926373</code></pre>
</div>
</div>
</section>
<section id="summary-1" class="level3">
<h3 class="anchored" data-anchor-id="summary-1">Summary</h3>
<p>The pre- and post-pruned trees provided better accuracy than the base model so let’s use the most important variables from both.</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>MCA.M</li>
<li>Dem_Desc</li>
</ul></li>
<li>Less importance
<ul>
<li>MCA.R</li>
<li>ACTCompositeScore</li>
<li>cte.achievement</li>
<li>took.ACT</li>
<li>total.cte.courses.taken</li>
<li>SpecialEdStatus</li>
<li>english.learner</li>
<li>MCA.S</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>range.school</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="ten-years-after-graduation" class="level2">
<h2 class="anchored" data-anchor-id="ten-years-after-graduation">Ten years after graduation</h2>
<p>We are now five years away from graduating high school, so including all of the post-secondary variables makes sense.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="even">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="even">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="even">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="odd">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="even">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="even">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="odd">
<td style="text-align: left;">grad.year.10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 5,602 individuals.The table below shows that a large majority of individuals continue to have meaningful employment in the region - 61% compared to individuals with meaningful employment in MN, but not in the region.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8831aabe2a1be1e72bec" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8831aabe2a1be1e72bec">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","Meaningful emp MN"],[3393,2209],["60.6%","39.4%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.10<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.10","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model-2" class="level3">
<h3 class="anchored" data-anchor-id="base-model-2">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(meaningful.emp.mn.grad.year<span class="fl">.10</span>), <span class="fu">nrow</span>(meaningful.emp.mn.grad.year<span class="fl">.10</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year<span class="fl">.10</span>[sample_ind,]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year<span class="fl">.10</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is .87347 and the nsplit is 33.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp MN grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] highest.cred.level        MCA.M                    
 [7] MCA.R                     MCA.S                    
 [9] ps.grad                   ps.grad.InstitutionSector
[11] ps.grad.location          pseo.participant         
[13] RaceEthnicity             range.school             
[15] SpecialEdStatus           took.ACT                 
[17] total.cte.courses.taken  

Root node error: 1557/3921 = 0.39709

n= 3921 

           CP nsplit rel error  xerror     xstd
1  0.11946050      0   1.00000 1.00000 0.019678
2  0.00642261      1   0.88054 0.88054 0.019178
3  0.00449583      5   0.85228 0.87604 0.019155
4  0.00385356      7   0.84329 0.88568 0.019204
5  0.00342539      8   0.83943 0.88311 0.019191
6  0.00256904     11   0.82916 0.87669 0.019158
7  0.00244059     16   0.81631 0.87476 0.019149
8  0.00224791     23   0.79705 0.87412 0.019145
9  0.00214087     25   0.79255 0.87669 0.019158
10 0.00192678     31   0.77970 0.87540 0.019152
11 0.00176622     33   0.77585 0.87347 0.019142
12 0.00160565     37   0.76879 0.87412 0.019145
13 0.00128452     42   0.76044 0.87861 0.019168
14 0.00119277     62   0.73475 0.88696 0.019210
15 0.00107043     73   0.71997 0.88439 0.019197
16 0.00096339     78   0.71355 0.88375 0.019194
17 0.00085635     90   0.70199 0.88696 0.019210
18 0.00064226     93   0.69942 0.88825 0.019216
19 0.00048170    121   0.68015 0.91008 0.019320
20 0.00045876    127   0.67630 0.91715 0.019353
21 0.00042817    134   0.67309 0.91715 0.019353
22 0.00038536    140   0.67052 0.91522 0.019344
23 0.00032113    145   0.66859 0.92935 0.019406
24 0.00025690    155   0.66538 0.92999 0.019409
25 0.00021409    165   0.66281 0.92871 0.019404
26 0.00012845    171   0.66153 0.93513 0.019431
27 0.00000000    176   0.66089 0.93513 0.019431</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp MN grad year 10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location         ACTCompositeScore ps.grad.InstitutionSector 
               125.070565                 67.836219                 61.480522 
  total.cte.courses.taken        highest.cred.level           cte.achievement 
                56.241985                 54.152496                 46.053060 
                    MCA.M                  Dem_Desc                     MCA.R 
                44.150349                 25.675241                 25.233280 
          economic.status                   ps.grad                  took.ACT 
                22.637876                 21.887979                 21.233461 
            RaceEthnicity           SpecialEdStatus              range.school 
                15.741536                 14.659840                 13.482340 
                    MCA.S          pseo.participant           english.learner 
                 9.882719                  8.293591                  1.678406 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance meaningful emp MN grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6014277</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-2" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-2">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 280</li>
<li>minbucket: round(minsplit / 3) which is 93</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.10</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">280</span>, <span class="at">minbucket =</span> <span class="dv">93</span>))</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6609161</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .6609161 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp MN grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 280, 
        minbucket = 93))

Variables actually used in tree construction:
[1] ACTCompositeScore  Dem_Desc           economic.status    highest.cred.level
[5] MCA.M              ps.grad.location  

Root node error: 1557/3921 = 0.39709

n= 3921 

         CP nsplit rel error  xerror     xstd
1 0.1194605      0   1.00000 1.00000 0.019678
2 0.0064226      1   0.88054 0.88054 0.019178
3 0.0000000      6   0.84650 0.88696 0.019210</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location: in region | Inside and outside region | Never attended ps | Outside region
<ul>
<li>In Minnesota: Meaningful emp in MN</li>
<li>Yes
<ul>
<li>highest.cred.level: associate degree | Less than Associate degree</li>
<li>MCA.M &lt; 3</li>
<li>ACTCompositeScore &lt; 29</li>
<li>Dem_Desc = Urban/town/rural mix</li>
<li>economic.status = 0</li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
</ul></li>
<li>Not as importance
<ul>
<li>MCA.M</li>
<li>ACTCompositeScore</li>
<li>MCA.R</li>
<li>Dem_Desc</li>
<li>economic.status</li>
<li>took.ACT</li>
<li>ps.grad</li>
<li>SpecialEdStatus</li>
<li>cte.achievement</li>
<li>total.cte.courses.taken</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>range.school</li>
<li>pseo.participant</li>
<li>english.learner</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
             103.23689900               36.15122871               34.66433319 
                    MCA.M         ACTCompositeScore                     MCA.R 
              11.25093006                8.18473808                5.16522208 
                 Dem_Desc           economic.status                  took.ACT 
               4.75253362                4.14730464                3.94816014 
                  ps.grad           SpecialEdStatus           cte.achievement 
               2.10428866                1.99611078                1.97335515 
  total.cte.courses.taken             RaceEthnicity 
               0.29318030                0.03875986 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance meaningful emp MN grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-2" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-2">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 3921 

            CP nsplit rel error    xerror       xstd
1  0.119460501      0 1.0000000 1.0000000 0.01967800
2  0.006422608      1 0.8805395 0.8805395 0.01917793
3  0.004495825      5 0.8522800 0.8760437 0.01915515
4  0.003853565      7 0.8432884 0.8856776 0.01920361
5  0.003425391      8 0.8394348 0.8831085 0.01919082
6  0.002569043     11 0.8291586 0.8766859 0.01915842
7  0.002440591     16 0.8163134 0.8747592 0.01914858
8  0.002247913     23 0.7970456 0.8741169 0.01914529
9  0.002140869     25 0.7925498 0.8766859 0.01915842
10 0.001926782     31 0.7797046 0.8754014 0.01915187
11 0.001766217     33 0.7758510 0.8734746 0.01914200

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       34                        15                        13 
        ACTCompositeScore                  Dem_Desc                     MCA.M 
                        8                         5                         5 
  total.cte.courses.taken                  took.ACT           cte.achievement 
                        5                         3                         3 
                    MCA.R                   ps.grad           economic.status 
                        3                         2                         2 
            RaceEthnicity          pseo.participant           SpecialEdStatus 
                        1                         1                         1 

Node number 1: 3921 observations,    complexity param=0.1194605
  predicted class=Meaningful emp NE  expected loss=0.3970926  P(node) =1
    class counts:  2364  1557
   probabilities: 0.603 0.397 
  left son=2 (3429 obs) right son=3 (492 obs)
  Primary splits:
      ps.grad.location          splits as  RLRLLL,   improve=92.95588, (921 missing)
      ps.grad.InstitutionSector splits as  RLLRLL,   improve=65.50870, (921 missing)
      highest.cred.level        splits as  LRLRL,    improve=47.01101, (921 missing)
      ACTCompositeScore         &lt; 25.5 to the left,  improve=35.73982, (1619 missing)
      took.ACT                  splits as  LR,       improve=34.41656, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  LLRLLL, agree=0.84, adj=0.022, (0 split)

Node number 2: 3429 observations,    complexity param=0.006422608
  predicted class=Meaningful emp NE  expected loss=0.3552056  P(node) =0.8745218
    class counts:  2211  1218
   probabilities: 0.645 0.355 
  left son=4 (765 obs) right son=5 (2664 obs)
  Primary splits:
      highest.cred.level        splits as  LRLRR,    improve=34.66433, (921 missing)
      ps.grad.InstitutionSector splits as  RRLRLR,   improve=34.57784, (921 missing)
      ps.grad.location          splits as  -L-RRR,   improve=17.43535, (921 missing)
      MCA.M                     &lt; 3.5  to the left,  improve=15.21019, (73 missing)
      ACTCompositeScore         &lt; 25.5 to the left,  improve=14.18614, (1528 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RRLRLR,   agree=0.995, adj=0.983, (0 split)
      ps.grad.location          splits as  -L-RRR,   agree=0.786, adj=0.297, (0 split)
      total.cte.courses.taken   &lt; 12.5 to the right, agree=0.697, adj=0.001, (921 split)

Node number 3: 492 observations,    complexity param=0.004495825
  predicted class=Meaningful emp MN  expected loss=0.3109756  P(node) =0.1254782
    class counts:   153   339
   probabilities: 0.311 0.689 
  left son=6 (78 obs) right son=7 (414 obs)
  Primary splits:
      highest.cred.level        splits as  RRLR-,    improve=8.543061, (0 missing)
      ps.grad.InstitutionSector splits as  RRLRL-,   improve=8.375727, (0 missing)
      MCA.R                     &lt; 3.5  to the left,  improve=7.607811, (8 missing)
      took.ACT                  splits as  LR,       improve=6.647772, (0 missing)
      MCA.S                     &lt; 1.5  to the left,  improve=5.217145, (166 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RRLRR-, agree=0.866, adj=0.154, (0 split)
      SpecialEdStatus           splits as  RL,     agree=0.848, adj=0.038, (0 split)
      english.learner           splits as  RL,     agree=0.846, adj=0.026, (0 split)

Node number 4: 765 observations
  predicted class=Meaningful emp NE  expected loss=0.2287582  P(node) =0.1951033
    class counts:   590   175
   probabilities: 0.771 0.229 

Node number 5: 2664 observations,    complexity param=0.006422608
  predicted class=Meaningful emp NE  expected loss=0.3915165  P(node) =0.6794185
    class counts:  1621  1043
   probabilities: 0.608 0.392 
  left son=10 (1250 obs) right son=11 (1414 obs)
  Primary splits:
      MCA.M             &lt; 2.5  to the left,  improve=11.250930, (57 missing)
      took.ACT          splits as  LR,       improve=11.190660, (0 missing)
      ACTCompositeScore &lt; 28.5 to the left,  improve= 9.718413, (1122 missing)
      Dem_Desc          splits as  RRL,      improve= 8.529768, (0 missing)
      MCA.R             &lt; 3.5  to the left,  improve= 7.940251, (76 missing)
  Surrogate splits:
      MCA.R           &lt; 3.5  to the left,  agree=0.747, adj=0.452, (28 split)
      took.ACT        splits as  LR,       agree=0.688, adj=0.323, (29 split)
      ps.grad         splits as  -LR,      agree=0.625, adj=0.187, (0 split)
      cte.achievement splits as  LRR,      agree=0.619, adj=0.175, (0 split)
      SpecialEdStatus splits as  RL,       agree=0.616, adj=0.167, (0 split)

Node number 6: 78 observations,    complexity param=0.004495825
  predicted class=Meaningful emp NE  expected loss=0.474359  P(node) =0.01989288
    class counts:    41    37
   probabilities: 0.526 0.474 
  left son=12 (60 obs) right son=13 (18 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  L-LRL-,   improve=4.308547, (0 missing)
      MCA.M                     &lt; 3.5  to the left,  improve=2.875214, (0 missing)
      took.ACT                  splits as  LR,       improve=2.500611, (0 missing)
      MCA.S                     &lt; 3.5  to the left,  improve=1.874451, (22 missing)
      MCA.R                     &lt; 3.5  to the left,  improve=1.539103, (0 missing)
  Surrogate splits:
      MCA.R                   &lt; 3.5  to the left,  agree=0.846, adj=0.333, (0 split)
      total.cte.courses.taken &lt; 0.5  to the right, agree=0.846, adj=0.333, (0 split)
      MCA.M                   &lt; 3.5  to the left,  agree=0.821, adj=0.222, (0 split)

Node number 7: 414 observations
  predicted class=Meaningful emp MN  expected loss=0.2705314  P(node) =0.1055853
    class counts:   112   302
   probabilities: 0.271 0.729 

Node number 10: 1250 observations,    complexity param=0.002569043
  predicted class=Meaningful emp NE  expected loss=0.3408  P(node) =0.3187962
    class counts:   824   426
   probabilities: 0.659 0.341 
  left son=20 (1178 obs) right son=21 (72 obs)
  Primary splits:
      Dem_Desc          splits as  RLL,      improve=4.577893, (0 missing)
      took.ACT          splits as  LR,       improve=3.428865, (0 missing)
      ACTCompositeScore &lt; 22.5 to the left,  improve=2.945416, (776 missing)
      economic.status   splits as  LR,       improve=2.942011, (0 missing)
      RaceEthnicity     splits as  LRRR-L,   improve=2.748209, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 9.5  to the left,  agree=0.948, adj=0.097, (0 split)

Node number 11: 1414 observations,    complexity param=0.006422608
  predicted class=Meaningful emp NE  expected loss=0.4363508  P(node) =0.3606223
    class counts:   797   617
   probabilities: 0.564 0.436 
  left son=22 (1286 obs) right son=23 (128 obs)
  Primary splits:
      ACTCompositeScore         &lt; 28.5 to the left,  improve=8.184738, (346 missing)
      ps.grad.InstitutionSector splits as  RL-R-R,   improve=3.900535, (392 missing)
      Dem_Desc                  splits as  RLL,      improve=3.884880, (0 missing)
      ps.grad.location          splits as  -L-LRR,   improve=3.836698, (392 missing)
      RaceEthnicity             splits as  LRRR-R,   improve=3.154089, (0 missing)

Node number 12: 60 observations
  predicted class=Meaningful emp NE  expected loss=0.3833333  P(node) =0.01530222
    class counts:    37    23
   probabilities: 0.617 0.383 

Node number 13: 18 observations
  predicted class=Meaningful emp MN  expected loss=0.2222222  P(node) =0.004590666
    class counts:     4    14
   probabilities: 0.222 0.778 

Node number 20: 1178 observations
  predicted class=Meaningful emp NE  expected loss=0.3302207  P(node) =0.3004336
    class counts:   789   389
   probabilities: 0.670 0.330 

Node number 21: 72 observations,    complexity param=0.002569043
  predicted class=Meaningful emp MN  expected loss=0.4861111  P(node) =0.01836266
    class counts:    35    37
   probabilities: 0.486 0.514 
  left son=42 (62 obs) right son=43 (10 obs)
  Primary splits:
      ACTCompositeScore       &lt; 20.5 to the left,  improve=3.8227510, (45 missing)
      total.cte.courses.taken &lt; 3.5  to the left,  improve=2.7953880, (0 missing)
      MCA.R                   &lt; 2.5  to the left,  improve=1.1211340, (2 missing)
      took.ACT                splits as  RL,       improve=0.9796296, (0 missing)
      MCA.M                   &lt; 1.5  to the left,  improve=0.8384430, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 0.5  to the right, agree=0.778, adj=0.143, (45 split)

Node number 22: 1286 observations,    complexity param=0.006422608
  predicted class=Meaningful emp NE  expected loss=0.4183515  P(node) =0.3279776
    class counts:   748   538
   probabilities: 0.582 0.418 
  left son=44 (1220 obs) right son=45 (66 obs)
  Primary splits:
      Dem_Desc                  splits as  RLL,    improve=4.902593, (0 missing)
      RaceEthnicity             splits as  LRRR-R, improve=3.616098, (0 missing)
      ps.grad.location          splits as  -L-LRR, improve=2.680682, (371 missing)
      ps.grad.InstitutionSector splits as  RL-R-R, improve=2.670430, (371 missing)
      pseo.participant          splits as  LR,     improve=2.507288, (447 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 10.5 to the left,  agree=0.951, adj=0.045, (0 split)

Node number 23: 128 observations,    complexity param=0.003853565
  predicted class=Meaningful emp MN  expected loss=0.3828125  P(node) =0.03264473
    class counts:    49    79
   probabilities: 0.383 0.617 
  left son=46 (16 obs) right son=47 (112 obs)
  Primary splits:
      total.cte.courses.taken   &lt; 2.5  to the right, improve=3.3950890, (0 missing)
      cte.achievement           splits as  LLR,      improve=1.4260420, (0 missing)
      ps.grad.location          splits as  -L-RLR,   improve=0.9881694, (21 missing)
      MCA.M                     &lt; 3.5  to the right, improve=0.8362269, (0 missing)
      ps.grad.InstitutionSector splits as  RL-R-R,   improve=0.4396543, (21 missing)
  Surrogate splits:
      cte.achievement splits as  LRR, agree=0.906, adj=0.25, (0 split)

Node number 42: 62 observations,    complexity param=0.002569043
  predicted class=Meaningful emp NE  expected loss=0.5  P(node) =0.01581229
    class counts:    31    31
   probabilities: 0.500 0.500 
  left son=84 (20 obs) right son=85 (42 obs)
  Primary splits:
      took.ACT                splits as  RL,       improve=3.6904760, (0 missing)
      total.cte.courses.taken &lt; 3.5  to the left,  improve=3.2563030, (0 missing)
      MCA.R                   &lt; 1.5  to the right, improve=1.2274960, (2 missing)
      economic.status         splits as  LR,       improve=0.5438596, (0 missing)
      SpecialEdStatus         splits as  RL,       improve=0.3414933, (0 missing)
  Surrogate splits:
      ps.grad                 splits as  -RL,      agree=0.742, adj=0.20, (0 split)
      cte.achievement         splits as  RRL,      agree=0.710, adj=0.10, (0 split)
      total.cte.courses.taken &lt; 3.5  to the left,  agree=0.710, adj=0.10, (0 split)
      RaceEthnicity           splits as  RL-R-R,   agree=0.694, adj=0.05, (0 split)

Node number 43: 10 observations
  predicted class=Meaningful emp MN  expected loss=0.4  P(node) =0.00255037
    class counts:     4     6
   probabilities: 0.400 0.600 

Node number 44: 1220 observations,    complexity param=0.003425391
  predicted class=Meaningful emp NE  expected loss=0.4081967  P(node) =0.3111451
    class counts:   722   498
   probabilities: 0.592 0.408 
  left son=88 (476 obs) right son=89 (744 obs)
  Primary splits:
      pseo.participant          splits as  LR,       improve=3.572538, (415 missing)
      RaceEthnicity             splits as  LRRR-R,   improve=2.536567, (0 missing)
      ps.grad.InstitutionSector splits as  RL-R-R,   improve=2.159655, (344 missing)
      total.cte.courses.taken   &lt; 3.5  to the right, improve=2.159599, (0 missing)
      Dem_Desc                  splits as  -RL,      improve=1.919716, (0 missing)
  Surrogate splits:
      took.ACT        splits as  LR,       agree=0.626, adj=0.224, (415 split)
      ps.grad         splits as  -LR,      agree=0.590, adj=0.149, (0 split)
      MCA.R           &lt; 3.5  to the left,  agree=0.580, adj=0.129, (0 split)
      economic.status splits as  RL,       agree=0.571, adj=0.111, (0 split)
      cte.achievement splits as  LRR,      agree=0.570, adj=0.108, (0 split)

Node number 45: 66 observations,    complexity param=0.001926782
  predicted class=Meaningful emp MN  expected loss=0.3939394  P(node) =0.01683244
    class counts:    26    40
   probabilities: 0.394 0.606 
  left son=90 (42 obs) right son=91 (24 obs)
  Primary splits:
      economic.status           splits as  LR,     improve=2.598485, (0 missing)
      ps.grad                   splits as  -RL,    improve=2.436891, (0 missing)
      took.ACT                  splits as  RL,     improve=2.200692, (0 missing)
      ps.grad.location          splits as  -L-LRR, improve=1.940357, (27 missing)
      ps.grad.InstitutionSector splits as  LL-L-R, improve=1.516329, (27 missing)
  Surrogate splits:
      took.ACT                splits as  RL,       agree=0.773, adj=0.375, (0 split)
      SpecialEdStatus         splits as  LR,       agree=0.682, adj=0.125, (0 split)
      total.cte.courses.taken &lt; 3.5  to the left,  agree=0.667, adj=0.083, (0 split)
      RaceEthnicity           splits as  LLR--L,   agree=0.652, adj=0.042, (0 split)

Node number 46: 16 observations
  predicted class=Meaningful emp NE  expected loss=0.3125  P(node) =0.004080592
    class counts:    11     5
   probabilities: 0.688 0.312 

Node number 47: 112 observations
  predicted class=Meaningful emp MN  expected loss=0.3392857  P(node) =0.02856414
    class counts:    38    74
   probabilities: 0.339 0.661 

Node number 84: 20 observations
  predicted class=Meaningful emp NE  expected loss=0.25  P(node) =0.00510074
    class counts:    15     5
   probabilities: 0.750 0.250 

Node number 85: 42 observations
  predicted class=Meaningful emp MN  expected loss=0.3809524  P(node) =0.01071155
    class counts:    16    26
   probabilities: 0.381 0.619 

Node number 88: 476 observations,    complexity param=0.002140869
  predicted class=Meaningful emp NE  expected loss=0.3697479  P(node) =0.1213976
    class counts:   300   176
   probabilities: 0.630 0.370 
  left son=176 (302 obs) right son=177 (174 obs)
  Primary splits:
      economic.status         splits as  LR,       improve=1.359891, (0 missing)
      total.cte.courses.taken &lt; 0.5  to the left,  improve=1.295856, (0 missing)
      RaceEthnicity           splits as  LRRR-L,   improve=1.173415, (0 missing)
      highest.cred.level      splits as  -L-RL,    improve=1.167628, (173 missing)
      ACTCompositeScore       &lt; 16.5 to the left,  improve=1.154586, (249 missing)
  Surrogate splits:
      RaceEthnicity   splits as  RLLR-L,   agree=0.664, adj=0.080, (0 split)
      SpecialEdStatus splits as  LR,       agree=0.645, adj=0.029, (0 split)
      took.ACT        splits as  RL,       agree=0.645, adj=0.029, (0 split)
      MCA.R           &lt; 2.5  to the right, agree=0.639, adj=0.011, (0 split)

Node number 89: 744 observations,    complexity param=0.003425391
  predicted class=Meaningful emp NE  expected loss=0.4327957  P(node) =0.1897475
    class counts:   422   322
   probabilities: 0.567 0.433 
  left son=178 (147 obs) right son=179 (597 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RL-R-R,   improve=3.860672, (171 missing)
      RaceEthnicity             splits as  LLRR-R,   improve=2.855999, (0 missing)
      ps.grad.location          splits as  -L-LRR,   improve=2.278275, (171 missing)
      Dem_Desc                  splits as  -RL,      improve=2.039677, (0 missing)
      total.cte.courses.taken   &lt; 1.5  to the right, improve=1.676687, (0 missing)
  Surrogate splits:
      ps.grad.location        splits as  -R-LRR,   agree=0.883, adj=0.531, (0 split)
      total.cte.courses.taken &lt; 6.5  to the right, agree=0.754, adj=0.014, (171 split)

Node number 90: 42 observations,    complexity param=0.001926782
  predicted class=Meaningful emp NE  expected loss=0.5  P(node) =0.01071155
    class counts:    21    21
   probabilities: 0.500 0.500 
  left son=180 (12 obs) right son=181 (30 obs)
  Primary splits:
      ACTCompositeScore &lt; 20.5 to the left,  improve=0.9657143, (7 missing)
      MCA.S             &lt; 2.5  to the left,  improve=0.9411765, (8 missing)
      ps.grad           splits as  -RL,      improve=0.4447059, (0 missing)
      cte.achievement   splits as  LRR,      improve=0.4324943, (0 missing)
      MCA.M             &lt; 3.5  to the right, improve=0.2333333, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 9.5  to the right, agree=0.771, adj=0.2, (7 split)
      RaceEthnicity           splits as  LR---R,   agree=0.743, adj=0.1, (0 split)

Node number 91: 24 observations
  predicted class=Meaningful emp MN  expected loss=0.2083333  P(node) =0.006120888
    class counts:     5    19
   probabilities: 0.208 0.792 

Node number 176: 302 observations
  predicted class=Meaningful emp NE  expected loss=0.3410596  P(node) =0.07702117
    class counts:   199   103
   probabilities: 0.659 0.341 

Node number 177: 174 observations,    complexity param=0.002140869
  predicted class=Meaningful emp NE  expected loss=0.4195402  P(node) =0.04437643
    class counts:   101    73
   probabilities: 0.580 0.420 
  left son=354 (121 obs) right son=355 (53 obs)
  Primary splits:
      Dem_Desc                splits as  -RL,      improve=2.482975, (0 missing)
      total.cte.courses.taken &lt; 2.5  to the right, improve=2.461179, (0 missing)
      MCA.S                   &lt; 2.5  to the right, improve=2.344811, (17 missing)
      SpecialEdStatus         splits as  LR,       improve=2.090652, (0 missing)
      ACTCompositeScore       &lt; 19.5 to the right, improve=1.737589, (127 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 7.5  to the left,  agree=0.707, adj=0.038, (0 split)

Node number 178: 147 observations,    complexity param=0.002569043
  predicted class=Meaningful emp NE  expected loss=0.3333333  P(node) =0.03749044
    class counts:    98    49
   probabilities: 0.667 0.333 
  left son=356 (101 obs) right son=357 (46 obs)
  Primary splits:
      total.cte.courses.taken &lt; 0.5  to the right, improve=2.0319990, (0 missing)
      ps.grad.location        splits as  -L-R-R,   improve=1.7153220, (4 missing)
      ACTCompositeScore       &lt; 21.5 to the left,  improve=1.2705660, (12 missing)
      MCA.M                   &lt; 3.5  to the left,  improve=0.7462927, (1 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.3586207, (30 missing)
  Surrogate splits:
      cte.achievement splits as  LLR,    agree=0.721, adj=0.109, (0 split)
      RaceEthnicity   splits as  RL-L-L, agree=0.707, adj=0.065, (0 split)

Node number 179: 597 observations,    complexity param=0.003425391
  predicted class=Meaningful emp NE  expected loss=0.4572864  P(node) =0.1522571
    class counts:   324   273
   probabilities: 0.543 0.457 
  left son=358 (517 obs) right son=359 (80 obs)
  Primary splits:
      Dem_Desc                splits as  -RL,      improve=3.763001, (0 missing)
      total.cte.courses.taken &lt; 4.5  to the right, improve=2.863502, (0 missing)
      RaceEthnicity           splits as  LRRR-R,   improve=2.596565, (0 missing)
      cte.achievement         splits as  LLR,      improve=1.099368, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=1.091074, (148 missing)

Node number 180: 12 observations
  predicted class=Meaningful emp NE  expected loss=0.25  P(node) =0.003060444
    class counts:     9     3
   probabilities: 0.750 0.250 

Node number 181: 30 observations
  predicted class=Meaningful emp MN  expected loss=0.4  P(node) =0.007651109
    class counts:    12    18
   probabilities: 0.400 0.600 

Node number 354: 121 observations
  predicted class=Meaningful emp NE  expected loss=0.3636364  P(node) =0.03085947
    class counts:    77    44
   probabilities: 0.636 0.364 

Node number 355: 53 observations,    complexity param=0.002140869
  predicted class=Meaningful emp MN  expected loss=0.4528302  P(node) =0.01351696
    class counts:    24    29
   probabilities: 0.453 0.547 
  left son=710 (31 obs) right son=711 (22 obs)
  Primary splits:
      cte.achievement         splits as  LLR,      improve=2.4401040, (0 missing)
      MCA.R                   &lt; 3.5  to the right, improve=1.7916870, (0 missing)
      total.cte.courses.taken &lt; 1.5  to the right, improve=1.5005150, (0 missing)
      RaceEthnicity           splits as  L----R,   improve=0.9914237, (0 missing)
      ACTCompositeScore       &lt; 20.5 to the right, improve=0.2761438, (36 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 1.5  to the right, agree=0.887, adj=0.727, (0 split)
      MCA.M                   &lt; 3.5  to the left,  agree=0.679, adj=0.227, (0 split)
      range.school            splits as  LR,       agree=0.623, adj=0.091, (0 split)
      MCA.R                   &lt; 3.5  to the right, agree=0.604, adj=0.045, (0 split)

Node number 356: 101 observations
  predicted class=Meaningful emp NE  expected loss=0.2772277  P(node) =0.02575874
    class counts:    73    28
   probabilities: 0.723 0.277 

Node number 357: 46 observations,    complexity param=0.002569043
  predicted class=Meaningful emp NE  expected loss=0.4565217  P(node) =0.0117317
    class counts:    25    21
   probabilities: 0.543 0.457 
  left son=714 (38 obs) right son=715 (8 obs)
  Primary splits:
      ACTCompositeScore &lt; 26.5 to the left,  improve=5.5351350, (1 missing)
      ps.grad.location  splits as  -L-R-R,   improve=3.2467220, (0 missing)
      MCA.S             &lt; 2.5  to the left,  improve=0.7683794, (13 missing)
      MCA.M             &lt; 3.5  to the left,  improve=0.4960317, (1 missing)
      Dem_Desc          splits as  -RL,      improve=0.2194803, (0 missing)

Node number 358: 517 observations,    complexity param=0.002440591
  predicted class=Meaningful emp NE  expected loss=0.4352031  P(node) =0.1318541
    class counts:   292   225
   probabilities: 0.565 0.435 
  left son=716 (38 obs) right son=717 (479 obs)
  Primary splits:
      total.cte.courses.taken &lt; 4.5  to the right, improve=2.4280280, (0 missing)
      RaceEthnicity           splits as  LRRR-R,   improve=2.2915460, (0 missing)
      ACTCompositeScore       &lt; 23.5 to the right, improve=1.5911260, (50 missing)
      cte.achievement         splits as  LLR,      improve=0.9993707, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.3679652, (137 missing)

Node number 359: 80 observations
  predicted class=Meaningful emp MN  expected loss=0.4  P(node) =0.02040296
    class counts:    32    48
   probabilities: 0.400 0.600 

Node number 710: 31 observations
  predicted class=Meaningful emp NE  expected loss=0.4193548  P(node) =0.007906146
    class counts:    18    13
   probabilities: 0.581 0.419 

Node number 711: 22 observations
  predicted class=Meaningful emp MN  expected loss=0.2727273  P(node) =0.005610814
    class counts:     6    16
   probabilities: 0.273 0.727 

Node number 714: 38 observations,    complexity param=0.002247913
  predicted class=Meaningful emp NE  expected loss=0.3421053  P(node) =0.009691405
    class counts:    25    13
   probabilities: 0.658 0.342 
  left son=1428 (15 obs) right son=1429 (23 obs)
  Primary splits:
      ps.grad.location  splits as  -L-R-R,   improve=3.7603360, (0 missing)
      ACTCompositeScore &lt; 21.5 to the left,  improve=2.3981980, (1 missing)
      MCA.S             &lt; 2.5  to the left,  improve=0.5116959, (10 missing)
      Dem_Desc          splits as  -RL,      improve=0.5052632, (0 missing)
      MCA.R             &lt; 3.5  to the right, improve=0.2470256, (0 missing)
  Surrogate splits:
      took.ACT splits as  LR, agree=0.632, adj=0.067, (0 split)

Node number 715: 8 observations
  predicted class=Meaningful emp MN  expected loss=0  P(node) =0.002040296
    class counts:     0     8
   probabilities: 0.000 1.000 

Node number 716: 38 observations
  predicted class=Meaningful emp NE  expected loss=0.2631579  P(node) =0.009691405
    class counts:    28    10
   probabilities: 0.737 0.263 

Node number 717: 479 observations,    complexity param=0.002440591
  predicted class=Meaningful emp NE  expected loss=0.4488518  P(node) =0.1221627
    class counts:   264   215
   probabilities: 0.551 0.449 
  left son=1434 (8 obs) right son=1435 (471 obs)
  Primary splits:
      RaceEthnicity     splits as  LRRR-R,   improve=1.7065820, (0 missing)
      ACTCompositeScore &lt; 23.5 to the right, improve=1.2811040, (37 missing)
      MCA.M             &lt; 3.5  to the left,  improve=0.7506053, (3 missing)
      MCA.S             &lt; 2.5  to the left,  improve=0.7031492, (133 missing)
      economic.status   splits as  RL,       improve=0.6370472, (0 missing)

Node number 1428: 15 observations
  predicted class=Meaningful emp NE  expected loss=0.06666667  P(node) =0.003825555
    class counts:    14     1
   probabilities: 0.933 0.067 

Node number 1429: 23 observations,    complexity param=0.002247913
  predicted class=Meaningful emp MN  expected loss=0.4782609  P(node) =0.005865851
    class counts:    11    12
   probabilities: 0.478 0.522 
  left son=2858 (10 obs) right son=2859 (13 obs)
  Primary splits:
      ACTCompositeScore &lt; 21.5 to the left,  improve=3.66287600, (0 missing)
      MCA.M             &lt; 3.5  to the right, improve=0.17667360, (0 missing)
      MCA.R             &lt; 3.5  to the right, improve=0.04968944, (0 missing)
  Surrogate splits:
      RaceEthnicity splits as  L----R,   agree=0.652, adj=0.2, (0 split)
      MCA.R         &lt; 3.5  to the left,  agree=0.609, adj=0.1, (0 split)

Node number 1434: 8 observations
  predicted class=Meaningful emp NE  expected loss=0.125  P(node) =0.002040296
    class counts:     7     1
   probabilities: 0.875 0.125 

Node number 1435: 471 observations,    complexity param=0.002440591
  predicted class=Meaningful emp NE  expected loss=0.4543524  P(node) =0.1201224
    class counts:   257   214
   probabilities: 0.546 0.454 
  left son=2870 (251 obs) right son=2871 (220 obs)
  Primary splits:
      ACTCompositeScore &lt; 23.5 to the right, improve=1.2969120, (35 missing)
      MCA.S             &lt; 2.5  to the left,  improve=0.7789721, (132 missing)
      MCA.M             &lt; 3.5  to the left,  improve=0.6525583, (3 missing)
      economic.status   splits as  RL,       improve=0.4722803, (0 missing)
      ps.grad.location  splits as  -L-RRR,   improve=0.4665813, (120 missing)
  Surrogate splits:
      MCA.R                   &lt; 3.5  to the right, agree=0.649, adj=0.257, (35 split)
      MCA.M                   &lt; 3.5  to the right, agree=0.603, adj=0.160, (0 split)
      total.cte.courses.taken &lt; 0.5  to the left,  agree=0.550, adj=0.049, (0 split)
      economic.status         splits as  LR,       agree=0.548, adj=0.044, (0 split)
      RaceEthnicity           splits as  -LRR-L,   agree=0.539, adj=0.024, (0 split)

Node number 2858: 10 observations
  predicted class=Meaningful emp NE  expected loss=0.2  P(node) =0.00255037
    class counts:     8     2
   probabilities: 0.800 0.200 

Node number 2859: 13 observations
  predicted class=Meaningful emp MN  expected loss=0.2307692  P(node) =0.003315481
    class counts:     3    10
   probabilities: 0.231 0.769 

Node number 2870: 251 observations,    complexity param=0.002440591
  predicted class=Meaningful emp NE  expected loss=0.4302789  P(node) =0.06401428
    class counts:   143   108
   probabilities: 0.570 0.430 
  left son=5740 (175 obs) right son=5741 (76 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  L--L-R,   improve=2.528058, (54 missing)
      highest.cred.level        splits as  -L-LR,    improve=2.528058, (54 missing)
      ps.grad.location          splits as  -L-LRL,   improve=2.528058, (54 missing)
      ACTCompositeScore         &lt; 24.5 to the left,  improve=2.400228, (21 missing)
      took.ACT                  splits as  RL,       improve=1.633260, (0 missing)
  Surrogate splits:
      took.ACT        splits as  RL, agree=0.690, adj=0.116, (54 split)
      economic.status splits as  LR, agree=0.655, adj=0.014, (0 split)
      SpecialEdStatus splits as  LR, agree=0.655, adj=0.014, (0 split)

Node number 2871: 220 observations,    complexity param=0.002440591
  predicted class=Meaningful emp NE  expected loss=0.4818182  P(node) =0.05610814
    class counts:   114   106
   probabilities: 0.518 0.482 
  left son=5742 (169 obs) right son=5743 (51 obs)
  Primary splits:
      MCA.M                     &lt; 3.5  to the left,  improve=2.120324, (2 missing)
      MCA.S                     &lt; 2.5  to the left,  improve=1.610859, (47 missing)
      ps.grad                   splits as  -LR,      improve=1.482792, (0 missing)
      ACTCompositeScore         &lt; 19.5 to the left,  improve=1.384097, (14 missing)
      ps.grad.InstitutionSector splits as  R--R-L,   improve=1.187322, (66 missing)

Node number 5740: 175 observations
  predicted class=Meaningful emp NE  expected loss=0.3771429  P(node) =0.04463147
    class counts:   109    66
   probabilities: 0.623 0.377 

Node number 5741: 76 observations,    complexity param=0.002440591
  predicted class=Meaningful emp MN  expected loss=0.4473684  P(node) =0.01938281
    class counts:    34    42
   probabilities: 0.447 0.553 
  left son=11482 (23 obs) right son=11483 (53 obs)
  Primary splits:
      total.cte.courses.taken &lt; 1.5  to the right, improve=1.7167650, (0 missing)
      ACTCompositeScore       &lt; 24.5 to the left,  improve=0.4720690, (18 missing)
      economic.status         splits as  LR,       improve=0.3905127, (0 missing)
      cte.achievement         splits as  RLR,      improve=0.2762151, (0 missing)
      MCA.M                   &lt; 3.5  to the right, improve=0.2206660, (0 missing)
  Surrogate splits:
      cte.achievement splits as  LLR, agree=0.816, adj=0.391, (0 split)

Node number 5742: 169 observations,    complexity param=0.002140869
  predicted class=Meaningful emp NE  expected loss=0.443787  P(node) =0.04310125
    class counts:    94    75
   probabilities: 0.556 0.444 
  left son=11484 (34 obs) right son=11485 (135 obs)
  Primary splits:
      ACTCompositeScore         &lt; 19.5 to the left,  improve=1.4290310, (14 missing)
      MCA.S                     &lt; 2.5  to the left,  improve=0.8449425, (42 missing)
      economic.status           splits as  RL,       improve=0.7293886, (0 missing)
      total.cte.courses.taken   &lt; 0.5  to the left,  improve=0.4838652, (0 missing)
      ps.grad.InstitutionSector splits as  L--R-L,   improve=0.4072508, (54 missing)

Node number 5743: 51 observations,    complexity param=0.002440591
  predicted class=Meaningful emp MN  expected loss=0.3921569  P(node) =0.01300689
    class counts:    20    31
   probabilities: 0.392 0.608 
  left son=11486 (22 obs) right son=11487 (29 obs)
  Primary splits:
      ps.grad                   splits as  -LR,      improve=4.6146660, (0 missing)
      ps.grad.InstitutionSector splits as  R--R-L,   improve=2.2981430, (12 missing)
      highest.cred.level        splits as  -R-RL,    improve=2.2981430, (12 missing)
      ps.grad.location          splits as  -R-RLR,   improve=2.2981430, (12 missing)
      total.cte.courses.taken   &lt; 0.5  to the left,  improve=0.7653384, (0 missing)
  Surrogate splits:
      ACTCompositeScore &lt; 20.5 to the left,  agree=0.647, adj=0.182, (0 split)
      economic.status   splits as  RL,       agree=0.608, adj=0.091, (0 split)
      MCA.R             &lt; 3.5  to the left,  agree=0.608, adj=0.091, (0 split)
      SpecialEdStatus   splits as  RL,       agree=0.588, adj=0.045, (0 split)
      RaceEthnicity     splits as  ---L-R,   agree=0.588, adj=0.045, (0 split)

Node number 11482: 23 observations
  predicted class=Meaningful emp NE  expected loss=0.3913043  P(node) =0.005865851
    class counts:    14     9
   probabilities: 0.609 0.391 

Node number 11483: 53 observations
  predicted class=Meaningful emp MN  expected loss=0.3773585  P(node) =0.01351696
    class counts:    20    33
   probabilities: 0.377 0.623 

Node number 11484: 34 observations
  predicted class=Meaningful emp NE  expected loss=0.3235294  P(node) =0.008671257
    class counts:    23    11
   probabilities: 0.676 0.324 

Node number 11485: 135 observations,    complexity param=0.002140869
  predicted class=Meaningful emp NE  expected loss=0.4740741  P(node) =0.03442999
    class counts:    71    64
   probabilities: 0.526 0.474 
  left son=22970 (30 obs) right son=22971 (105 obs)
  Primary splits:
      economic.status           splits as  RL,       improve=1.5280420, (0 missing)
      total.cte.courses.taken   &lt; 2.5  to the right, improve=1.3370370, (0 missing)
      MCA.S                     &lt; 2.5  to the left,  improve=1.0043740, (40 missing)
      cte.achievement           splits as  RLR,      improve=0.9956614, (0 missing)
      ps.grad.InstitutionSector splits as  L--R-L,   improve=0.5044160, (43 missing)
  Surrogate splits:
      RaceEthnicity splits as  -LLL-R, agree=0.83, adj=0.233, (0 split)

Node number 11486: 22 observations
  predicted class=Meaningful emp NE  expected loss=0.3636364  P(node) =0.005610814
    class counts:    14     8
   probabilities: 0.636 0.364 

Node number 11487: 29 observations
  predicted class=Meaningful emp MN  expected loss=0.2068966  P(node) =0.007396072
    class counts:     6    23
   probabilities: 0.207 0.793 

Node number 22970: 30 observations
  predicted class=Meaningful emp NE  expected loss=0.3333333  P(node) =0.007651109
    class counts:    20    10
   probabilities: 0.667 0.333 

Node number 22971: 105 observations,    complexity param=0.002140869
  predicted class=Meaningful emp MN  expected loss=0.4857143  P(node) =0.02677888
    class counts:    51    54
   probabilities: 0.486 0.514 
  left son=45942 (23 obs) right son=45943 (82 obs)
  Primary splits:
      cte.achievement         splits as  RLR,      improve=1.6321160, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.6722222, (33 missing)
      ACTCompositeScore       &lt; 20.5 to the left,  improve=0.3925037, (8 missing)
      total.cte.courses.taken &lt; 0.5  to the left,  improve=0.3452547, (0 missing)
      ps.grad.location        splits as  -L-RLR,   improve=0.3266667, (30 missing)

Node number 45942: 23 observations
  predicted class=Meaningful emp NE  expected loss=0.3478261  P(node) =0.005865851
    class counts:    15     8
   probabilities: 0.652 0.348 

Node number 45943: 82 observations
  predicted class=Meaningful emp MN  expected loss=0.4390244  P(node) =0.02091303
    class counts:    36    46
   probabilities: 0.439 0.561 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp MN grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] highest.cred.level        MCA.M                    
 [7] ps.grad                   ps.grad.InstitutionSector
 [9] ps.grad.location          pseo.participant         
[11] RaceEthnicity             took.ACT                 
[13] total.cte.courses.taken  

Root node error: 1557/3921 = 0.39709

n= 3921 

          CP nsplit rel error  xerror     xstd
1  0.1194605      0   1.00000 1.00000 0.019678
2  0.0064226      1   0.88054 0.88054 0.019178
3  0.0044958      5   0.85228 0.87604 0.019155
4  0.0038536      7   0.84329 0.88568 0.019204
5  0.0034254      8   0.83943 0.88311 0.019191
6  0.0025690     11   0.82916 0.87669 0.019158
7  0.0024406     16   0.81631 0.87476 0.019149
8  0.0022479     23   0.79705 0.87412 0.019145
9  0.0021409     25   0.79255 0.87669 0.019158
10 0.0019268     31   0.77970 0.87540 0.019152
11 0.0017662     33   0.77585 0.87347 0.019142</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp MN grad year 10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6442594</code></pre>
</div>
</div>
<p><br></p>
<p>The post-pruned tree has a bit more complexity and a bit higher accuracy.</p>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location: in region | Inside and outside region | Never attended ps | Outside region
<ul>
<li>In Minnesota: Meaningful emp in MN</li>
<li>Yes
<ul>
<li>highest.cred.level: associate degree | Less than Associate degree</li>
<li>MCA.M &lt; 3</li>
<li>ACTCompositeScore lower</li>
<li>Dem_Desc = Urban/town/rural mix</li>
<li>economic.status = 0</li>
<li>cte engagement</li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ACTCompositeScore</li>
<li>Dem_Desc</li>
<li>MCA.M</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>Not as importance
<ul>
<li>took.ACT</li>
<li>cte.achievement</li>
<li>MCA.R</li>
<li>ps.grad</li>
<li>economic.status</li>
<li>RaceEthnicity</li>
<li>pseo.participant</li>
<li>SpecialEdStatus</li>
</ul></li>
<li>Missing
<ul>
<li>range.school</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
              109.0490601                48.1628224                43.2073945 
        ACTCompositeScore                  Dem_Desc                     MCA.M 
               25.7361883                15.7264619                15.0910357 
  total.cte.courses.taken                  took.ACT           cte.achievement 
               15.0315821                 9.6869226                 8.5427607 
                    MCA.R                   ps.grad           economic.status 
                8.2302824                 7.9910890                 6.3951588 
            RaceEthnicity          pseo.participant           SpecialEdStatus 
                3.6682401                 3.5725382                 2.8186945 
             range.school           english.learner 
                0.2218276                 0.2190529 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.mn.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance meaningful emp NE grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The post-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.6014277        0.6609161         0.6442594</code></pre>
</div>
</div>
</section>
<section id="summary-2" class="level3">
<h3 class="anchored" data-anchor-id="summary-2">Summary</h3>
<p>The pre- and post-pruned trees provided better accuracy than the base model so let’s use the most important variables from both.</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
</ul></li>
<li>Not as importance
<ul>
<li>MCA.M</li>
<li>ACTCompositeScore</li>
<li>MCA.R</li>
<li>Dem_Desc</li>
<li>economic.status</li>
<li>took.ACT</li>
<li>ps.grad</li>
<li>SpecialEdStatus</li>
<li>cte.achievement</li>
<li>total.cte.courses.taken</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>range.school</li>
<li>pseo.participant</li>
<li>english.learner</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="important-variables-through-time" class="level2">
<h2 class="anchored" data-anchor-id="important-variables-through-time">Important variables through time</h2>
<p>The following table provides the level of important for each grad.year.x in the above analysis. Here are the primary themes;</p>
<ul>
<li>Variables that are important one year after graduation are less so in the following years. A few to just avoid because they don’t do much after one year;
<ul>
<li>grad.year.covid</li>
<li>ps.grad (interesting)</li>
</ul></li>
<li>There are two variables that are important five and ten years after graduating high school;
<ul>
<li>ps.grad.location</li>
<li>highest.cred.earned</li>
</ul></li>
<li>A couple of variables that stay either important or less so throughout the years
<ul>
<li>MCA.M</li>
<li>Dem_Desc</li>
<li>RaceEthnicity</li>
<li>cte.achievement</li>
<li>ACTCompositeScore</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>Variables that had some importance five and ten years after graduating high school
<ul>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>MCA.R</li>
</ul></li>
</ul>
<p>The variables to keep by group are;</p>
<ul>
<li>Demographics
<ul>
<li><del>grad.year.covid</del></li>
<li>economic.status</li>
<li>RaceEthnicity</li>
<li>SpecialEdStatus</li>
<li><del>english.learner</del></li>
</ul></li>
<li>CTE engagement
<ul>
<li>cte.achievement</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>HS Characteristics
<ul>
<li>Dem_Desc</li>
<li><del>range.school</del></li>
</ul></li>
<li>Prep for PS
<ul>
<li><del>pseo.participant</del></li>
<li>MCA.M</li>
<li>MCA.R</li>
<li><del>MCA.S</del></li>
<li>ACTCompositeScore</li>
<li>took.act</li>
</ul></li>
<li>Post-secondary path
<ul>
<li><del>ps.grad</del></li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad.location</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-1f3323fd58c1662781ab" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1f3323fd58c1662781ab">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;grad.year.covid&quot;,&quot;economic.status&quot;,&quot;range.school&quot;,&quot;pseo.participant&quot;,&quot;SpecialEdStatus&quot;,&quot;RaceEthnicity&quot;,&quot;Dem_Desc&quot;,&quot;took.ACT&quot;,&quot;cte.achievement&quot;,&quot;english.learner&quot;,&quot;ps.grad&quot;,&quot;ps.grad.InstitutionSector&quot;,&quot;highest.cred.level&quot;,&quot;ps.grad.location&quot;,&quot;ACTCompositeScore&quot;,&quot;MCA.M&quot;,&quot;MCA.R&quot;,&quot;MCA.S&quot;,&quot;total.cte.courses.taken&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["grad.year.covid","economic.status","range.school","pseo.participant","SpecialEdStatus","RaceEthnicity","Dem_Desc","took.ACT","cte.achievement","english.learner","ps.grad","ps.grad.InstitutionSector","highest.cred.level","ps.grad.location","ACTCompositeScore","MCA.M","MCA.R","MCA.S","total.cte.courses.taken"],["Demographics","Demographics","HS Characteristics","Prep for PS","Demographics","Demographics","HS Characteristics","Prep for PS","CTE Engagement","Demographics","Post-secondary path","Post-secondary path","Post-secondary path","Post-secondary path","Prep for PS","Prep for PS","Prep for PS","Prep for PS","CTE Engagement"],["Less so","","","","","Less so","Important","","Less so","","Important","","","","Important","Less so","","Important","Important"],["","","","","Less so","Less so","Important","Less so","Less so","Less so","","Important","Important","Important","Less so","Important","Less so","Less so","Less so"],["","Less so","","","Less so","Less so","Less so","Less so","Less so","","Less so","","Important","Important","Less so","Less so","Less so","","Less so"]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>ind.var<\/th>\n      <th>var.group<\/th>\n      <th>year.one<\/th>\n      <th>year.five<\/th>\n      <th>year.ten<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"ind.var","targets":0},{"name":"var.group","targets":1},{"name":"year.one","targets":2},{"name":"year.five","targets":3},{"name":"year.ten","targets":4}],"pageLength":20,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,20,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="not-meaningful-or-attending-post-secondary-vs-meaningful-emp-in-ne" class="level1">
<h1>Not meaningful or attending post-secondary vs meaningful emp in NE</h1>
<p>This section will examine which variables seem to play a role in whether an individual has meaningful employment in the region, or in Minnesota.</p>
<p><br></p>
<section id="one-year-after-graduation-1" class="level2">
<h2 class="anchored" data-anchor-id="one-year-after-graduation-1">One year after graduation</h2>
<p>It probably doesn’t make sense to have a dataset with a bunch of post-secondary variables in it when exploring which variables make a difference in whether someone has meaningful workforce participation in the region one year after graduating high school. So, I’m going to delete all of them.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 10,053 individuals.The table below shows that a a minority of individuals have meaningful employment in the region - 42% compared to individuals with no meaningful employment and are not attending post-secondary.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ce6744ce8ca31c7f1dfe" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ce6744ce8ca31c7f1dfe">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","Not meaningful, not attending ps"],[4172,5881],["41.5%","58.5%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.1<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.1","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model-3" class="level3">
<h3 class="anchored" data-anchor-id="base-model-3">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(not.meaningful.emp.grad.year<span class="fl">.1</span>), <span class="fu">nrow</span>(not.meaningful.emp.grad.year<span class="fl">.1</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> not.meaningful.emp.grad.year<span class="fl">.1</span>[sample_ind,]</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> not.meaningful.emp.grad.year<span class="fl">.1</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is .96908 and the nsplit is 3.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot not meaningful emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore       cte.achievement         Dem_Desc               
 [4] economic.status         english.learner         grad.year.covid        
 [7] MCA.M                   MCA.R                   MCA.S                  
[10] pseo.participant        RaceEthnicity           range.school           
[13] SpecialEdStatus         took.ACT                total.cte.courses.taken

Root node error: 2943/7037 = 0.41822

n= 7037 

           CP nsplit rel error  xerror     xstd
1  1.0647e-02      0   1.00000 1.00000 0.014060
2  4.4173e-03      3   0.96806 0.96908 0.013994
3  2.7183e-03      5   0.95923 0.97723 0.014012
4  2.3785e-03      6   0.95651 0.97587 0.014009
5  2.0387e-03     15   0.93238 0.97859 0.014015
6  1.8688e-03     18   0.92627 0.98301 0.014025
7  1.8122e-03     21   0.92049 0.97825 0.014015
8  1.5857e-03     24   0.91505 0.97961 0.014018
9  1.3592e-03     27   0.91030 0.99049 0.014041
10 1.2621e-03     32   0.90350 0.99286 0.014046
11 1.1893e-03     41   0.89059 0.99796 0.014056
12 1.1326e-03     48   0.88107 0.99932 0.014059
13 1.0194e-03     51   0.87768 0.98641 0.014032
14 9.0610e-04     62   0.86646 0.98573 0.014031
15 8.4947e-04     66   0.86273 0.99286 0.014046
16 7.9284e-04     73   0.85661 0.99252 0.014045
17 6.7958e-04     98   0.82331 1.00510 0.014070
18 6.1162e-04    126   0.80258 1.00917 0.014078
19 5.9463e-04    135   0.79681 1.01393 0.014087
20 5.6632e-04    139   0.79443 1.01393 0.014087
21 5.4366e-04    147   0.78967 1.01699 0.014092
22 5.0968e-04    154   0.78525 1.01971 0.014097
23 4.7571e-04    182   0.77030 1.01937 0.014096
24 4.5305e-04    200   0.75807 1.01869 0.014095
25 3.3979e-04    220   0.74890 1.01869 0.014095
26 2.4271e-04    284   0.72647 1.01461 0.014088
27 2.2653e-04    291   0.72477 1.01597 0.014090
28 2.0387e-04    294   0.72409 1.01835 0.014095
29 1.6989e-04    299   0.72307 1.02888 0.014113
30 1.1326e-04    323   0.71899 1.03058 0.014116
31 9.7083e-05    335   0.71764 1.03296 0.014120
32 8.4947e-05    342   0.71696 1.03466 0.014122
33 0.0000e+00    350   0.71628 1.03534 0.014123</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot not meaningful emp grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>total.cte.courses.taken       ACTCompositeScore           RaceEthnicity 
              104.13988                97.52918                67.60029 
                  MCA.M         cte.achievement                   MCA.R 
               67.17753                64.55477                64.51140 
        economic.status         SpecialEdStatus                   MCA.S 
               48.74325                45.58610                43.82920 
               Dem_Desc                took.ACT         grad.year.covid 
               35.19462                34.62668                32.15907 
           range.school        pseo.participant         english.learner 
               26.79985                26.71818                16.58760 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance not meaningful emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5636605</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-3" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-3">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 503</li>
<li>minbucket: round(minsplit / 3) which is 168</li>
</ul>
<p>Unfortunately, these parameters produced a tree with zero splits. So the new parameters are the following;</p>
<ul>
<li>maxdepth: 6</li>
<li>minsplit:</li>
<li>minbuck: eliminated</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">1.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.1</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">503</span>, <span class="at">minbucket =</span> <span class="dv">168</span>))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6014589</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .6014589 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot not meaningful emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 503, 
        minbucket = 168))

Variables actually used in tree construction:
[1] ACTCompositeScore       economic.status         MCA.M                  
[4] RaceEthnicity           range.school            SpecialEdStatus        
[7] total.cte.courses.taken

Root node error: 2943/7037 = 0.41822

n= 7037 

          CP nsplit rel error  xerror     xstd
1 0.01064673      0   1.00000 1.00000 0.014060
2 0.00373768      3   0.96806 0.97384 0.014005
3 0.00169895      4   0.96432 0.97825 0.014015
4 0.00033979      7   0.95923 0.98063 0.014020
5 0.00000000      9   0.95855 0.98403 0.014027</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>SpecialEdStatus = 0
<ul>
<li>No: significantly more likely to not have meaningful employment or in post-secondary</li>
<li>Yes:
<ul>
<li><p>Meaningful emp in NE: range.school, economic.status = 0, total.cte.courses.taken &gt; 4</p></li>
<li><p>Not meaningful: non-white, took less cte courses, not a range school</p></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>SpecialEdStatus</li>
<li>ACTCompositeScore</li>
<li>economic.status</li>
<li>range.school</li>
<li>MCA.M</li>
<li>english.learner</li>
<li>RaceEthnicity</li>
<li>total.cte.courses.taken</li>
<li>MCA.R</li>
</ul></li>
<li>Not as important
<ul>
<li>cte.achievement</li>
<li>Dem_Desc</li>
<li>took.ACT</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>pseo.participant</li>
</ul></li>
<li>MCA.S</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        SpecialEdStatus       ACTCompositeScore         economic.status 
             45.5861045              24.2031979              22.2419644 
           range.school                   MCA.M         english.learner 
             18.2452911              11.9429429              11.4979942 
          RaceEthnicity total.cte.courses.taken                   MCA.R 
              9.9276997               6.8210188               5.3625774 
        cte.achievement                Dem_Desc                took.ACT 
              1.5000314               0.4516907               0.3927106 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance not meaningful emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-3" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-3">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 7037 

           CP nsplit rel error    xerror       xstd
1 0.010646732      0 1.0000000 1.0000000 0.01405999
2 0.004417261      3 0.9680598 0.9690792 0.01399389

Variable importance
  SpecialEdStatus ACTCompositeScore      range.school   english.learner 
               45                24                18                11 
            MCA.R 
                2 

Node number 1: 7037 observations,    complexity param=0.01064673
  predicted class=Not meaningful, not attending ps  expected loss=0.418218  P(node) =1
    class counts:  2943  4094
   probabilities: 0.418 0.582 
  left son=2 (5636 obs) right son=3 (1401 obs)
  Primary splits:
      SpecialEdStatus   splits as  LR,       improve=45.58610, (0 missing)
      ACTCompositeScore &lt; 25.5 to the left,  improve=22.45535, (3779 missing)
      range.school      splits as  RL,       improve=19.70299, (0 missing)
      english.learner   splits as  LR,       improve=19.02168, (0 missing)
      RaceEthnicity     splits as  RRRRLL,   improve=17.59895, (0 missing)
  Surrogate splits:
      english.learner splits as  LR,       agree=0.848, adj=0.236, (0 split)
      MCA.R           &lt; 1.5  to the right, agree=0.809, adj=0.039, (0 split)

Node number 2: 5636 observations,    complexity param=0.01064673
  predicted class=Not meaningful, not attending ps  expected loss=0.4465933  P(node) =0.8009095
    class counts:  2517  3119
   probabilities: 0.447 0.553 
  left son=4 (5177 obs) right son=5 (459 obs)
  Primary splits:
      ACTCompositeScore       &lt; 25.5 to the left,  improve=24.20320, (2645 missing)
      range.school            splits as  RL,       improve=19.17389, (0 missing)
      total.cte.courses.taken &lt; 3.5  to the right, improve=15.08633, (0 missing)
      RaceEthnicity           splits as  LRRRLL,   improve=12.64518, (0 missing)
      cte.achievement         splits as  LRR,      improve=11.27960, (0 missing)

Node number 3: 1401 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3040685  P(node) =0.1990905
    class counts:   426   975
   probabilities: 0.304 0.696 

Node number 4: 5177 observations,    complexity param=0.01064673
  predicted class=Not meaningful, not attending ps  expected loss=0.4606915  P(node) =0.7356828
    class counts:  2385  2792
   probabilities: 0.461 0.539 
  left son=8 (894 obs) right son=9 (4283 obs)
  Primary splits:
      range.school            splits as  RL,       improve=18.245290, (0 missing)
      RaceEthnicity           splits as  LRRRLL,   improve=14.332010, (0 missing)
      total.cte.courses.taken &lt; 3.5  to the right, improve= 9.674929, (0 missing)
      cte.achievement         splits as  LRR,      improve= 6.463486, (0 missing)
      Dem_Desc                splits as  RLL,      improve= 6.281663, (0 missing)

Node number 5: 459 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.2875817  P(node) =0.06522666
    class counts:   132   327
   probabilities: 0.288 0.712 

Node number 8: 894 observations
  predicted class=Meaningful emp NE                 expected loss=0.4474273  P(node) =0.1270428
    class counts:   494   400
   probabilities: 0.553 0.447 

Node number 9: 4283 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.441513  P(node) =0.60864
    class counts:  1891  2392
   probabilities: 0.442 0.558 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning not meaningful emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
[1] ACTCompositeScore range.school      SpecialEdStatus  

Root node error: 2943/7037 = 0.41822

n= 7037 

         CP nsplit rel error  xerror     xstd
1 0.0106467      0   1.00000 1.00000 0.014060
2 0.0044173      3   0.96806 0.96908 0.013994</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning not meaningful emp grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.596817</code></pre>
</div>
</div>
<p><br></p>
<p>We now have a very simple tree, that might be a little too simple.</p>
<p>The tree nodes provide the following;</p>
<ul>
<li>SpecialEdStatus = 0
<ul>
<li>No: not meaningful employment</li>
<li>Yes:
<ul>
<li>Meaningful emp: is a range.school | lower ACTComposite Score</li>
<li>Not meaningful emp: not a range school | higher ACTCompositeScore</li>
</ul></li>
</ul></li>
</ul>
<p>It tells me the following;</p>
<ul>
<li>Most important
<ul>
<li>SpecialEdStatus</li>
<li>ACTCompositeScore</li>
<li>range.school</li>
<li>english.learner</li>
</ul></li>
<li>Less important
<ul>
<li>MCA.R</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>pseo.participant</li>
<li>RaceEthnicity</li>
<li>Dem_Desc</li>
<li>took.ACT</li>
<li>cte.achievement</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>MCA.S</li>
<li>total.cte.courses.taken</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  SpecialEdStatus ACTCompositeScore      range.school   english.learner 
        45.586105         24.203198         18.245291         10.737626 
            MCA.R 
         1.789604 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance not meaningful emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The post-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.5636605        0.6014589          0.596817</code></pre>
</div>
</div>
</section>
<section id="summary-3" class="level3">
<h3 class="anchored" data-anchor-id="summary-3">Summary</h3>
<p>The pre- and post-pruned trees provided better accuracy than the base model so let’s use the most important variables from both.</p>
<ul>
<li>Most important
<ul>
<li>SpecialEdStatus</li>
<li>ACTCompositeScore</li>
<li>range.school</li>
<li>english.learner</li>
</ul></li>
<li>Less important
<ul>
<li>MCA.R</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>pseo.participant</li>
<li>RaceEthnicity</li>
<li>Dem_Desc</li>
<li>took.ACT</li>
<li>cte.achievement</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>MCA.S</li>
<li>total.cte.courses.taken</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="five-year-after-graduation" class="level2">
<h2 class="anchored" data-anchor-id="five-year-after-graduation">Five year after graduation</h2>
<p>We are now five years away from graduating high school, so we can add the post-secondary variables back in.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 9,951 individuals.The table below shows that a majority of individuals have meaningful employment in the region - 55% compared to individuals with no meaningful employment and are not attending post-secondary.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8ccc978220770983a5a9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8ccc978220770983a5a9">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","Not meaningful, not attending ps"],[5491,4460],["55.2%","44.8%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.5<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.5","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model-4" class="level3">
<h3 class="anchored" data-anchor-id="base-model-4">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(not.meaningful.emp.grad.year<span class="fl">.5</span>), <span class="fu">nrow</span>(not.meaningful.emp.grad.year<span class="fl">.5</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> not.meaningful.emp.grad.year<span class="fl">.5</span>[sample_ind,]</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> not.meaningful.emp.grad.year<span class="fl">.5</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is .0.86710 and the nsplit is 25.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot not meaningful emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] english.learner           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 3100/6965 = 0.44508

n= 6965 

           CP nsplit rel error  xerror     xstd
1  4.7097e-02      0   1.00000 1.00000 0.013379
2  1.7742e-02      2   0.90581 0.90581 0.013206
3  1.0323e-02      3   0.88806 0.90516 0.013204
4  7.7419e-03      4   0.87774 0.89710 0.013185
5  5.3226e-03      5   0.87000 0.89194 0.013172
6  4.1935e-03      7   0.85935 0.87742 0.013134
7  3.2258e-03      8   0.85516 0.87968 0.013140
8  2.9032e-03      9   0.85194 0.87806 0.013136
9  2.5806e-03     11   0.84613 0.87742 0.013134
10 2.3656e-03     12   0.84355 0.87226 0.013120
11 1.7204e-03     15   0.83645 0.86839 0.013109
12 1.6129e-03     25   0.81290 0.86710 0.013106
13 1.4516e-03     30   0.80452 0.87129 0.013117
14 1.2903e-03     39   0.79065 0.87645 0.013132
15 1.1290e-03     45   0.78290 0.87806 0.013136
16 9.6774e-04     47   0.78065 0.87774 0.013135
17 8.0645e-04     55   0.77258 0.88194 0.013146
18 7.0968e-04     73   0.75677 0.89387 0.013177
19 6.4516e-04     91   0.74258 0.90032 0.013193
20 5.5300e-04    116   0.72516 0.90387 0.013201
21 5.3763e-04    125   0.72000 0.90742 0.013210
22 4.8387e-04    134   0.71484 0.90871 0.013213
23 4.3011e-04    168   0.69677 0.91000 0.013216
24 4.0323e-04    193   0.68484 0.91935 0.013237
25 3.8710e-04    203   0.68032 0.92290 0.013245
26 3.2258e-04    209   0.67774 0.93387 0.013268
27 2.8226e-04    273   0.65548 0.93484 0.013270
28 2.4194e-04    281   0.65323 0.94613 0.013292
29 2.1505e-04    291   0.65032 0.94452 0.013289
30 1.6129e-04    307   0.64677 0.94484 0.013290
31 1.2903e-04    327   0.64355 0.95323 0.013305
32 1.0753e-04    333   0.64258 0.95968 0.013317
33 8.0645e-05    345   0.64129 0.95968 0.013317
34 6.4516e-05    349   0.64097 0.96032 0.013318
35 5.3763e-05    354   0.64065 0.95935 0.013316
36 0.0000e+00    360   0.64032 0.95935 0.013316</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot not meaningful emp grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector   total.cte.courses.taken 
                174.93121                 144.72134                 128.98736 
       highest.cred.level                   ps.grad         ACTCompositeScore 
                126.21232                 113.92650                  93.59391 
          cte.achievement                     MCA.R                     MCA.M 
                 84.58867                  70.60981                  67.54242 
                    MCA.S                  Dem_Desc                  took.ACT 
                 52.09640                  44.71458                  37.11547 
            RaceEthnicity              range.school          pseo.participant 
                 35.28025                  34.23343                  32.25957 
          SpecialEdStatus           economic.status           english.learner 
                 28.09539                  26.90555                  15.42701 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance not meaningful emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5770261</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-4" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-4">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 498</li>
<li>minbucket: round(minsplit / 3) which is 166</li>
</ul>
<p>Unfortunately, these parameters produced a tree with zero splits. So the new parameters are the following;</p>
<ul>
<li>maxdepth: 6</li>
<li>minsplit:</li>
<li>minbuck: eliminated</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">5.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.5</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">498</span>, <span class="at">minbucket =</span> <span class="dv">166</span>))</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6141996</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .6014589 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot not meaningful emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 498, 
        minbucket = 166))

Variables actually used in tree construction:
 [1] ACTCompositeScore         Dem_Desc                 
 [3] economic.status           MCA.M                    
 [5] ps.grad.InstitutionSector ps.grad.location         
 [7] RaceEthnicity             SpecialEdStatus          
 [9] took.ACT                  total.cte.courses.taken  

Root node error: 3100/6965 = 0.44508

n= 6965 

         CP nsplit rel error  xerror     xstd
1 0.0470968      0   1.00000 1.00000 0.013379
2 0.0177419      2   0.90581 0.90581 0.013206
3 0.0103226      3   0.88806 0.89968 0.013191
4 0.0090323      4   0.87774 0.89516 0.013180
5 0.0074194      5   0.86871 0.88968 0.013166
6 0.0022581      6   0.86129 0.87355 0.013124
7 0.0000000     10   0.85226 0.88000 0.013141</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location = In region | Inside and outside region
<ul>
<li>Yes: Meaningful emp in NE</li>
<li>No:
<ul>
<li>Meaningful emp NE
<ul>
<li>total.cte.courses &gt;= 2
<ul>
<li>economic.status = 0
<ul>
<li>ps.grad.InstitutionSector = 11,4,Never attended ps</li>
</ul></li>
<li>economic.status = 1
<ul>
<li>SpecialEdStatus = 0</li>
<li>Dem_Desc = Urban/town/rural mix</li>
</ul></li>
</ul></li>
<li>total.cte.courses &lt; 2
<ul>
<li>ACTCompositeScore &lt; 22
<ul>
<li>RaceEthnicity = White
<ul>
<li>took.ACT = Yes
<ul>
<li>MCA.M &gt;= 3</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>total.cte.courses.taken</li>
<li>economic.status</li>
<li>cte.achievement</li>
<li>SpecialEdStatus</li>
</ul></li>
<li>Not as important
<ul>
<li>took.ACT</li>
<li>RaceEthnicity</li>
<li>ACTCompositeScore</li>
<li>range.school</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>Dem_Desc</li>
<li>english.learner</li>
<li>MCA.S</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>pseo.participant</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
               159.675260                112.985767                 99.585818 
                  ps.grad   total.cte.courses.taken           economic.status 
                97.991204                 24.226860                 15.913914 
          cte.achievement           SpecialEdStatus                  took.ACT 
                15.391610                 11.200349                  8.916616 
            RaceEthnicity         ACTCompositeScore              range.school 
                 7.768995                  7.730962                  7.500940 
                    MCA.M                     MCA.R                  Dem_Desc 
                 4.950333                  4.932128                  3.835782 
          english.learner                     MCA.S 
                 3.146354                  1.319057 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance not meaningful emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-4" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-4">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 6965 

            CP nsplit rel error    xerror       xstd
1  0.047096774      0 1.0000000 1.0000000 0.01337930
2  0.017741935      2 0.9058065 0.9058065 0.01320585
3  0.010322581      3 0.8880645 0.9051613 0.01320432
4  0.007741935      4 0.8777419 0.8970968 0.01318482
5  0.005322581      5 0.8700000 0.8919355 0.01317195
6  0.004193548      7 0.8593548 0.8774194 0.01313412
7  0.003225806      8 0.8551613 0.8796774 0.01314016
8  0.002903226      9 0.8519355 0.8780645 0.01313585
9  0.002580645     11 0.8461290 0.8774194 0.01313412
10 0.002365591     12 0.8435484 0.8722581 0.01312009
11 0.001720430     15 0.8364516 0.8683871 0.01310937
12 0.001612903     25 0.8129032 0.8670968 0.01310575

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       25                        19                        17 
                  ps.grad   total.cte.courses.taken         ACTCompositeScore 
                       15                         5                         3 
          cte.achievement           economic.status           SpecialEdStatus 
                        2                         2                         2 
            RaceEthnicity              range.school                  took.ACT 
                        2                         2                         2 
                    MCA.S           english.learner                     MCA.M 
                        2                         1                         1 
                    MCA.R                  Dem_Desc 
                        1                         1 

Node number 1: 6965 observations,    complexity param=0.04709677
  predicted class=Meaningful emp NE                 expected loss=0.4450826  P(node) =1
    class counts:  3865  3100
   probabilities: 0.555 0.445 
  left son=2 (2082 obs) right son=3 (4883 obs)
  Primary splits:
      ps.grad.location          splits as  RLRLRR, improve=156.45900, (1977 missing)
      ps.grad.InstitutionSector splits as  RLLRLR, improve=109.71230, (1977 missing)
      highest.cred.level        splits as  LRLLR,  improve= 83.52551, (1977 missing)
      ps.grad                   splits as  LRL,    improve= 64.13575, (0 missing)
      SpecialEdStatus           splits as  LR,     improve= 26.05682, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RLRLLR, agree=0.869, adj=0.683, (0 split)
      highest.cred.level        splits as  LLLLR,  agree=0.834, adj=0.599, (0 split)
      ps.grad                   splits as  -RL,    agree=0.831, adj=0.592, (1897 split)
      range.school              splits as  RL,     agree=0.606, adj=0.048, (80 split)
      took.ACT                  splits as  RL,     agree=0.591, adj=0.012, (0 split)

Node number 2: 2082 observations
  predicted class=Meaningful emp NE                 expected loss=0.2877041  P(node) =0.2989232
    class counts:  1483   599
   probabilities: 0.712 0.288 

Node number 3: 4883 observations,    complexity param=0.04709677
  predicted class=Not meaningful, not attending ps  expected loss=0.4878149  P(node) =0.7010768
    class counts:  2382  2501
   probabilities: 0.488 0.512 
  left son=6 (2737 obs) right son=7 (2146 obs)
  Primary splits:
      total.cte.courses.taken   &lt; 1.5  to the right, improve=23.88325, (0 missing)
      cte.achievement           splits as  LLR,      improve=18.09449, (0 missing)
      ACTCompositeScore         &lt; 21.5 to the left,  improve=15.92893, (2474 missing)
      ps.grad.InstitutionSector splits as  RLLRLR,   improve=13.51968, (1960 missing)
      RaceEthnicity             splits as  RRRRL,    improve=11.78986, (0 missing)
  Surrogate splits:
      cte.achievement splits as  LLR, agree=0.843, adj=0.643, (0 split)
      took.ACT        splits as  LR,  agree=0.584, adj=0.053, (0 split)
      ps.grad         splits as  LLR, agree=0.571, adj=0.023, (0 split)

Node number 6: 2737 observations,    complexity param=0.01774194
  predicted class=Meaningful emp NE                 expected loss=0.4683961  P(node) =0.3929648
    class counts:  1455  1282
   probabilities: 0.532 0.468 
  left son=12 (1446 obs) right son=13 (1291 obs)
  Primary splits:
      economic.status           splits as  LR,     improve=13.679190, (0 missing)
      SpecialEdStatus           splits as  LR,     improve=11.750130, (0 missing)
      english.learner           splits as  LR,     improve= 8.167584, (0 missing)
      ps.grad.InstitutionSector splits as  RRLRLR, improve= 6.951758, (1134 missing)
      RaceEthnicity             splits as  RRRRL,  improve= 5.942864, (0 missing)
  Surrogate splits:
      SpecialEdStatus splits as  LR,       agree=0.602, adj=0.157, (0 split)
      took.ACT        splits as  RL,       agree=0.602, adj=0.156, (0 split)
      RaceEthnicity   splits as  RRRLL,    agree=0.584, adj=0.118, (0 split)
      english.learner splits as  LR,       agree=0.552, adj=0.051, (0 split)
      MCA.M           &lt; 2.5  to the right, agree=0.550, adj=0.045, (0 split)

Node number 7: 2146 observations,    complexity param=0.002903226
  predicted class=Not meaningful, not attending ps  expected loss=0.4319664  P(node) =0.308112
    class counts:   927  1219
   probabilities: 0.432 0.568 
  left son=14 (2082 obs) right son=15 (64 obs)
  Primary splits:
      ACTCompositeScore         &lt; 30.5 to the left,  improve=8.933002, (885 missing)
      ps.grad.InstitutionSector splits as  RLLRLR,   improve=7.311585, (826 missing)
      highest.cred.level        splits as  RRRLR,    improve=6.686741, (826 missing)
      RaceEthnicity             splits as  LRRRL,    improve=6.076285, (0 missing)
      ps.grad.location          splits as  R-L-LL,   improve=3.542691, (826 missing)

Node number 12: 1446 observations,    complexity param=0.007741935
  predicted class=Meaningful emp NE                 expected loss=0.4211618  P(node) =0.2076095
    class counts:   837   609
   probabilities: 0.579 0.421 
  left son=24 (1340 obs) right son=25 (106 obs)
  Primary splits:
      MCA.S                     &lt; 3.5  to the left,  improve=9.601854, (291 missing)
      ps.grad.InstitutionSector splits as  RRLRLL,   improve=6.154202, (609 missing)
      ACTCompositeScore         &lt; 27.5 to the left,  improve=5.368085, (694 missing)
      highest.cred.level        splits as  LRLRL,    improve=5.272169, (609 missing)
      total.cte.courses.taken   &lt; 8.5  to the right, improve=4.934215, (0 missing)

Node number 13: 1291 observations,    complexity param=0.01032258
  predicted class=Not meaningful, not attending ps  expected loss=0.4786987  P(node) =0.1853553
    class counts:   618   673
   probabilities: 0.479 0.521 
  left son=26 (890 obs) right son=27 (401 obs)
  Primary splits:
      SpecialEdStatus splits as  LR,       improve=8.841364, (0 missing)
      english.learner splits as  LR,       improve=7.711069, (0 missing)
      MCA.S           &lt; 1.5  to the right, improve=4.874203, (264 missing)
      took.ACT        splits as  RL,       improve=3.666930, (0 missing)
      MCA.R           &lt; 2.5  to the right, improve=2.450272, (61 missing)
  Surrogate splits:
      english.learner         splits as  LR,       agree=0.773, adj=0.269, (0 split)
      MCA.R                   &lt; 1.5  to the right, agree=0.743, adj=0.172, (0 split)
      total.cte.courses.taken &lt; 13.5 to the left,  agree=0.690, adj=0.002, (0 split)

Node number 14: 2082 observations,    complexity param=0.002903226
  predicted class=Not meaningful, not attending ps  expected loss=0.4394813  P(node) =0.2989232
    class counts:   915  1167
   probabilities: 0.439 0.561 
  left son=28 (86 obs) right son=29 (1996 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RLLRLR,   improve=6.738834, (810 missing)
      highest.cred.level        splits as  RRRLR,    improve=6.435768, (810 missing)
      RaceEthnicity             splits as  LRRRL,    improve=6.345920, (0 missing)
      ACTCompositeScore         &lt; 21.5 to the left,  improve=4.716332, (885 missing)
      ps.grad.location          splits as  R-L-LL,   improve=2.697296, (810 missing)
  Surrogate splits:
      highest.cred.level splits as  LRLRR,  agree=0.968, adj=0.523, (0 split)
      ps.grad.location   splits as  R-L-RR, agree=0.934, adj=0.023, (0 split)

Node number 15: 64 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.1875  P(node) =0.009188801
    class counts:    12    52
   probabilities: 0.188 0.812 

Node number 24: 1340 observations,    complexity param=0.004193548
  predicted class=Meaningful emp NE                 expected loss=0.4059701  P(node) =0.1923905
    class counts:   796   544
   probabilities: 0.594 0.406 
  left son=48 (1317 obs) right son=49 (23 obs)
  Primary splits:
      ACTCompositeScore         &lt; 27.5 to the left,  improve=5.742667, (674 missing)
      total.cte.courses.taken   &lt; 8.5  to the right, improve=5.596547, (0 missing)
      ps.grad.InstitutionSector splits as  RRLRLL,   improve=5.268229, (572 missing)
      RaceEthnicity             splits as  RRLRL,    improve=4.450670, (0 missing)
      highest.cred.level        splits as  LRLRL,    improve=4.336620, (572 missing)

Node number 25: 106 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3867925  P(node) =0.01521895
    class counts:    41    65
   probabilities: 0.387 0.613 

Node number 26: 890 observations,    complexity param=0.005322581
  predicted class=Meaningful emp NE                 expected loss=0.4820225  P(node) =0.1277818
    class counts:   461   429
   probabilities: 0.518 0.482 
  left son=52 (879 obs) right son=53 (11 obs)
  Primary splits:
      english.learner           splits as  LR,       improve=4.062738, (0 missing)
      Dem_Desc                  splits as  RRL,      improve=3.835782, (0 missing)
      ps.grad.InstitutionSector splits as  RRLRLL,   improve=2.688960, (391 missing)
      highest.cred.level        splits as  RRL-L,    improve=2.368260, (391 missing)
      MCA.S                     &lt; 2.5  to the right, improve=1.990246, (156 missing)

Node number 27: 401 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3915212  P(node) =0.05757358
    class counts:   157   244
   probabilities: 0.392 0.608 

Node number 28: 86 observations
  predicted class=Meaningful emp NE                 expected loss=0.3953488  P(node) =0.01234745
    class counts:    52    34
   probabilities: 0.605 0.395 

Node number 29: 1996 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4323647  P(node) =0.2865757
    class counts:   863  1133
   probabilities: 0.432 0.568 
  left son=58 (1894 obs) right son=59 (102 obs)
  Primary splits:
      RaceEthnicity             splits as  LRRRL,    improve=6.043154, (0 missing)
      ps.grad.location          splits as  R-L-LL,   improve=5.997848, (810 missing)
      ps.grad                   splits as  LLR,      improve=4.786767, (0 missing)
      ACTCompositeScore         &lt; 21.5 to the left,  improve=4.318646, (853 missing)
      ps.grad.InstitutionSector splits as  L--R-L,   improve=3.530367, (810 missing)

Node number 48: 1317 observations,    complexity param=0.002365591
  predicted class=Meaningful emp NE                 expected loss=0.3993926  P(node) =0.1890883
    class counts:   791   526
   probabilities: 0.601 0.399 
  left son=96 (61 obs) right son=97 (1256 obs)
  Primary splits:
      total.cte.courses.taken   &lt; 8.5  to the right, improve=5.254607, (0 missing)
      ps.grad.InstitutionSector splits as  RRLLLL,   improve=4.366807, (566 missing)
      RaceEthnicity             splits as  RLLRL,    improve=4.297852, (0 missing)
      highest.cred.level        splits as  LRLRL,    improve=3.372267, (566 missing)
      MCA.M                     &lt; 1.5  to the right, improve=2.536440, (26 missing)

Node number 49: 23 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.2173913  P(node) =0.003302225
    class counts:     5    18
   probabilities: 0.217 0.783 

Node number 52: 879 observations,    complexity param=0.005322581
  predicted class=Meaningful emp NE                 expected loss=0.476678  P(node) =0.1262024
    class counts:   460   419
   probabilities: 0.523 0.477 
  left son=104 (551 obs) right son=105 (328 obs)
  Primary splits:
      Dem_Desc                  splits as  RRL,      improve=3.755787, (0 missing)
      ps.grad.InstitutionSector splits as  RRLRLL,   improve=2.928444, (389 missing)
      highest.cred.level        splits as  RRL-L,    improve=2.609595, (389 missing)
      total.cte.courses.taken   &lt; 3.5  to the right, improve=1.863338, (0 missing)
      RaceEthnicity             splits as  RLRLR,    improve=1.770728, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 6.5  to the left,  agree=0.656, adj=0.079, (0 split)
      ps.grad                 splits as  LLR,      agree=0.636, adj=0.024, (0 split)

Node number 53: 11 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.09090909  P(node) =0.001579325
    class counts:     1    10
   probabilities: 0.091 0.909 

Node number 58: 1894 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4413939  P(node) =0.2719311
    class counts:   836  1058
   probabilities: 0.441 0.559 
  left son=116 (1731 obs) right son=117 (163 obs)
  Primary splits:
      ps.grad.location          splits as  R-L-LL,   improve=6.626738, (764 missing)
      ps.grad                   splits as  LLR,      improve=5.401454, (0 missing)
      ACTCompositeScore         &lt; 21.5 to the left,  improve=5.170165, (807 missing)
      ps.grad.InstitutionSector splits as  L--R-L,   improve=3.848178, (764 missing)
      highest.cred.level        splits as  LRRLL,    improve=3.165456, (764 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  L--R-L, agree=0.904, adj=0.337, (0 split)
      highest.cred.level        splits as  RRRLL,  agree=0.872, adj=0.110, (0 split)
      ps.grad                   splits as  -LR,    agree=0.866, adj=0.074, (743 split)

Node number 59: 102 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.2647059  P(node) =0.01464465
    class counts:    27    75
   probabilities: 0.265 0.735 

Node number 96: 61 observations
  predicted class=Meaningful emp NE                 expected loss=0.1967213  P(node) =0.008758076
    class counts:    49    12
   probabilities: 0.803 0.197 

Node number 97: 1256 observations,    complexity param=0.002365591
  predicted class=Meaningful emp NE                 expected loss=0.4092357  P(node) =0.1803302
    class counts:   742   514
   probabilities: 0.591 0.409 
  left son=194 (1193 obs) right son=195 (63 obs)
  Primary splits:
      RaceEthnicity             splits as  RLLRL,    improve=4.206117, (0 missing)
      ps.grad.InstitutionSector splits as  RRLLLL,   improve=3.687565, (546 missing)
      highest.cred.level        splits as  LRLRL,    improve=2.705542, (546 missing)
      ACTCompositeScore         &lt; 15.5 to the left,  improve=2.624086, (635 missing)
      MCA.M                     &lt; 1.5  to the right, improve=2.521930, (26 missing)

Node number 104: 551 observations,    complexity param=0.003225806
  predicted class=Meaningful emp NE                 expected loss=0.4410163  P(node) =0.07910983
    class counts:   308   243
   probabilities: 0.559 0.441 
  left son=208 (527 obs) right son=209 (24 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RRRRLL,   improve=3.394426, (260 missing)
      total.cte.courses.taken   &lt; 3.5  to the right, improve=3.160325, (0 missing)
      highest.cred.level        splits as  RRL-L,    improve=2.607570, (260 missing)
      ps.grad.location          splits as  R-R-LL,   improve=2.298088, (260 missing)
      RaceEthnicity             splits as  RLRLR,    improve=1.846643, (0 missing)
  Surrogate splits:
      highest.cred.level splits as  RRL-L,  agree=0.986, adj=0.833, (0 split)
      ps.grad            splits as  -LR,    agree=0.942, adj=0.292, (254 split)
      ps.grad.location   splits as  R-R-LL, agree=0.942, adj=0.292, (0 split)

Node number 105: 328 observations,    complexity param=0.002580645
  predicted class=Not meaningful, not attending ps  expected loss=0.4634146  P(node) =0.04709261
    class counts:   152   176
   probabilities: 0.463 0.537 
  left son=210 (16 obs) right son=211 (312 obs)
  Primary splits:
      highest.cred.level        splits as  RRL-R,    improve=3.981952, (129 missing)
      ps.grad.InstitutionSector splits as  R-LRLR,   improve=3.434030, (129 missing)
      MCA.R                     &lt; 2.5  to the right, improve=3.306763, (4 missing)
      ACTCompositeScore         &lt; 21.5 to the left,  improve=1.748553, (196 missing)
      Dem_Desc                  splits as  RL-,      improve=1.329763, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  R-LRLR,   agree=0.97, adj=0.571, (0 split)
      total.cte.courses.taken   &lt; 11.5 to the right, agree=0.94, adj=0.143, (129 split)

Node number 116: 1731 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4569613  P(node) =0.2485284
    class counts:   791   940
   probabilities: 0.457 0.543 
  left son=232 (930 obs) right son=233 (801 obs)
  Primary splits:
      took.ACT           splits as  RL,       improve=4.766690, (0 missing)
      SpecialEdStatus    splits as  LR,       improve=3.300449, (0 missing)
      highest.cred.level splits as  LRRLR,    improve=3.192010, (764 missing)
      english.learner    splits as  LR,       improve=2.605296, (0 missing)
      MCA.S              &lt; 1.5  to the right, improve=2.418556, (460 missing)
  Surrogate splits:
      economic.status splits as  LR,       agree=0.674, adj=0.296, (0 split)
      MCA.M           &lt; 2.5  to the right, agree=0.667, adj=0.281, (0 split)
      SpecialEdStatus splits as  LR,       agree=0.653, adj=0.250, (0 split)
      MCA.R           &lt; 3.5  to the right, agree=0.642, adj=0.227, (0 split)
      cte.achievement splits as  RLL,      agree=0.568, adj=0.066, (0 split)

Node number 117: 163 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.2760736  P(node) =0.02340273
    class counts:    45   118
   probabilities: 0.276 0.724 

Node number 194: 1193 observations,    complexity param=0.002365591
  predicted class=Meaningful emp NE                 expected loss=0.3998324  P(node) =0.171285
    class counts:   716   477
   probabilities: 0.600 0.400 
  left son=388 (1066 obs) right son=389 (127 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RRLLLL,   improve=4.612202, (515 missing)
      highest.cred.level        splits as  LRLRL,    improve=3.542117, (515 missing)
      MCA.M                     &lt; 2.5  to the right, improve=2.099691, (26 missing)
      ACTCompositeScore         &lt; 17.5 to the left,  improve=2.005472, (604 missing)
      ps.grad                   splits as  RLR,      improve=1.790403, (0 missing)
  Surrogate splits:
      highest.cred.level splits as  LRLRL,  agree=0.972, adj=0.850, (0 split)
      ps.grad.location   splits as  L-R-LR, agree=0.883, adj=0.378, (0 split)
      ps.grad            splits as  -LR,    agree=0.848, adj=0.189, (498 split)

Node number 195: 63 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.4126984  P(node) =0.009045226
    class counts:    26    37
   probabilities: 0.413 0.587 

Node number 208: 527 observations
  predicted class=Meaningful emp NE                 expected loss=0.4288425  P(node) =0.07566403
    class counts:   301   226
   probabilities: 0.571 0.429 

Node number 209: 24 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.2916667  P(node) =0.0034458
    class counts:     7    17
   probabilities: 0.292 0.708 

Node number 210: 16 observations
  predicted class=Meaningful emp NE                 expected loss=0.25  P(node) =0.0022972
    class counts:    12     4
   probabilities: 0.750 0.250 

Node number 211: 312 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.4487179  P(node) =0.04479541
    class counts:   140   172
   probabilities: 0.449 0.551 

Node number 232: 930 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4913978  P(node) =0.1335248
    class counts:   457   473
   probabilities: 0.491 0.509 
  left son=464 (8 obs) right son=465 (922 obs)
  Primary splits:
      highest.cred.level splits as  LRRLR,    improve=2.746997, (443 missing)
      english.learner    splits as  LR,       improve=2.183014, (0 missing)
      range.school       splits as  RL,       improve=2.158483, (0 missing)
      MCA.R              &lt; 2.5  to the right, improve=2.115032, (18 missing)
      ACTCompositeScore  &lt; 21.5 to the left,  improve=1.875989, (0 missing)
  Surrogate splits:
      ps.grad.location splits as  --L-RR, agree=0.986, adj=0.125, (0 split)

Node number 233: 801 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.4169788  P(node) =0.1150036
    class counts:   334   467
   probabilities: 0.417 0.583 

Node number 388: 1066 observations
  predicted class=Meaningful emp NE                 expected loss=0.3827392  P(node) =0.153051
    class counts:   658   408
   probabilities: 0.617 0.383 

Node number 389: 127 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.4566929  P(node) =0.01823403
    class counts:    58    69
   probabilities: 0.457 0.543 

Node number 464: 8 observations
  predicted class=Meaningful emp NE                 expected loss=0.125  P(node) =0.0011486
    class counts:     7     1
   probabilities: 0.875 0.125 

Node number 465: 922 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4880694  P(node) =0.1323762
    class counts:   450   472
   probabilities: 0.488 0.512 
  left son=930 (908 obs) right son=931 (14 obs)
  Primary splits:
      english.learner   splits as  LR,       improve=2.1311710, (0 missing)
      MCA.R             &lt; 2.5  to the right, improve=2.0126980, (17 missing)
      range.school      splits as  RL,       improve=1.9364280, (0 missing)
      ACTCompositeScore &lt; 21.5 to the left,  improve=1.9199910, (0 missing)
      MCA.S             &lt; 1.5  to the right, improve=0.9874598, (170 missing)

Node number 930: 908 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4922907  P(node) =0.1303661
    class counts:   447   461
   probabilities: 0.492 0.508 
  left son=1860 (476 obs) right son=1861 (432 obs)
  Primary splits:
      ACTCompositeScore &lt; 21.5 to the left,  improve=2.4540060, (0 missing)
      range.school      splits as  RL,       improve=2.1743210, (0 missing)
      MCA.R             &lt; 1.5  to the left,  improve=1.4430240, (17 missing)
      ps.grad           splits as  LLR,      improve=1.1113620, (0 missing)
      cte.achievement   splits as  LLR,      improve=0.9101659, (0 missing)
  Surrogate splits:
      MCA.M           &lt; 3.5  to the left,  agree=0.671, adj=0.308, (0 split)
      MCA.R           &lt; 3.5  to the left,  agree=0.651, adj=0.266, (0 split)
      MCA.S           &lt; 2.5  to the left,  agree=0.586, adj=0.130, (0 split)
      economic.status splits as  RL,       agree=0.583, adj=0.123, (0 split)
      ps.grad         splits as  LLR,      agree=0.557, adj=0.069, (0 split)

Node number 931: 14 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.2142857  P(node) =0.00201005
    class counts:     3    11
   probabilities: 0.214 0.786 

Node number 1860: 476 observations,    complexity param=0.00172043
  predicted class=Meaningful emp NE                 expected loss=0.4726891  P(node) =0.06834171
    class counts:   251   225
   probabilities: 0.527 0.473 
  left son=3720 (429 obs) right son=3721 (47 obs)
  Primary splits:
      SpecialEdStatus splits as  LR,       improve=2.172721, (0 missing)
      MCA.R           &lt; 2.5  to the right, improve=1.826318, (11 missing)
      cte.achievement splits as  LRR,      improve=1.642090, (0 missing)
      ps.grad         splits as  LLR,      improve=1.268508, (0 missing)
      MCA.S           &lt; 1.5  to the right, improve=1.219881, (78 missing)

Node number 1861: 432 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4537037  P(node) =0.06202441
    class counts:   196   236
   probabilities: 0.454 0.546 
  left son=3722 (46 obs) right son=3723 (386 obs)
  Primary splits:
      range.school      splits as  RL,       improve=4.0557850, (0 missing)
      MCA.M             &lt; 1.5  to the left,  improve=2.6904800, (1 missing)
      MCA.S             &lt; 3.5  to the right, improve=1.6911020, (92 missing)
      SpecialEdStatus   splits as  RL,       improve=1.6895000, (0 missing)
      ACTCompositeScore &lt; 27.5 to the right, improve=0.9601669, (0 missing)

Node number 3720: 429 observations,    complexity param=0.00172043
  predicted class=Meaningful emp NE                 expected loss=0.4568765  P(node) =0.06159368
    class counts:   233   196
   probabilities: 0.543 0.457 
  left son=7440 (382 obs) right son=7441 (47 obs)
  Primary splits:
      MCA.R           &lt; 2.5  to the right, improve=2.175439, (9 missing)
      cte.achievement splits as  LRR,      improve=1.703396, (0 missing)
      MCA.M           &lt; 2.5  to the right, improve=1.422476, (2 missing)
      ps.grad         splits as  RLR,      improve=1.206687, (0 missing)
      MCA.S           &lt; 1.5  to the right, improve=1.132237, (72 missing)

Node number 3721: 47 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3829787  P(node) =0.006748026
    class counts:    18    29
   probabilities: 0.383 0.617 

Node number 3722: 46 observations
  predicted class=Meaningful emp NE                 expected loss=0.3478261  P(node) =0.006604451
    class counts:    30    16
   probabilities: 0.652 0.348 

Node number 3723: 386 observations,    complexity param=0.00172043
  predicted class=Not meaningful, not attending ps  expected loss=0.4300518  P(node) =0.05541996
    class counts:   166   220
   probabilities: 0.430 0.570 
  left son=7446 (13 obs) right son=7447 (373 obs)
  Primary splits:
      MCA.M             &lt; 1.5  to the left,  improve=3.122711, (1 missing)
      SpecialEdStatus   splits as  RL,       improve=2.000495, (0 missing)
      MCA.S             &lt; 3.5  to the right, improve=1.779867, (90 missing)
      MCA.R             &lt; 3.5  to the left,  improve=1.536530, (5 missing)
      ACTCompositeScore &lt; 27.5 to the right, improve=1.183027, (0 missing)

Node number 7440: 382 observations
  predicted class=Meaningful emp NE                 expected loss=0.4397906  P(node) =0.05484566
    class counts:   214   168
   probabilities: 0.560 0.440 

Node number 7441: 47 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.4042553  P(node) =0.006748026
    class counts:    19    28
   probabilities: 0.404 0.596 

Node number 7446: 13 observations
  predicted class=Meaningful emp NE                 expected loss=0.2307692  P(node) =0.001866475
    class counts:    10     3
   probabilities: 0.769 0.231 

Node number 7447: 373 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.4182306  P(node) =0.05355348
    class counts:   156   217
   probabilities: 0.418 0.582 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning not meaningful emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         Dem_Desc                 
 [3] economic.status           english.learner          
 [5] highest.cred.level        MCA.M                    
 [7] MCA.R                     MCA.S                    
 [9] ps.grad.InstitutionSector ps.grad.location         
[11] RaceEthnicity             range.school             
[13] SpecialEdStatus           took.ACT                 
[15] total.cte.courses.taken  

Root node error: 3100/6965 = 0.44508

n= 6965 

          CP nsplit rel error  xerror     xstd
1  0.0470968      0   1.00000 1.00000 0.013379
2  0.0177419      2   0.90581 0.90581 0.013206
3  0.0103226      3   0.88806 0.90516 0.013204
4  0.0077419      4   0.87774 0.89710 0.013185
5  0.0053226      5   0.87000 0.89194 0.013172
6  0.0041935      7   0.85935 0.87742 0.013134
7  0.0032258      8   0.85516 0.87968 0.013140
8  0.0029032      9   0.85194 0.87806 0.013136
9  0.0025806     11   0.84613 0.87742 0.013134
10 0.0023656     12   0.84355 0.87226 0.013120
11 0.0017204     15   0.83645 0.86839 0.013109
12 0.0016129     25   0.81290 0.86710 0.013106</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning not meaningful emp grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6121902</code></pre>
</div>
</div>
<p><br></p>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location = In region | Inside and outside region
<ul>
<li>Yes: Meaningful emp in NE</li>
<li>No:
<ul>
<li>Meaningful emp NE
<ul>
<li>total.cte.courses &gt;= 2
<ul>
<li>economic.status = 0
<ul>
<li>MCA.S &lt; 4
<ul>
<li>ACTCompositeScore &lt; 28</li>
</ul></li>
</ul></li>
<li>economic.status = 1
<ul>
<li>SpecialEdStatus = 0
<ul>
<li>english.learner = 0
<ul>
<li>Dem_Desc = Urban/town/rural mix</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>total.cte.courses.taken</li>
<li>cte.achievement</li>
<li>economic.status</li>
<li>SpecialEdStatus</li>
</ul></li>
<li>Not as important
<ul>
<li>MCA.S</li>
<li>range.school</li>
<li>english.learner</li>
<li>ACTComposteScore</li>
<li>took.ACT</li>
<li>Dem_Desc</li>
<li>RaceEthnicity</li>
<li>MCA.R</li>
<li>MCA.M</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>pseo.participant</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
               166.319059                126.088444                111.385842 
                  ps.grad   total.cte.courses.taken         ACTCompositeScore 
                95.744205                 30.026469                 17.129675 
          cte.achievement           economic.status           SpecialEdStatus 
                15.662556                 15.390633                 14.355220 
            RaceEthnicity              range.school                  took.ACT 
                11.859835                 11.556725                  9.972457 
                    MCA.S           english.learner                     MCA.M 
                 9.919965                  9.274447                  5.831741 
                    MCA.R                  Dem_Desc 
                 5.433105                  3.755787 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance not meaningful emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The post-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.5770261        0.6141996         0.6121902</code></pre>
</div>
</div>
</section>
<section id="summary-4" class="level3">
<h3 class="anchored" data-anchor-id="summary-4">Summary</h3>
<p>The pre-pruned tree provided better accuracy.</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>total.cte.courses.taken</li>
<li>economic.status</li>
<li>cte.achievement</li>
<li>SpecialEdStatus</li>
</ul></li>
<li>Not as important
<ul>
<li>took.ACT</li>
<li>RaceEthnicity</li>
<li>ACTCompositeScore</li>
<li>range.school</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>Dem_Desc</li>
<li>english.learner</li>
<li>MCA.S</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>pseo.participant</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="ten-year-after-graduation" class="level2">
<h2 class="anchored" data-anchor-id="ten-year-after-graduation">Ten year after graduation</h2>
<p>We are now five years away from graduating high school, so we can add the post-secondary variables back in.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 5,621 individuals.The table below shows that a majority of individuals have meaningful employment in the region - 60% compared to individuals with no meaningful employment and are not attending post-secondary.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-bb4e6694137e99e1753d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bb4e6694137e99e1753d">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","Not meaningful, not attending ps"],[3393,2228],["60.4%","39.6%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.10<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.10","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model-5" class="level3">
<h3 class="anchored" data-anchor-id="base-model-5">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(not.meaningful.emp.grad.year<span class="fl">.10</span>), <span class="fu">nrow</span>(not.meaningful.emp.grad.year<span class="fl">.10</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> not.meaningful.emp.grad.year<span class="fl">.10</span>[sample_ind,]</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> not.meaningful.emp.grad.year<span class="fl">.10</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is .0.94194 and the nsplit is 14.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot not meaningful emp grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] english.learner           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 1550/3934 = 0.394

n= 3934 

           CP nsplit rel error  xerror     xstd
1  0.02548387      0   1.00000 1.00000 0.019773
2  0.01741935      2   0.94903 0.97935 0.019699
3  0.00483871      3   0.93161 0.97355 0.019677
4  0.00451613      9   0.89677 0.95677 0.019611
5  0.00258065     10   0.89226 0.95742 0.019613
6  0.00236559     11   0.88968 0.94452 0.019560
7  0.00225806     14   0.88258 0.94194 0.019549
8  0.00215054     19   0.87032 0.94516 0.019563
9  0.00193548     22   0.86387 0.94516 0.019563
10 0.00172043     27   0.85419 0.94581 0.019565
11 0.00161290     38   0.83355 0.96000 0.019624
12 0.00154839     42   0.82710 0.96258 0.019634
13 0.00150538     47   0.81935 0.96258 0.019634
14 0.00129032     50   0.81484 0.96645 0.019649
15 0.00101382     69   0.78710 0.97613 0.019686
16 0.00096774     76   0.78000 0.98065 0.019703
17 0.00090323     92   0.76323 0.99226 0.019746
18 0.00086022     97   0.75871 0.99871 0.019768
19 0.00064516    100   0.75613 1.00387 0.019786
20 0.00053763    119   0.74387 1.04710 0.019921
21 0.00040323    136   0.73161 1.05935 0.019955
22 0.00032258    157   0.72065 1.06516 0.019970
23 0.00021505    165   0.71806 1.07097 0.019985
24 0.00016129    168   0.71742 1.07742 0.020001
25 0.00010753    172   0.71677 1.08258 0.020013
26 0.00000000    182   0.71548 1.08258 0.020013</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot not meaningful emp grad year 10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location   total.cte.courses.taken ps.grad.InstitutionSector 
                71.780756                 59.368041                 57.848190 
       highest.cred.level                   ps.grad         ACTCompositeScore 
                49.368840                 41.774845                 36.658187 
          cte.achievement                     MCA.M                  took.ACT 
                36.165807                 32.585674                 28.534895 
                    MCA.R           SpecialEdStatus             RaceEthnicity 
                26.728488                 23.525616                 20.560960 
             range.school                  Dem_Desc           economic.status 
                20.281817                 20.039180                 18.034384 
                    MCA.S          pseo.participant           english.learner 
                12.187939                  7.820151                  7.214354 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb146-12"><a href="#cb146-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance not meaningful emp grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5838767</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-5" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-5">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li><p>maxdepth: 3 to 6</p></li>
<li><p>minsplit: 5% of n which is 281</p></li>
<li><p>minbucket: round(minsplit / 3) which is 94</p></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">10.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.10</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">281</span>, <span class="at">minbucket =</span> <span class="dv">94</span>))</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6366331</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .6014589 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot not meaningful emp grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 281, 
        minbucket = 94))

Variables actually used in tree construction:
[1] economic.status         MCA.M                   ps.grad.location       
[4] RaceEthnicity           SpecialEdStatus         total.cte.courses.taken

Root node error: 1550/3934 = 0.394

n= 3934 

         CP nsplit rel error  xerror     xstd
1 0.0254839      0   1.00000 1.00000 0.019773
2 0.0174194      2   0.94903 0.96194 0.019631
3 0.0029032      3   0.93161 0.95677 0.019611
4 0.0000000      6   0.92194 0.98065 0.019703</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location = In region | Inside and outside region
<ul>
<li>Yes: Meaningful emp in NE</li>
<li>No:
<ul>
<li>Meaningful emp NE
<ul>
<li>SpecialEdStatus = 0
<ul>
<li>RaceEthnicity = Asian/PI | Whiute
<ul>
<li>total.cte.courses &gt;= 3</li>
<li>total.cte.courses &lt;= 3
<ul>
<li>MCA.M &gt;= 2</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>total.cte.courses.taken</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Not as important
<ul>
<li>range.school</li>
<li>cte.achievement</li>
<li>economic.status</li>
<li>english.learner</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>Dem_Desc</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>pseo.participant</li>
<li>ACTCompositeScore</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
               49.1932724                35.0015442                31.4624599 
                  ps.grad           SpecialEdStatus                  took.ACT 
               31.1085514                18.2935745                10.3019080 
  total.cte.courses.taken             RaceEthnicity              range.school 
                8.9454593                 8.4817899                 4.9901089 
          cte.achievement           economic.status           english.learner 
                3.6200071                 3.5197643                 2.9592783 
                    MCA.M                     MCA.R                  Dem_Desc 
                0.6926407                 0.2906577                 0.1979631 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance not meaningful emp grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-5" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-5">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 3934 

           CP nsplit rel error    xerror       xstd
1 0.025483871      0 1.0000000 1.0000000 0.01977289
2 0.017419355      2 0.9490323 0.9793548 0.01969861
3 0.004838710      3 0.9316129 0.9735484 0.01967667
4 0.004516129      9 0.8967742 0.9567742 0.01961071
5 0.002580645     10 0.8922581 0.9574194 0.01961332
6 0.002365591     11 0.8896774 0.9445161 0.01956006
7 0.002258065     14 0.8825806 0.9419355 0.01954913

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       22                        16                        14 
                  ps.grad           SpecialEdStatus           cte.achievement 
                       13                         7                         5 
                 took.ACT   total.cte.courses.taken             RaceEthnicity 
                        4                         4                         4 
          economic.status              range.school         ACTCompositeScore 
                        3                         2                         2 
          english.learner                     MCA.S                     MCA.M 
                        1                         1                         1 
                    MCA.R 
                        1 

Node number 1: 3934 observations,    complexity param=0.02548387
  predicted class=Meaningful emp NE                 expected loss=0.394001  P(node) =1
    class counts:  2384  1550
   probabilities: 0.606 0.394 
  left son=2 (1390 obs) right son=3 (2544 obs)
  Primary splits:
      ps.grad.location          splits as  RLRLRR, improve=49.19327, (1069 missing)
      ps.grad.InstitutionSector splits as  RLRRLR, improve=44.66741, (1069 missing)
      ps.grad                   splits as  RL,     improve=42.80125, (0 missing)
      highest.cred.level        splits as  LLLRR,  improve=34.80498, (1069 missing)
      SpecialEdStatus           splits as  LR,     improve=31.47977, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RLRLLR, agree=0.860, adj=0.712, (0 split)
      highest.cred.level        splits as  LLLLR,  agree=0.825, adj=0.640, (0 split)
      ps.grad                   splits as  RL,     agree=0.822, adj=0.632, (1069 split)
      took.ACT                  splits as  RL,     agree=0.613, adj=0.203, (0 split)
      range.school              splits as  RL,     agree=0.564, adj=0.101, (0 split)

Node number 2: 1390 observations
  predicted class=Meaningful emp NE                 expected loss=0.2769784  P(node) =0.3533299
    class counts:  1005   385
   probabilities: 0.723 0.277 

Node number 3: 2544 observations,    complexity param=0.02548387
  predicted class=Meaningful emp NE                 expected loss=0.4579403  P(node) =0.6466701
    class counts:  1379  1165
   probabilities: 0.542 0.458 
  left son=6 (2063 obs) right son=7 (481 obs)
  Primary splits:
      SpecialEdStatus           splits as  LR,     improve=18.293570, (0 missing)
      economic.status           splits as  LR,     improve=15.428530, (0 missing)
      RaceEthnicity             splits as  RRRRL,  improve=10.419390, (0 missing)
      cte.achievement           splits as  LRR,    improve= 8.572201, (0 missing)
      ps.grad.InstitutionSector splits as  RRRRLR, improve= 7.330934, (1069 missing)
  Surrogate splits:
      english.learner splits as  LR,       agree=0.841, adj=0.160, (0 split)
      MCA.R           &lt; 1.5  to the right, agree=0.812, adj=0.008, (0 split)

Node number 6: 2063 observations,    complexity param=0.01741935
  predicted class=Meaningful emp NE                 expected loss=0.4289869  P(node) =0.5244026
    class counts:  1178   885
   probabilities: 0.571 0.429 
  left son=12 (1866 obs) right son=13 (197 obs)
  Primary splits:
      RaceEthnicity             splits as  RLRRL,    improve=8.481790, (0 missing)
      cte.achievement           splits as  LRR,      improve=7.760766, (0 missing)
      total.cte.courses.taken   &lt; 2.5  to the right, improve=7.756674, (0 missing)
      economic.status           splits as  LR,       improve=7.389787, (0 missing)
      ps.grad.InstitutionSector splits as  RRRRLR,   improve=4.032110, (895 missing)

Node number 7: 481 observations,    complexity param=0.004516129
  predicted class=Not meaningful, not attending ps  expected loss=0.4178794  P(node) =0.1222674
    class counts:   201   280
   probabilities: 0.418 0.582 
  left son=14 (13 obs) right son=15 (468 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RRRRLR,   improve=3.369547, (174 missing)
      Dem_Desc                  splits as  LRR,      improve=3.126989, (0 missing)
      RaceEthnicity             splits as  LRRLL,    improve=2.569416, (0 missing)
      cte.achievement           splits as  LRR,      improve=2.403935, (0 missing)
      total.cte.courses.taken   &lt; 4.5  to the right, improve=2.259991, (0 missing)
  Surrogate splits:
      highest.cred.level splits as  LRL-R,  agree=0.980, adj=0.538, (0 split)
      ps.grad.location   splits as  L---RR, agree=0.971, adj=0.308, (0 split)

Node number 12: 1866 observations,    complexity param=0.00483871
  predicted class=Meaningful emp NE                 expected loss=0.4142551  P(node) =0.4743264
    class counts:  1093   773
   probabilities: 0.586 0.414 
  left son=24 (723 obs) right son=25 (1143 obs)
  Primary splits:
      total.cte.courses.taken   &lt; 2.5  to the right, improve=8.945459, (0 missing)
      cte.achievement           splits as  LLR,      improve=7.152320, (0 missing)
      ACTCompositeScore         &lt; 29.5 to the left,  improve=3.871221, (944 missing)
      economic.status           splits as  LR,       improve=3.441623, (0 missing)
      ps.grad.InstitutionSector splits as  RLRRLR,   improve=3.197788, (786 missing)
  Surrogate splits:
      cte.achievement splits as  LRR, agree=0.767, adj=0.398, (0 split)
      took.ACT        splits as  LR,  agree=0.626, adj=0.036, (0 split)
      Dem_Desc        splits as  LRR, agree=0.621, adj=0.022, (0 split)

Node number 13: 197 observations,    complexity param=0.002365591
  predicted class=Not meaningful, not attending ps  expected loss=0.4314721  P(node) =0.05007626
    class counts:    85   112
   probabilities: 0.431 0.569 
  left son=26 (67 obs) right son=27 (130 obs)
  Primary splits:
      economic.status splits as  LR,       improve=1.6784490, (0 missing)
      RaceEthnicity   splits as  L-RR-,    improve=1.1690940, (0 missing)
      MCA.S           &lt; 1.5  to the right, improve=1.1264370, (81 missing)
      MCA.M           &lt; 2.5  to the right, improve=1.0065300, (3 missing)
      took.ACT        splits as  RL,       improve=0.9729064, (0 missing)
  Surrogate splits:
      RaceEthnicity splits as  R-RL-, agree=0.67, adj=0.03, (0 split)

Node number 14: 13 observations
  predicted class=Meaningful emp NE                 expected loss=0.2307692  P(node) =0.003304525
    class counts:    10     3
   probabilities: 0.769 0.231 

Node number 15: 468 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.4081197  P(node) =0.1189629
    class counts:   191   277
   probabilities: 0.408 0.592 

Node number 24: 723 observations
  predicted class=Meaningful emp NE                 expected loss=0.3526971  P(node) =0.1837824
    class counts:   468   255
   probabilities: 0.647 0.353 

Node number 25: 1143 observations,    complexity param=0.00483871
  predicted class=Meaningful emp NE                 expected loss=0.4531934  P(node) =0.290544
    class counts:   625   518
   probabilities: 0.547 0.453 
  left son=50 (1096 obs) right son=51 (47 obs)
  Primary splits:
      ACTCompositeScore         &lt; 29.5 to the left,  improve=4.994249, (459 missing)
      economic.status           splits as  LR,       improve=3.519764, (0 missing)
      cte.achievement           splits as  LLR,      improve=2.274823, (0 missing)
      ps.grad.location          splits as  R-L-RL,   improve=1.562426, (426 missing)
      ps.grad.InstitutionSector splits as  LLRRLL,   improve=1.183954, (426 missing)

Node number 26: 67 observations,    complexity param=0.002365591
  predicted class=Meaningful emp NE                 expected loss=0.4776119  P(node) =0.01703101
    class counts:    35    32
   probabilities: 0.522 0.478 
  left son=52 (13 obs) right son=53 (54 obs)
  Primary splits:
      RaceEthnicity           splits as  R-LR-,    improve=1.9655990, (0 missing)
      ACTCompositeScore       &lt; 18.5 to the right, improve=1.2041670, (35 missing)
      total.cte.courses.taken &lt; 0.5  to the left,  improve=1.1033120, (0 missing)
      MCA.M                   &lt; 2.5  to the right, improve=1.0486560, (1 missing)
      pseo.participant        splits as  LR,       improve=0.9864802, (41 missing)

Node number 27: 130 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3846154  P(node) =0.03304525
    class counts:    50    80
   probabilities: 0.385 0.615 

Node number 50: 1096 observations,    complexity param=0.00483871
  predicted class=Meaningful emp NE                 expected loss=0.4443431  P(node) =0.2785968
    class counts:   609   487
   probabilities: 0.556 0.444 
  left son=100 (759 obs) right son=101 (337 obs)
  Primary splits:
      economic.status   splits as  LR,       improve=4.635039, (0 missing)
      ACTCompositeScore &lt; 26.5 to the right, improve=3.265829, (459 missing)
      ps.grad.location  splits as  R-L-RL,   improve=1.843410, (417 missing)
      took.ACT          splits as  RL,       improve=1.697311, (0 missing)
      cte.achievement   splits as  LLR,      improve=1.211755, (0 missing)
  Surrogate splits:
      english.learner splits as  LR, agree=0.695, adj=0.009, (0 split)

Node number 51: 47 observations,    complexity param=0.002580645
  predicted class=Not meaningful, not attending ps  expected loss=0.3404255  P(node) =0.01194713
    class counts:    16    31
   probabilities: 0.340 0.660 
  left son=102 (18 obs) right son=103 (29 obs)
  Primary splits:
      cte.achievement           splits as  LLR,      improve=4.2749650, (0 missing)
      total.cte.courses.taken   &lt; 1.5  to the right, improve=2.2992400, (0 missing)
      range.school              splits as  RL,       improve=0.4909984, (0 missing)
      ps.grad.InstitutionSector splits as  LR-R-R,   improve=0.3426721, (9 missing)
      highest.cred.level        splits as  -LRRR,    improve=0.3396727, (9 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 0.5  to the right, agree=0.787, adj=0.444, (0 split)
      RaceEthnicity           splits as  -L--R,    agree=0.638, adj=0.056, (0 split)

Node number 52: 13 observations
  predicted class=Meaningful emp NE                 expected loss=0.2307692  P(node) =0.003304525
    class counts:    10     3
   probabilities: 0.769 0.231 

Node number 53: 54 observations,    complexity param=0.002365591
  predicted class=Not meaningful, not attending ps  expected loss=0.462963  P(node) =0.01372649
    class counts:    25    29
   probabilities: 0.463 0.537 
  left son=106 (20 obs) right son=107 (34 obs)
  Primary splits:
      MCA.M                   &lt; 2.5  to the right, improve=1.5141660, (1 missing)
      ACTCompositeScore       &lt; 18.5 to the right, improve=1.4628570, (29 missing)
      total.cte.courses.taken &lt; 0.5  to the left,  improve=1.1930280, (0 missing)
      took.ACT                splits as  RL,       improve=0.8766794, (0 missing)
      pseo.participant        splits as  LR,       improve=0.6327751, (35 missing)
  Surrogate splits:
      MCA.R                   &lt; 3.5  to the right, agree=0.736, adj=0.263, (0 split)
      range.school            splits as  RL,       agree=0.679, adj=0.105, (1 split)
      Dem_Desc                splits as  LRR,      agree=0.679, adj=0.105, (0 split)
      total.cte.courses.taken &lt; 5.5  to the right, agree=0.660, adj=0.053, (0 split)

Node number 100: 759 observations
  predicted class=Meaningful emp NE                 expected loss=0.4137022  P(node) =0.1929334
    class counts:   445   314
   probabilities: 0.586 0.414 

Node number 101: 337 observations,    complexity param=0.00483871
  predicted class=Not meaningful, not attending ps  expected loss=0.4866469  P(node) =0.08566345
    class counts:   164   173
   probabilities: 0.487 0.513 
  left son=202 (229 obs) right son=203 (108 obs)
  Primary splits:
      MCA.S              &lt; 2.5  to the left,  improve=2.717414, (158 missing)
      ACTCompositeScore  &lt; 18.5 to the left,  improve=1.970284, (215 missing)
      highest.cred.level splits as  LRLRR,    improve=1.721263, (148 missing)
      cte.achievement    splits as  RLL,      improve=1.410796, (0 missing)
      ps.grad.location   splits as  R-L-RL,   improve=1.112434, (148 missing)
  Surrogate splits:
      MCA.R           &lt; 3.5  to the left,  agree=0.749, adj=0.471, (131 split)
      MCA.M           &lt; 2.5  to the left,  agree=0.721, adj=0.412, (16 split)
      took.ACT        splits as  LR,       agree=0.665, adj=0.294, (11 split)
      ps.grad         splits as  LR,       agree=0.615, adj=0.188, (0 split)
      cte.achievement splits as  RLL,      agree=0.547, adj=0.047, (0 split)

Node number 102: 18 observations
  predicted class=Meaningful emp NE                 expected loss=0.3888889  P(node) =0.004575496
    class counts:    11     7
   probabilities: 0.611 0.389 

Node number 103: 29 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.1724138  P(node) =0.007371632
    class counts:     5    24
   probabilities: 0.172 0.828 

Node number 106: 20 observations
  predicted class=Meaningful emp NE                 expected loss=0.4  P(node) =0.005083884
    class counts:    12     8
   probabilities: 0.600 0.400 

Node number 107: 34 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3823529  P(node) =0.008642603
    class counts:    13    21
   probabilities: 0.382 0.618 

Node number 202: 229 observations,    complexity param=0.00483871
  predicted class=Meaningful emp NE                 expected loss=0.4672489  P(node) =0.05821047
    class counts:   122   107
   probabilities: 0.533 0.467 
  left son=404 (9 obs) right son=405 (220 obs)
  Primary splits:
      ps.grad.location          splits as  R-L-RL,   improve=5.028378, (109 missing)
      ps.grad.InstitutionSector splits as  LLRLLR,   improve=4.362545, (109 missing)
      highest.cred.level        splits as  LLL-R,    improve=4.004178, (109 missing)
      cte.achievement           splits as  RLL,      improve=3.367844, (0 missing)
      MCA.M                     &lt; 1.5  to the right, improve=2.903455, (22 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  LLRRRR, agree=0.950, adj=0.333, (0 split)
      highest.cred.level        splits as  LLR-R,  agree=0.942, adj=0.222, (0 split)

Node number 203: 108 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3888889  P(node) =0.02745297
    class counts:    42    66
   probabilities: 0.389 0.611 

Node number 404: 9 observations
  predicted class=Meaningful emp NE                 expected loss=0  P(node) =0.002287748
    class counts:     9     0
   probabilities: 1.000 0.000 

Node number 405: 220 observations,    complexity param=0.00483871
  predicted class=Meaningful emp NE                 expected loss=0.4863636  P(node) =0.05592272
    class counts:   113   107
   probabilities: 0.514 0.486 
  left son=810 (171 obs) right son=811 (49 obs)
  Primary splits:
      cte.achievement splits as  RLL,      improve=3.503574, (0 missing)
      range.school    splits as  RL,       improve=3.150895, (0 missing)
      MCA.M           &lt; 1.5  to the right, improve=2.020821, (22 missing)
      MCA.S           &lt; 1.5  to the right, improve=1.675214, (130 missing)
      MCA.R           &lt; 3.5  to the right, improve=1.353762, (26 missing)

Node number 810: 171 observations
  predicted class=Meaningful emp NE                 expected loss=0.4385965  P(node) =0.04346721
    class counts:    96    75
   probabilities: 0.561 0.439 

Node number 811: 49 observations
  predicted class=Not meaningful, not attending ps  expected loss=0.3469388  P(node) =0.01245552
    class counts:    17    32
   probabilities: 0.347 0.653 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning not meaningful emp grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] economic.status           MCA.M                    
 [5] MCA.S                     ps.grad.InstitutionSector
 [7] ps.grad.location          RaceEthnicity            
 [9] SpecialEdStatus           total.cte.courses.taken  

Root node error: 1550/3934 = 0.394

n= 3934 

         CP nsplit rel error  xerror     xstd
1 0.0254839      0   1.00000 1.00000 0.019773
2 0.0174194      2   0.94903 0.97935 0.019699
3 0.0048387      3   0.93161 0.97355 0.019677
4 0.0045161      9   0.89677 0.95677 0.019611
5 0.0025806     10   0.89226 0.95742 0.019613
6 0.0023656     11   0.88968 0.94452 0.019560
7 0.0022581     14   0.88258 0.94194 0.019549</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning not meaningful emp grad year 10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6259632</code></pre>
</div>
</div>
<p><br></p>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location = In region | Inside and outside region
<ul>
<li>Yes: Meaningful emp in NE</li>
<li>No:
<ul>
<li>Meaningful emp NE
<ul>
<li>SpecialEdStatus = 0
<ul>
<li>RaceEthnicity = Asian/PI | White
<ul>
<li>total.cte.courses &gt;= 3</li>
<li>total.cte.courses &lt;= 3
<ul>
<li>ACTCompositeScore &lt; 30
<ul>
<li>Economic.status = 0</li>
<li>Economic.status = 1
<ul>
<li>MCA.S &lt; 3</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>SpecialEdStatus</li>
<li>cte.achievement</li>
<li>took.ACT</li>
<li>total.cte.courses.taken</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Not as important
<ul>
<li>economic.status</li>
<li>range.school</li>
<li>ACTCompositeScore</li>
<li>english.learner</li>
<li>MCa.S</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>Dem_Desc</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>pseo.participant</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                55.258435                 40.047218                 34.394249 
                  ps.grad           SpecialEdStatus           cte.achievement 
                31.620065                 18.293575                 11.469754 
                 took.ACT   total.cte.courses.taken             RaceEthnicity 
                11.101147                 10.925137                 10.734990 
          economic.status              range.school         ACTCompositeScore 
                 6.313487                  5.149495                  4.994249 
          english.learner                     MCA.S                     MCA.M 
                 2.969755                  2.717414                  2.633101 
                    MCA.R                  Dem_Desc 
                 1.829377                  0.357349 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> not.meaningful.emp.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance not meaningful emp grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The pre-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.5838767        0.6366331         0.6259632</code></pre>
</div>
</div>
</section>
<section id="summary-5" class="level3">
<h3 class="anchored" data-anchor-id="summary-5">Summary</h3>
<p>The pre-pruned tree provided better accuracy.</p>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>total.cte.courses.taken</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Not as important
<ul>
<li>range.school</li>
<li>cte.achievement</li>
<li>economic.status</li>
<li>english.learner</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>Dem_Desc</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>pseo.participant</li>
<li>ACTCompositeScore</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="important-variables-through-time-1" class="level2">
<h2 class="anchored" data-anchor-id="important-variables-through-time-1">Important variables through time</h2>
<p>The following table provides the level of important for each grad.year.x in the above analysis. Here are the primary themes;</p>
<ul>
<li>Variables that are never important
<ul>
<li>grad.year.covid</li>
<li>pseo.participante</li>
</ul></li>
<li>A few that just don’t make the cut either
<ul>
<li>MCA.S</li>
</ul></li>
<li>One variable that stays important throughout the entire analysis
<ul>
<li>SpecialEdStatus</li>
</ul></li>
<li>One variable that starts as important but loses importance over time
<ul>
<li>ACTCompositeScore</li>
</ul></li>
<li>There are a few variables that are important five and ten years after graduating high school;
<ul>
<li>ps.grad.location</li>
<li>highest.cred.earned</li>
<li>ps.grad</li>
<li>ps.grad.InstitutionSector</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>A few that are important once and less so once
<ul>
<li>economic.status</li>
<li>cte.achievement</li>
<li>RaceEthnicity</li>
<li>took.ACT</li>
</ul></li>
<li>A couple of variables that stay either important or less so throughout the years
<ul>
<li>economic.status</li>
<li>Dem_Desc</li>
<li>RaceEthnicity</li>
<li>cte.achievement</li>
<li>ACTCompositeScore</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>Variables that had some importance five and ten years after graduating high school
<ul>
<li>Dem_Desc</li>
<li>range.school</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>english.learner</li>
</ul></li>
</ul>
<p>The variables to keep by group are;</p>
<ul>
<li>Demographics
<ul>
<li><del>grad.year.covid</del></li>
<li>economic.status</li>
<li>RaceEthnicity</li>
<li>SpecialEdStatus</li>
<li><del>english.learner</del></li>
</ul></li>
<li>CTE engagement
<ul>
<li>cte.achievement</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>HS Characteristics
<ul>
<li>Dem_Desc</li>
<li>range.school</li>
</ul></li>
<li>Prep for PS
<ul>
<li><del>pseo.participant</del></li>
<li>MCA.M</li>
<li>MCA.R</li>
<li><del>MCA.S</del></li>
<li>ACTCompositeScore</li>
<li>took.act</li>
</ul></li>
<li>Post-secondary path
<ul>
<li>ps.grad</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad.location</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-fa5f2c4faeec13a63839" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fa5f2c4faeec13a63839">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;grad.year.covid&quot;,&quot;economic.status&quot;,&quot;range.school&quot;,&quot;pseo.participant&quot;,&quot;SpecialEdStatus&quot;,&quot;RaceEthnicity&quot;,&quot;Dem_Desc&quot;,&quot;took.ACT&quot;,&quot;cte.achievement&quot;,&quot;english.learner&quot;,&quot;ps.grad&quot;,&quot;ps.grad.InstitutionSector&quot;,&quot;highest.cred.level&quot;,&quot;ps.grad.location&quot;,&quot;ACTCompositeScore&quot;,&quot;MCA.M&quot;,&quot;MCA.R&quot;,&quot;MCA.S&quot;,&quot;total.cte.courses.taken&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["grad.year.covid","economic.status","range.school","pseo.participant","SpecialEdStatus","RaceEthnicity","Dem_Desc","took.ACT","cte.achievement","english.learner","ps.grad","ps.grad.InstitutionSector","highest.cred.level","ps.grad.location","ACTCompositeScore","MCA.M","MCA.R","MCA.S","total.cte.courses.taken"],["Demographics","Demographics","HS Characteristics","Prep for PS","Demographics","Demographics","HS Characteristics","Prep for PS","CTE Engagement","Demographics","Post-secondary path","Post-secondary path","Post-secondary path","Post-secondary path","Prep for PS","Prep for PS","Prep for PS","Prep for PS","CTE Engagement"],["","","Important","","Important","","","","","Important","","","","","Important","","Less so","",""],["","Important","Less so","","Important","Less so","Less so","Less so","Important","Less so","Important","Important","Important","Important","Less so","Less so","Less so","Less so","Important"],["","Less so","Less so","","Important","Important","Less so","Important","Less so","Less so","Important","Important","Important","Important","","Less so","Less so","","Important"]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>ind.var<\/th>\n      <th>var.group<\/th>\n      <th>year.one<\/th>\n      <th>year.five<\/th>\n      <th>year.ten<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"ind.var","targets":0},{"name":"var.group","targets":1},{"name":"year.one","targets":2},{"name":"year.five","targets":3},{"name":"year.ten","targets":4}],"pageLength":20,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,20,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="no-mn-employment-record-vs-meaningful-emp-in-ne" class="level1">
<h1>No MN employment record vs meaningful emp in NE</h1>
<p>This section will examine which variables seem to play a role in whether an individual has meaningful employment in the region, or in Minnesota.</p>
<p><br></p>
<section id="one-year-after-graduation-2" class="level2">
<h2 class="anchored" data-anchor-id="one-year-after-graduation-2">One year after graduation</h2>
<p>It probably doesn’t make sense to have a dataset with a bunch of post-secondary variables in it when exploring which variables make a difference in whether someone has meaningful workforce participation in the region one year after graduating high school. So, I’m going to delete all of them.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 15,737 individuals.The table below shows that a a minority of individuals have meaningful employment in the region - 27% compared to individuals with no meaningful employment and are not attending post-secondary.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-6c4c02a1f4282c2a9263" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6c4c02a1f4282c2a9263">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","No MN emp record, not attending ps"],[4172,11565],["26.5%","73.5%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.1<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.1","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model-6" class="level3">
<h3 class="anchored" data-anchor-id="base-model-6">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(no.mn.emp.grad.year<span class="fl">.1</span>), <span class="fu">nrow</span>(no.mn.emp.grad.year<span class="fl">.1</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> no.mn.emp.grad.year<span class="fl">.1</span>[sample_ind,]</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> no.mn.emp.grad.year<span class="fl">.1</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is 1.0072 and the nsplit is 7.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot no mn emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore       cte.achievement         Dem_Desc               
 [4] economic.status         english.learner         grad.year.covid        
 [7] MCA.M                   MCA.R                   MCA.S                  
[10] pseo.participant        RaceEthnicity           range.school           
[13] SpecialEdStatus         took.ACT                total.cte.courses.taken

Root node error: 2926/11015 = 0.26564

n= 11015 

           CP nsplit rel error xerror     xstd
1  9.5694e-04      0   1.00000 1.0000 0.015842
2  9.2764e-04      7   0.99248 1.0072 0.015878
3  8.4126e-04     29   0.95796 1.0133 0.015909
4  7.9745e-04     46   0.94053 1.0150 0.015917
5  6.8353e-04     53   0.93301 1.0256 0.015969
6  5.9809e-04     92   0.90260 1.0287 0.015984
7  5.6961e-04     97   0.89952 1.0338 0.016009
8  5.4682e-04    112   0.88961 1.0396 0.016037
9  5.1265e-04    118   0.88585 1.0410 0.016044
10 4.5568e-04    143   0.87116 1.0420 0.016048
11 3.9872e-04    149   0.86842 1.0441 0.016058
12 3.4176e-04    155   0.86603 1.0701 0.016179
13 3.0379e-04    170   0.86090 1.0707 0.016182
14 2.5632e-04    180   0.85783 1.0803 0.016225
15 2.4412e-04    222   0.84381 1.0902 0.016269
16 2.2784e-04    237   0.84005 1.0902 0.016269
17 2.0506e-04    243   0.83869 1.0967 0.016298
18 1.7088e-04    258   0.83561 1.1104 0.016357
19 1.5189e-04    276   0.83254 1.1131 0.016369
20 1.3671e-04    285   0.83117 1.1155 0.016379
21 1.1392e-04    290   0.83049 1.1206 0.016401
22 8.5441e-05    305   0.82878 1.1213 0.016404
23 6.8353e-05    321   0.82741 1.1224 0.016408
24 4.8823e-05    336   0.82604 1.1224 0.016408
25 4.2720e-05    343   0.82570 1.1258 0.016422
26 3.7974e-05    351   0.82536 1.1261 0.016424
27 0.0000e+00    360   0.82502 1.1261 0.016424</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot no mn emp grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>total.cte.courses.taken       ACTCompositeScore         cte.achievement 
              141.07791               121.30079                84.28487 
        SpecialEdStatus            range.school                   MCA.M 
               71.64029                70.88105                70.20957 
                  MCA.R           RaceEthnicity                   MCA.S 
               63.71252                62.69353                51.36128 
               took.ACT         economic.status                Dem_Desc 
               49.22682                45.33740                43.66814 
        grad.year.covid        pseo.participant         english.learner 
               40.59936                37.23654                30.39304 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance no mn emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7018213</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-6" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-6">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 787</li>
<li>minbucket: round(minsplit / 3) which is 262</li>
</ul>
<p>Unforttunately, these parameters give me a tree with no splits. So, we are going to use the following;</p>
<ul>
<li>maxdepth: 6</li>
<li>minsplit:</li>
<li>minbucket: eliminate</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">1.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.1</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">300</span>))</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7363405</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .7363405 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot no MN emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 300))

Variables actually used in tree construction:
[1] ACTCompositeScore grad.year.covid   range.school      SpecialEdStatus  
[5] took.ACT         

Root node error: 2926/11015 = 0.26564

n= 11015 

          CP nsplit rel error xerror     xstd
1 0.00095694      0   1.00000      1 0.015842
2 0.00000000      5   0.99522      1 0.015842</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>SpecialEdStatus = 0
<ul>
<li>No: significantly more likely to not have meaningful employment or in post-secondary</li>
<li>Yes:
<ul>
<li><p>Meaningful emp in NE:</p>
<ul>
<li><p>ACTCompositeSCore &gt; 27</p>
<ul>
<li><p>took.ACT = YES</p>
<ul>
<li><p>grad.year.covid = No</p>
<ul>
<li>range.school = Yes</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>ACTCompositeScore</li>
<li>range.school</li>
<li>english.learner</li>
<li>grad.year.covid</li>
</ul></li>
<li>Less important
<ul>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>economic.status</li>
<li>pseo.participant</li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>MCA.S</li>
<li>total.cte.courses.taken</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  SpecialEdStatus          took.ACT ACTCompositeScore      range.school 
        71.640286         38.691346         31.009393         24.077281 
  english.learner   grad.year.covid     RaceEthnicity 
        20.522236         17.911454          8.190523 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance no mn emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-6" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-6">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable</span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb185-11"><a href="#cb185-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-12"><a href="#cb185-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb185-13"><a href="#cb185-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-14"><a href="#cb185-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-15"><a href="#cb185-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb185-16"><a href="#cb185-16" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model, <span class="at">cp =</span> .<span class="dv">00092764</span>)</span>
<span id="cb185-17"><a href="#cb185-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-18"><a href="#cb185-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb185-19"><a href="#cb185-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 11015 

            CP nsplit rel error   xerror       xstd
1 0.0009569378      0 1.0000000 1.000000 0.01584229
2 0.0009276438      7 0.9924812 1.007177 0.01587839
3 0.0009276400     29 0.9579631 1.013329 0.01590903

Variable importance
        SpecialEdStatus       ACTCompositeScore                took.ACT 
                     24                      17                      13 
           range.school         english.learner total.cte.courses.taken 
                      9                       8                       7 
        grad.year.covid         cte.achievement           RaceEthnicity 
                      6                       4                       4 
                  MCA.R                   MCA.M                   MCA.S 
                      2                       2                       1 
        economic.status                Dem_Desc        pseo.participant 
                      1                       1                       1 

Node number 1: 11015 observations,    complexity param=0.0009569378
  predicted class=No MN emp record, not attending ps  expected loss=0.2656378  P(node) =1
    class counts:  2926  8089
   probabilities: 0.266 0.734 
  left son=2 (8341 obs) right son=3 (2674 obs)
  Primary splits:
      SpecialEdStatus   splits as  LR,       improve=71.64029, (0 missing)
      took.ACT          splits as  RL,       improve=61.96058, (0 missing)
      english.learner   splits as  LR,       improve=47.65583, (0 missing)
      Dem_Desc          splits as  RRL,      improve=29.40828, (0 missing)
      ACTCompositeScore &lt; 26.5 to the left,  improve=29.14725, (6881 missing)
  Surrogate splits:
      english.learner splits as  LR, agree=0.827, adj=0.286, (0 split)

Node number 2: 8341 observations,    complexity param=0.0009569378
  predicted class=No MN emp record, not attending ps  expected loss=0.2979259  P(node) =0.7572401
    class counts:  2485  5856
   probabilities: 0.298 0.702 
  left son=4 (7917 obs) right son=5 (424 obs)
  Primary splits:
      ACTCompositeScore &lt; 26.5 to the left,  improve=31.00939, (4596 missing)
      Dem_Desc          splits as  RRL,      improve=26.52818, (0 missing)
      took.ACT          splits as  RL,       improve=24.58501, (0 missing)
      grad.year.covid   splits as  RL,       improve=20.97243, (0 missing)
      RaceEthnicity     splits as  RRRRRL,   improve=20.25107, (0 missing)

Node number 3: 2674 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.1649215  P(node) =0.2427599
    class counts:   441  2233
   probabilities: 0.165 0.835 

Node number 4: 7917 observations,    complexity param=0.0009569378
  predicted class=No MN emp record, not attending ps  expected loss=0.3052924  P(node) =0.7187472
    class counts:  2417  5500
   probabilities: 0.305 0.695 
  left son=8 (3321 obs) right son=9 (4596 obs)
  Primary splits:
      took.ACT                splits as  RL,       improve=38.69135, (0 missing)
      Dem_Desc                splits as  RRL,      improve=29.13689, (0 missing)
      RaceEthnicity           splits as  RRRRRL,   improve=21.94385, (0 missing)
      grad.year.covid         splits as  RL,       improve=21.60951, (0 missing)
      total.cte.courses.taken &lt; 1.5  to the right, improve=12.05670, (0 missing)

Node number 5: 424 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.1603774  P(node) =0.03849296
    class counts:    68   356
   probabilities: 0.160 0.840 

Node number 8: 3321 observations,    complexity param=0.0009569378
  predicted class=No MN emp record, not attending ps  expected loss=0.3634447  P(node) =0.301498
    class counts:  1207  2114
   probabilities: 0.363 0.637 
  left son=16 (2689 obs) right son=17 (632 obs)
  Primary splits:
      grad.year.covid         splits as  RL,       improve=17.911450, (0 missing)
      RaceEthnicity           splits as  RLRRRL,   improve= 9.945039, (0 missing)
      Dem_Desc                splits as  RRL,      improve= 3.848411, (0 missing)
      ACTCompositeScore       &lt; 22.5 to the left,  improve= 3.489708, (0 missing)
      total.cte.courses.taken &lt; 1.5  to the right, improve= 2.417187, (0 missing)
  Surrogate splits:
      RaceEthnicity splits as  LLLLRL, agree=0.897, adj=0.457, (0 split)

Node number 9: 4596 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.2632724  P(node) =0.4172492
    class counts:  1210  3386
   probabilities: 0.263 0.737 

Node number 16: 2689 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.3886203  P(node) =0.2441217
    class counts:  1045  1644
   probabilities: 0.389 0.611 
  left son=32 (1439 obs) right son=33 (1250 obs)
  Primary splits:
      total.cte.courses.taken &lt; 1.5  to the right, improve=5.994163, (0 missing)
      range.school            splits as  LR,       improve=5.264659, (0 missing)
      cte.achievement         splits as  LRR,      improve=3.182621, (0 missing)
      ACTCompositeScore       &lt; 24.5 to the left,  improve=2.999992, (0 missing)
      Dem_Desc                splits as  LRL,      improve=2.332453, (0 missing)
  Surrogate splits:
      cte.achievement   splits as  LLR,      agree=0.846, adj=0.670, (0 split)
      ACTCompositeScore &lt; 20.5 to the left,  agree=0.567, adj=0.068, (0 split)
      range.school      splits as  LR,       agree=0.539, adj=0.009, (0 split)
      RaceEthnicity     splits as  LRRLRL,   agree=0.538, adj=0.006, (0 split)
      MCA.M             &lt; 1.5  to the right, agree=0.538, adj=0.006, (0 split)

Node number 17: 632 observations,    complexity param=0.0009569378
  predicted class=No MN emp record, not attending ps  expected loss=0.2563291  P(node) =0.05737631
    class counts:   162   470
   probabilities: 0.256 0.744 
  left son=34 (104 obs) right son=35 (528 obs)
  Primary splits:
      range.school            splits as  RL,       improve=24.077280, (0 missing)
      cte.achievement         splits as  RRL,      improve= 3.075787, (0 missing)
      ACTCompositeScore       &lt; 22.5 to the left,  improve= 2.630883, (0 missing)
      total.cte.courses.taken &lt; 0.5  to the left,  improve= 2.211662, (0 missing)
      RaceEthnicity           splits as  RRRLLL,   improve= 1.790410, (0 missing)

Node number 32: 1439 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4197359  P(node) =0.13064
    class counts:   604   835
   probabilities: 0.420 0.580 
  left son=64 (1432 obs) right son=65 (7 obs)
  Primary splits:
      english.learner         splits as  LR,       improve=2.478552, (0 missing)
      RaceEthnicity           splits as  RLRRRL,   improve=2.304010, (0 missing)
      Dem_Desc                splits as  RRL,      improve=1.764921, (0 missing)
      total.cte.courses.taken &lt; 5.5  to the left,  improve=1.296883, (0 missing)
      cte.achievement         splits as  LRR,      improve=1.036657, (0 missing)

Node number 33: 1250 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3528  P(node) =0.1134816
    class counts:   441   809
   probabilities: 0.353 0.647 

Node number 34: 104 observations,    complexity param=0.0009569378
  predicted class=Meaningful emp NE                   expected loss=0.4326923  P(node) =0.00944167
    class counts:    59    45
   probabilities: 0.567 0.433 
  left son=68 (40 obs) right son=69 (64 obs)
  Primary splits:
      MCA.M             &lt; 3.5  to the right, improve=1.7763760, (2 missing)
      ACTCompositeScore &lt; 15.5 to the right, improve=1.4160260, (0 missing)
      MCA.S             &lt; 2.5  to the right, improve=1.3639270, (1 missing)
      pseo.participant  splits as  RL,       improve=0.9423077, (0 missing)
      RaceEthnicity     splits as  RRRLRL,   improve=0.8643366, (0 missing)
  Surrogate splits:
      ACTCompositeScore       &lt; 19.5 to the right, agree=0.735, adj=0.325, (2 split)
      MCA.R                   &lt; 3.5  to the right, agree=0.725, adj=0.300, (0 split)
      MCA.S                   &lt; 3.5  to the right, agree=0.686, adj=0.200, (0 split)
      pseo.participant        splits as  RL,       agree=0.667, adj=0.150, (0 split)
      total.cte.courses.taken &lt; 7    to the right, agree=0.627, adj=0.050, (0 split)

Node number 35: 528 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.1950758  P(node) =0.04793463
    class counts:   103   425
   probabilities: 0.195 0.805 

Node number 64: 1432 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4217877  P(node) =0.1300045
    class counts:   604   828
   probabilities: 0.422 0.578 
  left son=128 (1308 obs) right son=129 (124 obs)
  Primary splits:
      RaceEthnicity           splits as  RLRRRL,   improve=2.2554300, (0 missing)
      Dem_Desc                splits as  RRL,      improve=1.9735060, (0 missing)
      total.cte.courses.taken &lt; 5.5  to the left,  improve=1.3306800, (0 missing)
      cte.achievement         splits as  LRR,      improve=1.0846410, (0 missing)
      range.school            splits as  LR,       improve=0.9087306, (0 missing)

Node number 65: 7 observations
  predicted class=No MN emp record, not attending ps  expected loss=0  P(node) =0.000635497
    class counts:     0     7
   probabilities: 0.000 1.000 

Node number 68: 40 observations
  predicted class=Meaningful emp NE                   expected loss=0.325  P(node) =0.003631412
    class counts:    27    13
   probabilities: 0.675 0.325 

Node number 69: 64 observations,    complexity param=0.0009569378
  predicted class=Meaningful emp NE                   expected loss=0.5  P(node) =0.005810259
    class counts:    32    32
   probabilities: 0.500 0.500 
  left son=138 (24 obs) right son=139 (40 obs)
  Primary splits:
      economic.status   splits as  RL,       improve=2.1333330, (0 missing)
      RaceEthnicity     splits as  LRRLRL,   improve=2.0078430, (0 missing)
      ACTCompositeScore &lt; 18.5 to the right, improve=1.3090910, (0 missing)
      MCA.S             &lt; 2.5  to the right, improve=0.7025898, (1 missing)
      MCA.M             &lt; 2.5  to the right, improve=0.5808372, (2 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 5.5  to the right, agree=0.656, adj=0.083, (0 split)
      RaceEthnicity           splits as  RRRLRR,   agree=0.641, adj=0.042, (0 split)
      Dem_Desc                splits as  -LR,      agree=0.641, adj=0.042, (0 split)
      cte.achievement         splits as  LRR,      agree=0.641, adj=0.042, (0 split)
      ACTCompositeScore       &lt; 13.5 to the left,  agree=0.641, adj=0.042, (0 split)

Node number 128: 1308 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4304281  P(node) =0.1187472
    class counts:   563   745
   probabilities: 0.430 0.570 
  left son=256 (906 obs) right son=257 (402 obs)
  Primary splits:
      Dem_Desc                splits as  RRL,      improve=2.083629, (0 missing)
      ACTCompositeScore       &lt; 24.5 to the left,  improve=1.439587, (0 missing)
      total.cte.courses.taken &lt; 5.5  to the left,  improve=1.414490, (0 missing)
      MCA.M                   &lt; 2.5  to the left,  improve=1.142932, (4 missing)
      RaceEthnicity           splits as  -L---R,   improve=1.134121, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 11.5 to the left,  agree=0.693, adj=0.002, (0 split)

Node number 129: 124 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.3306452  P(node) =0.01125738
    class counts:    41    83
   probabilities: 0.331 0.669 
  left son=258 (16 obs) right son=259 (108 obs)
  Primary splits:
      MCA.R                   &lt; 2.5  to the left,  improve=3.1292830, (1 missing)
      ACTCompositeScore       &lt; 14.5 to the left,  improve=1.2078510, (0 missing)
      MCA.M                   &lt; 3.5  to the right, improve=1.1596540, (1 missing)
      total.cte.courses.taken &lt; 6.5  to the left,  improve=0.4273565, (0 missing)
      cte.achievement         splits as  LRR,      improve=0.3042335, (0 missing)

Node number 138: 24 observations
  predicted class=Meaningful emp NE                   expected loss=0.3333333  P(node) =0.002178847
    class counts:    16     8
   probabilities: 0.667 0.333 

Node number 139: 40 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.4  P(node) =0.003631412
    class counts:    16    24
   probabilities: 0.400 0.600 

Node number 256: 906 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4492274  P(node) =0.08225148
    class counts:   407   499
   probabilities: 0.449 0.551 
  left son=512 (712 obs) right son=513 (194 obs)
  Primary splits:
      range.school            splits as  LR,       improve=3.0109810, (0 missing)
      cte.achievement         splits as  LRL,      improve=1.7854160, (0 missing)
      total.cte.courses.taken &lt; 5.5  to the left,  improve=1.5264410, (0 missing)
      MCA.M                   &lt; 2.5  to the left,  improve=1.3276540, (3 missing)
      ACTCompositeScore       &lt; 15.5 to the right, improve=0.8516228, (0 missing)

Node number 257: 402 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.3880597  P(node) =0.03649569
    class counts:   156   246
   probabilities: 0.388 0.612 
  left son=514 (375 obs) right son=515 (27 obs)
  Primary splits:
      ACTCompositeScore &lt; 24.5 to the left,  improve=4.4400400, (0 missing)
      range.school      splits as  RL,       improve=0.9433219, (0 missing)
      pseo.participant  splits as  RL,       improve=0.9385386, (61 missing)
      MCA.R             &lt; 2.5  to the right, improve=0.8377556, (3 missing)
      cte.achievement   splits as  RLR,      improve=0.4891773, (0 missing)

Node number 258: 16 observations
  predicted class=Meaningful emp NE                   expected loss=0.375  P(node) =0.001452565
    class counts:    10     6
   probabilities: 0.625 0.375 

Node number 259: 108 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.287037  P(node) =0.009804812
    class counts:    31    77
   probabilities: 0.287 0.713 

Node number 512: 712 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4705056  P(node) =0.06463913
    class counts:   335   377
   probabilities: 0.471 0.529 
  left son=1024 (439 obs) right son=1025 (273 obs)
  Primary splits:
      cte.achievement         splits as  LRL,      improve=4.9680500, (0 missing)
      MCA.M                   &lt; 2.5  to the left,  improve=2.8775830, (3 missing)
      total.cte.courses.taken &lt; 5.5  to the left,  improve=0.9282822, (0 missing)
      ACTCompositeScore       &lt; 15.5 to the right, improve=0.4478297, (0 missing)
      MCA.R                   &lt; 2.5  to the left,  improve=0.4086672, (8 missing)

Node number 513: 194 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.371134  P(node) =0.01761235
    class counts:    72   122
   probabilities: 0.371 0.629 

Node number 514: 375 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.408  P(node) =0.03404448
    class counts:   153   222
   probabilities: 0.408 0.592 
  left son=1028 (203 obs) right son=1029 (172 obs)
  Primary splits:
      pseo.participant splits as  RL,       improve=1.4533880, (52 missing)
      MCA.S            &lt; 3.5  to the right, improve=1.3391710, (34 missing)
      MCA.R            &lt; 2.5  to the right, improve=1.1841320, (3 missing)
      range.school     splits as  RL,       improve=0.7621928, (0 missing)
      cte.achievement  splits as  RLR,      improve=0.5610857, (0 missing)
  Surrogate splits:
      ACTCompositeScore &lt; 18.5 to the right, agree=0.638, adj=0.230, (52 split)
      MCA.S             &lt; 2.5  to the right, agree=0.601, adj=0.151, (0 split)
      MCA.M             &lt; 3.5  to the right, agree=0.579, adj=0.105, (0 split)
      MCA.R             &lt; 3.5  to the right, agree=0.579, adj=0.105, (0 split)
      Dem_Desc          splits as  RL-,      agree=0.560, adj=0.066, (0 split)

Node number 515: 27 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.1111111  P(node) =0.002451203
    class counts:     3    24
   probabilities: 0.111 0.889 

Node number 1024: 439 observations,    complexity param=0.0009276438
  predicted class=Meaningful emp NE                   expected loss=0.4829157  P(node) =0.03985474
    class counts:   227   212
   probabilities: 0.517 0.483 
  left son=2048 (113 obs) right son=2049 (326 obs)
  Primary splits:
      MCA.M                   &lt; 2.5  to the left,  improve=3.2619190, (1 missing)
      total.cte.courses.taken &lt; 3.5  to the left,  improve=2.1817840, (0 missing)
      ACTCompositeScore       &lt; 20.5 to the right, improve=1.2312940, (0 missing)
      economic.status         splits as  RL,       improve=0.8532827, (0 missing)
      MCA.S                   &lt; 1.5  to the right, improve=0.4461098, (63 missing)
  Surrogate splits:
      MCA.R             &lt; 2.5  to the left,  agree=0.797, adj=0.212, (0 split)
      ACTCompositeScore &lt; 12.5 to the left,  agree=0.749, adj=0.027, (1 split)

Node number 1025: 273 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.3956044  P(node) =0.02478438
    class counts:   108   165
   probabilities: 0.396 0.604 
  left son=2050 (16 obs) right son=2051 (257 obs)
  Primary splits:
      MCA.S                   &lt; 1.5  to the left,  improve=3.1491370, (23 missing)
      MCA.R                   &lt; 2.5  to the left,  improve=0.9749933, (6 missing)
      ACTCompositeScore       &lt; 25.5 to the left,  improve=0.7417582, (0 missing)
      total.cte.courses.taken &lt; 4.5  to the right, improve=0.4785581, (0 missing)
      economic.status         splits as  LR,       improve=0.3976103, (0 missing)

Node number 1028: 203 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4433498  P(node) =0.01842941
    class counts:    90   113
   probabilities: 0.443 0.557 
  left son=2056 (9 obs) right son=2057 (194 obs)
  Primary splits:
      ACTCompositeScore       &lt; 14.5 to the left,  improve=2.1065520, (0 missing)
      total.cte.courses.taken &lt; 9.5  to the left,  improve=0.9209848, (0 missing)
      cte.achievement         splits as  LLR,      improve=0.7731368, (0 missing)
      MCA.M                   &lt; 3.5  to the right, improve=0.5654321, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.5002615, (20 missing)

Node number 1029: 172 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.3662791  P(node) =0.01561507
    class counts:    63   109
   probabilities: 0.366 0.634 
  left son=2058 (10 obs) right son=2059 (162 obs)
  Primary splits:
      ACTCompositeScore       &lt; 22.5 to the right, improve=2.3648870, (0 missing)
      cte.achievement         splits as  RLL,      improve=1.8564460, (0 missing)
      MCA.R                   &lt; 2.5  to the right, improve=1.7518080, (3 missing)
      total.cte.courses.taken &lt; 7.5  to the right, improve=0.9172024, (0 missing)
      MCA.S                   &lt; 2.5  to the right, improve=0.3165049, (14 missing)

Node number 2048: 113 observations,    complexity param=0.0009276438
  predicted class=Meaningful emp NE                   expected loss=0.380531  P(node) =0.01025874
    class counts:    70    43
   probabilities: 0.619 0.381 
  left son=4096 (84 obs) right son=4097 (29 obs)
  Primary splits:
      ACTCompositeScore       &lt; 15.5 to the right, improve=4.5001160, (0 missing)
      MCA.R                   &lt; 2.5  to the right, improve=1.2743360, (0 missing)
      cte.achievement         splits as  L-R,      improve=0.9639915, (0 missing)
      total.cte.courses.taken &lt; 4.5  to the left,  improve=0.5222354, (0 missing)
      MCA.S                   &lt; 1.5  to the right, improve=0.4426397, (46 missing)
  Surrogate splits:
      MCA.R                   &lt; 2.5  to the right, agree=0.796, adj=0.207, (0 split)
      total.cte.courses.taken &lt; 7.5  to the left,  agree=0.770, adj=0.103, (0 split)

Node number 2049: 326 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4815951  P(node) =0.02959601
    class counts:   157   169
   probabilities: 0.482 0.518 
  left son=4098 (249 obs) right son=4099 (77 obs)
  Primary splits:
      total.cte.courses.taken &lt; 5.5  to the left,  improve=2.2216910, (0 missing)
      ACTCompositeScore       &lt; 20.5 to the right, improve=1.6084060, (0 missing)
      economic.status         splits as  RL,       improve=0.5390115, (0 missing)
      MCA.R                   &lt; 3.5  to the right, improve=0.2754919, (2 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.1308434, (17 missing)
  Surrogate splits:
      ACTCompositeScore &lt; 12.5 to the right, agree=0.77, adj=0.026, (0 split)

Node number 2050: 16 observations
  predicted class=Meaningful emp NE                   expected loss=0.3125  P(node) =0.001452565
    class counts:    11     5
   probabilities: 0.688 0.312 

Node number 2051: 257 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3774319  P(node) =0.02333182
    class counts:    97   160
   probabilities: 0.377 0.623 

Node number 2056: 9 observations
  predicted class=Meaningful emp NE                   expected loss=0.2222222  P(node) =0.0008170676
    class counts:     7     2
   probabilities: 0.778 0.222 

Node number 2057: 194 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.4278351  P(node) =0.01761235
    class counts:    83   111
   probabilities: 0.428 0.572 

Node number 2058: 10 observations
  predicted class=Meaningful emp NE                   expected loss=0.3  P(node) =0.0009078529
    class counts:     7     3
   probabilities: 0.700 0.300 

Node number 2059: 162 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.345679  P(node) =0.01470722
    class counts:    56   106
   probabilities: 0.346 0.654 
  left son=4118 (87 obs) right son=4119 (75 obs)
  Primary splits:
      cte.achievement         splits as  RLL,      improve=1.7437210, (0 missing)
      MCA.R                   &lt; 2.5  to the right, improve=1.3743550, (3 missing)
      MCA.M                   &lt; 3.5  to the left,  improve=0.8015765, (1 missing)
      total.cte.courses.taken &lt; 7.5  to the right, improve=0.7298966, (0 missing)
      ACTCompositeScore       &lt; 16.5 to the right, improve=0.5009608, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 3.5  to the left,  agree=0.735, adj=0.427, (0 split)
      ACTCompositeScore       &lt; 15.5 to the right, agree=0.580, adj=0.093, (0 split)

Node number 4096: 84 observations
  predicted class=Meaningful emp NE                   expected loss=0.297619  P(node) =0.007625965
    class counts:    59    25
   probabilities: 0.702 0.298 

Node number 4097: 29 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3793103  P(node) =0.002632773
    class counts:    11    18
   probabilities: 0.379 0.621 

Node number 4098: 249 observations,    complexity param=0.0009276438
  predicted class=Meaningful emp NE                   expected loss=0.4859438  P(node) =0.02260554
    class counts:   128   121
   probabilities: 0.514 0.486 
  left son=8196 (73 obs) right son=8197 (176 obs)
  Primary splits:
      economic.status         splits as  RL,       improve=1.6245200, (0 missing)
      total.cte.courses.taken &lt; 2.5  to the right, improve=1.1572470, (0 missing)
      ACTCompositeScore       &lt; 14.5 to the left,  improve=0.7204349, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.4475080, (16 missing)
      cte.achievement         splits as  L-R,      improve=0.1620263, (0 missing)
  Surrogate splits:
      ACTCompositeScore &lt; 14.5 to the left,  agree=0.715, adj=0.027, (0 split)

Node number 4099: 77 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.3766234  P(node) =0.006990468
    class counts:    29    48
   probabilities: 0.377 0.623 
  left son=8198 (11 obs) right son=8199 (66 obs)
  Primary splits:
      ACTCompositeScore       &lt; 24.5 to the right, improve=5.0043290, (0 missing)
      pseo.participant        splits as  LR,       improve=0.6918550, (10 missing)
      economic.status         splits as  LR,       improve=0.5033284, (0 missing)
      MCA.M                   &lt; 3.5  to the right, improve=0.4058442, (0 missing)
      total.cte.courses.taken &lt; 6.5  to the right, improve=0.3426396, (0 missing)
  Surrogate splits:
      cte.achievement splits as  R-L, agree=0.883, adj=0.182, (0 split)

Node number 4118: 87 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4137931  P(node) =0.00789832
    class counts:    36    51
   probabilities: 0.414 0.586 
  left son=8236 (28 obs) right son=8237 (59 obs)
  Primary splits:
      total.cte.courses.taken &lt; 3.5  to the right, improve=4.3328050, (0 missing)
      MCA.R                   &lt; 2.5  to the right, improve=2.6406910, (2 missing)
      ACTCompositeScore       &lt; 14.5 to the right, improve=1.1176110, (0 missing)
      MCA.S                   &lt; 2.5  to the right, improve=0.6894934, (5 missing)
      Dem_Desc                splits as  RL-,      improve=0.4291188, (0 missing)

Node number 4119: 75 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.2666667  P(node) =0.006808897
    class counts:    20    55
   probabilities: 0.267 0.733 

Node number 8196: 73 observations
  predicted class=Meaningful emp NE                   expected loss=0.3972603  P(node) =0.006627326
    class counts:    44    29
   probabilities: 0.603 0.397 

Node number 8197: 176 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4772727  P(node) =0.01597821
    class counts:    84    92
   probabilities: 0.477 0.523 
  left son=16394 (116 obs) right son=16395 (60 obs)
  Primary splits:
      total.cte.courses.taken &lt; 2.5  to the right, improve=1.60668800, (0 missing)
      ACTCompositeScore       &lt; 23.5 to the left,  improve=0.80969040, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.49098490, (13 missing)
      cte.achievement         splits as  L-R,      improve=0.13542320, (0 missing)
      MCA.R                   &lt; 3.5  to the left,  improve=0.08746907, (1 missing)
  Surrogate splits:
      cte.achievement splits as  L-R, agree=0.739, adj=0.233, (0 split)

Node number 8198: 11 observations
  predicted class=Meaningful emp NE                   expected loss=0.1818182  P(node) =0.0009986382
    class counts:     9     2
   probabilities: 0.818 0.182 

Node number 8199: 66 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3030303  P(node) =0.005991829
    class counts:    20    46
   probabilities: 0.303 0.697 

Node number 8236: 28 observations
  predicted class=Meaningful emp NE                   expected loss=0.3571429  P(node) =0.002541988
    class counts:    18    10
   probabilities: 0.643 0.357 

Node number 8237: 59 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3050847  P(node) =0.005356332
    class counts:    18    41
   probabilities: 0.305 0.695 

Node number 16394: 116 observations,    complexity param=0.0009276438
  predicted class=Meaningful emp NE                   expected loss=0.4741379  P(node) =0.01053109
    class counts:    61    55
   probabilities: 0.526 0.474 
  left son=32788 (45 obs) right son=32789 (71 obs)
  Primary splits:
      total.cte.courses.taken &lt; 3.5  to the left,  improve=2.06767600, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=0.57526100, (7 missing)
      ACTCompositeScore       &lt; 16.5 to the left,  improve=0.29677560, (0 missing)
      MCA.R                   &lt; 3.5  to the right, improve=0.05412991, (0 missing)
      MCA.M                   &lt; 3.5  to the right, improve=0.01112258, (0 missing)
  Surrogate splits:
      cte.achievement splits as  R-L,    agree=0.672, adj=0.156, (0 split)
      RaceEthnicity   splits as  -L---R, agree=0.629, adj=0.044, (0 split)

Node number 16395: 60 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3833333  P(node) =0.005447118
    class counts:    23    37
   probabilities: 0.383 0.617 

Node number 32788: 45 observations
  predicted class=Meaningful emp NE                   expected loss=0.3555556  P(node) =0.004085338
    class counts:    29    16
   probabilities: 0.644 0.356 

Node number 32789: 71 observations,    complexity param=0.0009276438
  predicted class=No MN emp record, not attending ps  expected loss=0.4507042  P(node) =0.006445756
    class counts:    32    39
   probabilities: 0.451 0.549 
  left son=65578 (31 obs) right son=65579 (40 obs)
  Primary splits:
      total.cte.courses.taken &lt; 4.5  to the right, improve=1.85815500, (0 missing)
      ACTCompositeScore       &lt; 23.5 to the left,  improve=0.94941580, (0 missing)
      MCA.M                   &lt; 3.5  to the right, improve=0.08253901, (0 missing)
      pseo.participant        splits as  LR,       improve=0.06232335, (10 missing)
      MCA.S                   &lt; 3.5  to the right, improve=0.04656688, (2 missing)
  Surrogate splits:
      MCA.R             &lt; 3.5  to the left,  agree=0.634, adj=0.161, (0 split)
      ACTCompositeScore &lt; 25.5 to the right, agree=0.592, adj=0.065, (0 split)
      MCA.S             &lt; 1.5  to the left,  agree=0.577, adj=0.032, (0 split)

Node number 65578: 31 observations
  predicted class=Meaningful emp NE                   expected loss=0.4193548  P(node) =0.002814344
    class counts:    18    13
   probabilities: 0.581 0.419 

Node number 65579: 40 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.35  P(node) =0.003631412
    class counts:    14    26
   probabilities: 0.350 0.650 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning no mn emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore       cte.achievement         Dem_Desc               
 [4] economic.status         english.learner         grad.year.covid        
 [7] MCA.M                   MCA.R                   MCA.S                  
[10] pseo.participant        RaceEthnicity           range.school           
[13] SpecialEdStatus         took.ACT                total.cte.courses.taken

Root node error: 2926/11015 = 0.26564

n= 11015 

          CP nsplit rel error xerror     xstd
1 0.00095694      0   1.00000 1.0000 0.015842
2 0.00092764      7   0.99248 1.0072 0.015878
3 0.00092764     29   0.95796 1.0133 0.015909</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning no mn emp grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7318933</code></pre>
</div>
</div>
<p><br></p>
<p>This is a very complex tree. Honestly, it’s too complicated to interpret. But here’s a quick summary</p>
<p>Meaningful emp in NE</p>
<ul>
<li>SpecialEdStatus = 0</li>
<li>range.school = yes</li>
<li>MCA.M &lt; 3</li>
</ul>
<p>It tells me the following;</p>
<ul>
<li>Most important
<ul>
<li>SpecialEdStatus</li>
<li>ACTCompositeScore</li>
<li>took.ACT</li>
<li>range.school</li>
<li>english.learner</li>
<li>total.cte.courses.taken</li>
<li>grad.year.covid</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Less important
<ul>
<li>MCA.R</li>
<li>MCA.M</li>
<li>MCA.S</li>
<li>economic.status</li>
<li>Dem_Desc</li>
<li>pseo.participant</li>
</ul></li>
<li>Missing</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        SpecialEdStatus       ACTCompositeScore                took.ACT 
              71.640286               51.305234               38.691346 
           range.school         english.learner total.cte.courses.taken 
              27.141011               23.000788               19.562474 
        grad.year.covid         cte.achievement           RaceEthnicity 
              17.911454               12.420761               10.660305 
                  MCA.R                   MCA.M                   MCA.S 
               5.738743                5.224851                3.784273 
        economic.status                Dem_Desc        pseo.participant 
               3.757854                2.268136                1.719845 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance no mn emp grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The pre-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.7018213        0.7363405         0.7318933</code></pre>
</div>
</div>
</section>
<section id="summary-6" class="level3">
<h3 class="anchored" data-anchor-id="summary-6">Summary</h3>
<p>The pre-pruned treesprovided better accuracy than the base model so let’s use the most important variables from both.</p>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>ACTCompositeScore</li>
<li>range.school</li>
<li>english.learner</li>
<li>grad.year.covid</li>
</ul></li>
<li>Less important
<ul>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>economic.status</li>
<li>pseo.participant</li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>MCA.S</li>
<li>total.cte.courses.taken</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="five-year-after-graduation-1" class="level2">
<h2 class="anchored" data-anchor-id="five-year-after-graduation-1">Five year after graduation</h2>
<p>It probably doesn’t make sense to have a dataset with a bunch of post-secondary variables in it when exploring which variables make a difference in whether someone has meaningful workforce participation in the region one year after graduating high school. So, I’m going to delete all of them.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 20,595 individuals.The table below shows that a a minority of individuals have meaningful employment in the region - 27% compared to individuals with no meaningful employment and are not attending post-secondary.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-0b620945d84ddc5eeaa7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0b620945d84ddc5eeaa7">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","No MN emp record, not attending ps"],[5491,15104],["26.7%","73.3%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.5<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.5","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model-7" class="level3">
<h3 class="anchored" data-anchor-id="base-model-7">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(no.mn.emp.grad.year<span class="fl">.5</span>), <span class="fu">nrow</span>(no.mn.emp.grad.year<span class="fl">.5</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> no.mn.emp.grad.year<span class="fl">.5</span>[sample_ind,]</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> no.mn.emp.grad.year<span class="fl">.5</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is 0.95505 and the nsplit is 11.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot no mn emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] english.learner           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 3782/14416 = 0.26235

n= 14416 

           CP nsplit rel error  xerror     xstd
1  9.6069e-03      0   1.00000 1.00000 0.013966
2  8.3289e-03      3   0.97118 0.98017 0.013875
3  4.7594e-03      5   0.95452 0.96563 0.013807
4  2.9085e-03      6   0.94976 0.95928 0.013777
5  2.1153e-03      9   0.94104 0.95637 0.013763
6  1.3221e-03     10   0.93892 0.95664 0.013765
7  1.0576e-03     11   0.93760 0.95505 0.013757
8  9.2544e-04     21   0.92702 0.95796 0.013771
9  7.9323e-04     28   0.92015 0.95955 0.013778
10 7.2713e-04     35   0.91460 0.96113 0.013786
11 6.6103e-04     39   0.91169 0.96060 0.013783
12 6.1696e-04     45   0.90772 0.95955 0.013778
13 5.9492e-04     51   0.90190 0.95902 0.013776
14 5.2882e-04     55   0.89952 0.97039 0.013830
15 4.8475e-04     73   0.89001 0.97409 0.013847
16 4.7594e-04     81   0.88577 0.97832 0.013867
17 4.4068e-04     86   0.88340 0.97832 0.013867
18 3.9662e-04     97   0.87837 0.98070 0.013878
19 3.8193e-04    112   0.87123 0.98731 0.013908
20 3.5255e-04    123   0.86621 0.99365 0.013937
21 3.3051e-04    132   0.86304 1.00106 0.013971
22 3.1729e-04    152   0.85563 1.00820 0.014002
23 2.6441e-04    157   0.85405 1.03041 0.014100
24 2.2034e-04    247   0.82549 1.03199 0.014106
25 2.1153e-04    253   0.82417 1.04654 0.014168
26 1.9831e-04    265   0.82152 1.04733 0.014172
27 1.7627e-04    286   0.81571 1.05447 0.014201
28 1.3221e-04    302   0.81280 1.06029 0.014226
29 8.8137e-05    326   0.80962 1.07113 0.014270
30 6.6103e-05    343   0.80777 1.08355 0.014320
31 5.2882e-05    359   0.80672 1.08646 0.014331
32 3.7773e-05    393   0.80487 1.09228 0.014354
33 3.3051e-05    407   0.80434 1.09334 0.014359
34 0.0000e+00    423   0.80381 1.09307 0.014358</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot no mn emp grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector   total.cte.courses.taken 
                288.91775                 225.99825                 162.38981 
       highest.cred.level                  Dem_Desc         ACTCompositeScore 
                153.06017                 145.25419                 129.06929 
                  ps.grad           cte.achievement                     MCA.M 
                125.23688                  96.60899                  88.33559 
                    MCA.R              range.school                  took.ACT 
                 72.28240                  55.62779                  46.08924 
          economic.status          pseo.participant                     MCA.S 
                 45.26324                  43.58343                  35.64471 
            RaceEthnicity           SpecialEdStatus           english.learner 
                 35.59204                  34.76720                  11.81451 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance no mn emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7156498</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-7" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-7">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 1030</li>
<li>minbucket: round(minsplit / 3) which is 343</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">5.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.5</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">1030</span>, <span class="at">minbucket =</span> <span class="dv">343</span>))</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7392782</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .7392782 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot no mn emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 1030, 
        minbucket = 343))

Variables actually used in tree construction:
[1] cte.achievement  Dem_Desc         ps.grad.location pseo.participant
[5] range.school    

Root node error: 3782/14416 = 0.26235

n= 14416 

         CP nsplit rel error  xerror     xstd
1 0.0096069      0   1.00000 1.00000 0.013966
2 0.0083289      3   0.97118 0.98704 0.013907
3 0.0000000      5   0.95452 0.96087 0.013785</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location = In region | Inside and outside region
<ul>
<li>No: No MN emp record</li>
<li>Yes
<ul>
<li>range.school = non-range school
<ul>
<li>Dem_Desc = Urban/town/rural mix
<ul>
<li>cte.achievement = CTE Concentrator or Completor
<ul>
<li>pseo.participant = 0</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>Dem_Desc</li>
</ul></li>
<li>Less important
<ul>
<li>range.school</li>
<li>cte.achievement</li>
<li>pseo.participant</li>
<li>total.cte.courses.taken</li>
<li>took.ACT</li>
<li>MCA.M</li>
<li>SpecialEdStatus</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>english.learner</li>
<li>ACTCompositeScore</li>
<li>MCA.R</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
              254.8977032               159.8340605               107.2399326 
                  ps.grad                  Dem_Desc              range.school 
               89.3879442                58.8355900                20.8954807 
          cte.achievement          pseo.participant   total.cte.courses.taken 
               11.6428217                 9.5140179                 3.5195564 
                 took.ACT                     MCA.M           SpecialEdStatus 
                1.3669566                 1.1755827                 0.7928348 
            RaceEthnicity 
                0.4744806 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance no mn emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-7" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-7">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 14416 

           CP nsplit rel error    xerror       xstd
1 0.009606910      0 1.0000000 1.0000000 0.01396578
2 0.008328926      3 0.9711793 0.9801692 0.01387528
3 0.004759387      5 0.9545214 0.9656267 0.01380729
4 0.002908514      6 0.9497620 0.9592808 0.01377718
5 0.002115283      9 0.9410365 0.9563723 0.01376329
6 0.001322052     10 0.9389212 0.9566367 0.01376455
7 0.001057641     11 0.9375992 0.9550502 0.01375695

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       34                        21                        14 
                  ps.grad                  Dem_Desc              range.school 
                       12                        10                         3 
          cte.achievement          pseo.participant   total.cte.courses.taken 
                        2                         1                         1 
                    MCA.M             RaceEthnicity 
                        1                         1 

Node number 1: 14416 observations,    complexity param=0.00960691
  predicted class=No MN emp record, not attending ps  expected loss=0.2623474  P(node) =1
    class counts:  3782 10634
   probabilities: 0.262 0.738 
  left son=2 (3462 obs) right son=3 (10954 obs)
  Primary splits:
      ps.grad.location          splits as  RLRLRR, improve=254.49100, (3711 missing)
      ps.grad.InstitutionSector splits as  RLRRLR, improve=154.50810, (3711 missing)
      highest.cred.level        splits as  LRLLR,  improve=114.23870, (3711 missing)
      ps.grad                   splits as  LRL,    improve= 75.35082, (0 missing)
      Dem_Desc                  splits as  RRL,    improve= 46.59889, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RLRRLR, agree=0.879, adj=0.626, (0 split)
      highest.cred.level        splits as  LRLRR,  agree=0.811, adj=0.416, (0 split)
      ps.grad                   splits as  -RL,    agree=0.790, adj=0.351, (3608 split)

Node number 2: 3462 observations,    complexity param=0.00960691
  predicted class=No MN emp record, not attending ps  expected loss=0.4173888  P(node) =0.2401498
    class counts:  1445  2017
   probabilities: 0.417 0.583 
  left son=4 (2437 obs) right son=5 (1025 obs)
  Primary splits:
      range.school       splits as  LR,     improve=20.895480, (0 missing)
      Dem_Desc           splits as  RRL,    improve=20.017320, (0 missing)
      ps.grad.location   splits as  -L-R--, improve= 7.482893, (0 missing)
      highest.cred.level splits as  RRRL-,  improve= 5.317577, (0 missing)
      pseo.participant   splits as  LR,     improve= 4.098319, (1014 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 12.5 to the left,  agree=0.704, adj=0.001, (0 split)

Node number 3: 10954 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.2133467  P(node) =0.7598502
    class counts:  2337  8617
   probabilities: 0.213 0.787 

Node number 4: 2437 observations,    complexity param=0.00960691
  predicted class=No MN emp record, not attending ps  expected loss=0.453016  P(node) =0.1690483
    class counts:  1104  1333
   probabilities: 0.453 0.547 
  left son=8 (1569 obs) right son=9 (868 obs)
  Primary splits:
      Dem_Desc           splits as  RRL,      improve=58.835590, (0 missing)
      ps.grad.location   splits as  -L-R--,   improve= 6.298202, (0 missing)
      highest.cred.level splits as  RRRL-,    improve= 5.520455, (0 missing)
      cte.achievement    splits as  LRR,      improve= 5.128833, (0 missing)
      ACTCompositeScore  &lt; 28.5 to the left,  improve= 2.435595, (675 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 9.5  to the left,  agree=0.647, adj=0.009, (0 split)
      RaceEthnicity           splits as  RLLLL,    agree=0.647, adj=0.008, (0 split)
      ps.grad.location        splits as  -L-R--,   agree=0.646, adj=0.007, (0 split)

Node number 5: 1025 observations,    complexity param=0.004759387
  predicted class=No MN emp record, not attending ps  expected loss=0.3326829  P(node) =0.07110155
    class counts:   341   684
   probabilities: 0.333 0.667 
  left son=10 (68 obs) right son=11 (957 obs)
  Primary splits:
      Dem_Desc          splits as  -LR,      improve=13.080890, (0 missing)
      pseo.participant  splits as  LR,       improve= 3.928869, (297 missing)
      MCA.M             &lt; 1.5  to the right, improve= 2.925646, (5 missing)
      ACTCompositeScore &lt; 24.5 to the left,  improve= 2.801852, (385 missing)
      MCA.S             &lt; 3.5  to the left,  improve= 2.377471, (213 missing)

Node number 8: 1569 observations,    complexity param=0.008328926
  predicted class=Meaningful emp NE                   expected loss=0.4652645  P(node) =0.1088374
    class counts:   839   730
   probabilities: 0.535 0.465 
  left son=16 (378 obs) right son=17 (1191 obs)
  Primary splits:
      cte.achievement   splits as  LRR,      improve=11.642820, (0 missing)
      MCA.M             &lt; 3.5  to the left,  improve=10.075200, (23 missing)
      pseo.participant  splits as  LR,       improve= 7.999099, (455 missing)
      ACTCompositeScore &lt; 28.5 to the left,  improve= 5.340064, (390 missing)
      MCA.R             &lt; 3.5  to the left,  improve= 4.273537, (31 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 3.5  to the right, agree=0.82, adj=0.254, (0 split)

Node number 9: 868 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3052995  P(node) =0.06021088
    class counts:   265   603
   probabilities: 0.305 0.695 

Node number 10: 68 observations
  predicted class=Meaningful emp NE                   expected loss=0.3676471  P(node) =0.004716981
    class counts:    43    25
   probabilities: 0.632 0.368 

Node number 11: 957 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3113898  P(node) =0.06638457
    class counts:   298   659
   probabilities: 0.311 0.689 

Node number 16: 378 observations
  predicted class=Meaningful emp NE                   expected loss=0.3571429  P(node) =0.02622087
    class counts:   243   135
   probabilities: 0.643 0.357 

Node number 17: 1191 observations,    complexity param=0.008328926
  predicted class=Meaningful emp NE                   expected loss=0.4995802  P(node) =0.08261654
    class counts:   596   595
   probabilities: 0.500 0.500 
  left son=34 (412 obs) right son=35 (779 obs)
  Primary splits:
      pseo.participant   splits as  LR,       improve=9.514018, (275 missing)
      MCA.M              &lt; 3.5  to the left,  improve=5.947494, (16 missing)
      ACTCompositeScore  &lt; 28.5 to the left,  improve=5.344128, (250 missing)
      MCA.S              &lt; 2.5  to the left,  improve=3.611850, (212 missing)
      highest.cred.level splits as  RRRL-,    improve=3.191065, (0 missing)
  Surrogate splits:
      took.ACT                  splits as  LR,       agree=0.675, adj=0.144, (275 split)
      highest.cred.level        splits as  RRLR-,    agree=0.672, adj=0.138, (0 split)
      MCA.M                     &lt; 2.5  to the left,  agree=0.667, adj=0.124, (0 split)
      SpecialEdStatus           splits as  RL,       agree=0.652, adj=0.083, (0 split)
      ps.grad.InstitutionSector splits as  RR-RL-,   agree=0.639, adj=0.049, (0 split)

Node number 34: 412 observations,    complexity param=0.002115283
  predicted class=Meaningful emp NE                   expected loss=0.4223301  P(node) =0.02857936
    class counts:   238   174
   probabilities: 0.578 0.422 
  left son=68 (400 obs) right son=69 (12 obs)
  Primary splits:
      total.cte.courses.taken   &lt; 5.5  to the left,  improve=4.175793, (0 missing)
      RaceEthnicity             splits as  LRLRL,    improve=3.343483, (0 missing)
      ps.grad.InstitutionSector splits as  LR-RR-,   improve=2.075958, (0 missing)
      highest.cred.level        splits as  LLRL-,    improve=1.996221, (0 missing)
      MCA.M                     &lt; 1.5  to the left,  improve=1.518467, (8 missing)

Node number 35: 779 observations,    complexity param=0.002908514
  predicted class=No MN emp record, not attending ps  expected loss=0.4595635  P(node) =0.05403718
    class counts:   358   421
   probabilities: 0.460 0.540 
  left son=70 (462 obs) right son=71 (317 obs)
  Primary splits:
      MCA.M              &lt; 3.5  to the left,  improve=5.788957, (8 missing)
      ACTCompositeScore  &lt; 28.5 to the left,  improve=5.542653, (68 missing)
      MCA.S              &lt; 2.5  to the left,  improve=4.660681, (153 missing)
      highest.cred.level splits as  RRRL-,    improve=3.731595, (0 missing)
      cte.achievement    splits as  -LR,      improve=1.417979, (0 missing)
  Surrogate splits:
      ACTCompositeScore         &lt; 23.5 to the left,  agree=0.654, adj=0.152, (5 split)
      MCA.R                     &lt; 3.5  to the left,  agree=0.645, adj=0.130, (0 split)
      ps.grad.InstitutionSector splits as  RL-LL-,   agree=0.616, adj=0.060, (3 split)
      RaceEthnicity             splits as  RRLRL,    agree=0.599, adj=0.019, (0 split)
      total.cte.courses.taken   &lt; 3.5  to the left,  agree=0.593, adj=0.003, (0 split)

Node number 68: 400 observations,    complexity param=0.001322052
  predicted class=Meaningful emp NE                   expected loss=0.41  P(node) =0.02774695
    class counts:   236   164
   probabilities: 0.590 0.410 
  left son=136 (393 obs) right son=137 (7 obs)
  Primary splits:
      RaceEthnicity             splits as  LRLRL,    improve=2.848971, (0 missing)
      MCA.M                     &lt; 1.5  to the left,  improve=1.765145, (8 missing)
      ps.grad.InstitutionSector splits as  LR-RR-,   improve=1.725128, (0 missing)
      highest.cred.level        splits as  LLRL-,    improve=1.724514, (0 missing)
      ps.grad.location          splits as  -L-R--,   improve=1.542535, (0 missing)

Node number 69: 12 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.1666667  P(node) =0.0008324084
    class counts:     2    10
   probabilities: 0.167 0.833 

Node number 70: 462 observations,    complexity param=0.002908514
  predicted class=Meaningful emp NE                   expected loss=0.491342  P(node) =0.03204772
    class counts:   235   227
   probabilities: 0.509 0.491 
  left son=140 (25 obs) right son=141 (437 obs)
  Primary splits:
      RaceEthnicity      splits as  LRLLR,    improve=2.361033, (0 missing)
      highest.cred.level splits as  RRRL-,    improve=2.159117, (0 missing)
      cte.achievement    splits as  -LR,      improve=2.143038, (0 missing)
      MCA.S              &lt; 2.5  to the left,  improve=1.945102, (137 missing)
      ACTCompositeScore  &lt; 28.5 to the left,  improve=1.081003, (45 missing)

Node number 71: 317 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3880126  P(node) =0.02198946
    class counts:   123   194
   probabilities: 0.388 0.612 

Node number 136: 393 observations
  predicted class=Meaningful emp NE                   expected loss=0.4020356  P(node) =0.02726138
    class counts:   235   158
   probabilities: 0.598 0.402 

Node number 137: 7 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.1428571  P(node) =0.0004855716
    class counts:     1     6
   probabilities: 0.143 0.857 

Node number 140: 25 observations
  predicted class=Meaningful emp NE                   expected loss=0.28  P(node) =0.001734184
    class counts:    18     7
   probabilities: 0.720 0.280 

Node number 141: 437 observations,    complexity param=0.002908514
  predicted class=No MN emp record, not attending ps  expected loss=0.4965675  P(node) =0.03031354
    class counts:   217   220
   probabilities: 0.497 0.503 
  left son=282 (120 obs) right son=283 (317 obs)
  Primary splits:
      cte.achievement    splits as  -LR,      improve=2.9921740, (0 missing)
      highest.cred.level splits as  RRRL-,    improve=2.3343460, (0 missing)
      MCA.S              &lt; 2.5  to the left,  improve=1.4137890, (131 missing)
      MCA.R              &lt; 2.5  to the right, improve=0.9893619, (10 missing)
      ACTCompositeScore  &lt; 28.5 to the left,  improve=0.9682373, (41 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 1.5  to the right, agree=0.81, adj=0.308, (0 split)

Node number 282: 120 observations
  predicted class=Meaningful emp NE                   expected loss=0.4083333  P(node) =0.008324084
    class counts:    71    49
   probabilities: 0.592 0.408 

Node number 283: 317 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.4605678  P(node) =0.02198946
    class counts:   146   171
   probabilities: 0.461 0.539 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning no mn emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
[1] cte.achievement         Dem_Desc                MCA.M                  
[4] ps.grad.location        pseo.participant        RaceEthnicity          
[7] range.school            total.cte.courses.taken

Root node error: 3782/14416 = 0.26235

n= 14416 

         CP nsplit rel error  xerror     xstd
1 0.0096069      0   1.00000 1.00000 0.013966
2 0.0083289      3   0.97118 0.98017 0.013875
3 0.0047594      5   0.95452 0.96563 0.013807
4 0.0029085      6   0.94976 0.95928 0.013777
5 0.0021153      9   0.94104 0.95637 0.013763
6 0.0013221     10   0.93892 0.95664 0.013765
7 0.0010576     11   0.93760 0.95505 0.013757</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning no mn emp grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7421913</code></pre>
</div>
</div>
<p><br></p>
<p>This is a bit more simpler of a tree compared to the pre-pruned model.</p>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location = In region | Inside and outside region
<ul>
<li>No: No MN emp record</li>
<li>Yes
<ul>
<li>range.school = non-range school
<ul>
<li>Dem_Desc = Urban/Town/Rural mix
<ul>
<li>cte.achievement: completor or concentrator</li>
<li>cte.achievement: not completetor or concentrator
<ul>
<li>pseo.participant = 0</li>
<li>total.cte.courses.taken &lt; 6</li>
<li>RaceEthnicity = AI, Black, White</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>Dem_Desc</li>
</ul></li>
<li>Less important
<ul>
<li>range.school</li>
<li>cte.achievement</li>
<li>pseo.participant</li>
<li>total.cte.courses.taken</li>
<li>MCA.M</li>
<li>RaceEthnicity</li>
<li>took.ACT</li>
<li>ACTCompositeScore</li>
<li>SpecialEdStatus</li>
<li>MCA.R</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>english.learner</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
              254.8977032               160.1832357               107.2399326 
                  ps.grad                  Dem_Desc              range.school 
               89.3879442                71.9164837                20.8954807 
          cte.achievement          pseo.participant   total.cte.courses.taken 
               14.6349953                 9.5140179                 8.6363138 
                    MCA.M             RaceEthnicity                  took.ACT 
                6.9645401                 5.7947511                 1.3669566 
        ACTCompositeScore           SpecialEdStatus                     MCA.R 
                0.8821269                 0.7928348                 0.7534834 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance no mn emp grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The post-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.7156498        0.7392782         0.7421913</code></pre>
</div>
</div>
</section>
<section id="summary-7" class="level3">
<h3 class="anchored" data-anchor-id="summary-7">Summary</h3>
<p>The post-pruned tree provided better accuracy than the base model so let’s use the most important variables from both.</p>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
<li>Dem_Desc</li>
</ul></li>
<li>Less important
<ul>
<li>range.school</li>
<li>cte.achievement</li>
<li>pseo.participant</li>
<li>total.cte.courses.taken</li>
<li>MCA.M</li>
<li>RaceEthnicity</li>
<li>took.ACT</li>
<li>ACTCompositeScore</li>
<li>SpecialEdStatus</li>
<li>MCA.R</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>english.learner</li>
<li>MCA.S</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="ten-years-after-graduation-1" class="level2">
<h2 class="anchored" data-anchor-id="ten-years-after-graduation-1">Ten years after graduation</h2>
<p>It probably doesn’t make sense to have a dataset with a bunch of post-secondary variables in it when exploring which variables make a difference in whether someone has meaningful workforce participation in the region one year after graduating high school. So, I’m going to delete all of them.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>When filtering for individuals that had meaningful employment in NE vs MN one year after graduation we end up with 20,595 individuals.The table below shows that a a minority of individuals have meaningful employment in the region - 22% compared to individuals with no meaningful employment and are not attending post-secondary.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-45a5509d6c148c4ea384" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-45a5509d6c148c4ea384">{"x":{"filter":"none","vertical":false,"data":[["Meaningful emp NE","No MN emp record, not attending ps"],[3393,11909],["22.2%","77.8%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>grad.year.10<\/th>\n      <th>n<\/th>\n      <th>pct<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"grad.year.10","targets":0},{"name":"n","targets":1},{"name":"pct","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<section id="base-model-8" class="level3">
<h3 class="anchored" data-anchor-id="base-model-8">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(no.mn.emp.grad.year<span class="fl">.10</span>), <span class="fu">nrow</span>(no.mn.emp.grad.year<span class="fl">.10</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> no.mn.emp.grad.year<span class="fl">.10</span>[sample_ind,]</span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-7"><a href="#cb226-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> no.mn.emp.grad.year<span class="fl">.10</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is 0.95505 and the nsplit is 11.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot no.mn.emp.grad.year.10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] english.learner           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 2366/10711 = 0.22089

n= 10711 

           CP nsplit rel error  xerror     xstd
1  2.2823e-03      0   1.00000 1.00000 0.018146
2  2.1133e-03     11   0.96281 0.98056 0.018019
3  1.6906e-03     12   0.96069 0.97760 0.017999
4  1.0144e-03     14   0.95731 0.97380 0.017973
5  8.4531e-04     19   0.95224 0.98690 0.018061
6  7.6078e-04     33   0.93533 0.99112 0.018088
7  7.0442e-04     43   0.92773 0.99451 0.018111
8  6.3398e-04     67   0.90744 0.99915 0.018141
9  5.6354e-04     84   0.89603 0.99958 0.018144
10 5.2832e-04     87   0.89434 0.99915 0.018141
11 5.0719e-04     91   0.89222 0.99493 0.018113
12 4.8303e-04     97   0.88884 1.00296 0.018166
13 4.2265e-04    104   0.88546 1.01648 0.018253
14 3.7569e-04    135   0.87109 1.01902 0.018269
15 2.8177e-04    160   0.85757 1.04100 0.018407
16 2.1133e-04    166   0.85587 1.05621 0.018500
17 1.6906e-04    190   0.85038 1.07608 0.018620
18 1.4088e-04    200   0.84869 1.08622 0.018680
19 1.1271e-04    214   0.84658 1.08538 0.018675
20 1.0566e-04    233   0.84320 1.09214 0.018715
21 9.3923e-05    259   0.83939 1.09214 0.018715
22 7.0442e-05    268   0.83855 1.09214 0.018715
23 0.0000e+00    283   0.83686 1.10270 0.018776</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot no.mn.emp.grad.year.10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  total.cte.courses.taken          ps.grad.location ps.grad.InstitutionSector 
                143.53744                 127.58089                 103.03944 
       highest.cred.level           cte.achievement         ACTCompositeScore 
                101.50435                  83.61936                  81.69423 
             range.school                     MCA.M                     MCA.R 
                 81.28628                  57.05926                  53.96908 
                 Dem_Desc                  took.ACT                     MCA.S 
                 39.49950                  31.20350                  23.99201 
            RaceEthnicity           economic.status           SpecialEdStatus 
                 22.09528                  21.27384                  19.55049 
         pseo.participant                   ps.grad           english.learner 
                 15.37369                  14.76925                   5.60713 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance no.mn.emp.grad.year.10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7449357</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-8" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-8">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 765</li>
<li>minbucket: round(minsplit / 3) which is 255</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">10.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.10</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">765</span>, <span class="at">minbucket =</span> <span class="dv">255</span>))</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7782618</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .7782618 accuracy. Let’s see what variables are important in this model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot no MN emp grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 765, 
        minbucket = 255))

Variables actually used in tree construction:
[1] cte.achievement  Dem_Desc         ps.grad.location range.school    

Root node error: 2366/10711 = 0.22089

n= 10711 

         CP nsplit rel error  xerror     xstd
1 0.0017963      0   1.00000 1.00000 0.018146
2 0.0000000      4   0.99281 0.99281 0.018100</code></pre>
</div>
</div>
<p>The nodes show;</p>
<ul>
<li>ps.grad.location = In region
<ul>
<li>No: No MN emp record</li>
<li>Yes
<ul>
<li>Dem_Desc = Urban/town/rural mix
<ul>
<li>range.school = non-range school
<ul>
<li>cte.achievement = CTE Concentrator or Completor</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>range.school</li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
</ul></li>
<li>Less important
<ul>
<li>total.cte.courses.taken</li>
<li>took.ACT</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>english.learner</li>
<li>ACTCompositeScore</li>
<li>MCA.R</li>
<li>MCA.S</li>
<li>MCA.M</li>
<li>pseo.participant</li>
<li>SpecialEdStatus</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
               99.0877364                48.6801875                41.5746508 
             range.school                  Dem_Desc           cte.achievement 
               30.3002111                12.1345948                 7.6226331 
  total.cte.courses.taken                  took.ACT             RaceEthnicity 
                2.7450329                 1.4093121                 0.1191613 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance no.mn.emp.grad.year.10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-8" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-8">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb241-17"><a href="#cb241-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-18"><a href="#cb241-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb241-19"><a href="#cb241-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 10711 

           CP nsplit rel error    xerror       xstd
1 0.002282333      0 1.0000000 1.0000000 0.01814641
2 0.002113271     11 0.9628064 0.9805579 0.01801860
3 0.001690617     12 0.9606932 0.9775993 0.01799890
4 0.001014370     14 0.9573119 0.9737954 0.01797347

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       34                        19                        17 
             range.school   total.cte.courses.taken                  Dem_Desc 
                       10                         9                         4 
          cte.achievement                     MCA.R                     MCA.M 
                        3                         2                         1 
                 took.ACT 
                        1 

Node number 1: 10711 observations,    complexity param=0.002282333
  predicted class=No MN emp record, not attending ps  expected loss=0.2208944  P(node) =1
    class counts:  2366  8345
   probabilities: 0.221 0.779 
  left son=2 (2524 obs) right son=3 (8187 obs)
  Primary splits:
      ps.grad.location          splits as  RLRRRR,   improve=99.08774, (2639 missing)
      ps.grad.InstitutionSector splits as  RLRRLR,   improve=50.99514, (2639 missing)
      Dem_Desc                  splits as  RRL,      improve=42.82785, (0 missing)
      highest.cred.level        splits as  LRLRR,    improve=39.98886, (2639 missing)
      ACTCompositeScore         &lt; 28.5 to the left,  improve=20.09181, (5051 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RRRRLR, agree=0.841, adj=0.491, (0 split)
      highest.cred.level        splits as  LRLRR,  agree=0.816, adj=0.412, (0 split)

Node number 2: 2524 observations,    complexity param=0.002282333
  predicted class=No MN emp record, not attending ps  expected loss=0.3371632  P(node) =0.2356456
    class counts:   851  1673
   probabilities: 0.337 0.663 
  left son=4 (1913 obs) right son=5 (611 obs)
  Primary splits:
      Dem_Desc                  splits as  RRL,      improve=12.134590, (0 missing)
      range.school              splits as  LR,       improve=11.389420, (0 missing)
      ACTCompositeScore         &lt; 22.5 to the left,  improve= 5.151127, (944 missing)
      MCA.S                     &lt; 2.5  to the left,  improve= 2.279260, (986 missing)
      ps.grad.InstitutionSector splits as  RL-LL-,   improve= 2.064090, (0 missing)
  Surrogate splits:
      RaceEthnicity splits as  RLLLL, agree=0.76, adj=0.01, (0 split)

Node number 3: 8187 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.1850495  P(node) =0.7643544
    class counts:  1515  6672
   probabilities: 0.185 0.815 

Node number 4: 1913 observations,    complexity param=0.002282333
  predicted class=No MN emp record, not attending ps  expected loss=0.3648719  P(node) =0.1786014
    class counts:   698  1215
   probabilities: 0.365 0.635 
  left son=8 (1182 obs) right son=9 (731 obs)
  Primary splits:
      range.school              splits as  LR,       improve=30.300210, (0 missing)
      ACTCompositeScore         &lt; 22.5 to the left,  improve= 4.003663, (680 missing)
      ps.grad.InstitutionSector splits as  RL-RR-,   improve= 2.807113, (0 missing)
      total.cte.courses.taken   &lt; 7.5  to the left,  improve= 2.414585, (0 missing)
      MCA.S                     &lt; 3.5  to the left,  improve= 2.258496, (749 missing)
  Surrogate splits:
      took.ACT                splits as  RL,       agree=0.636, adj=0.047, (0 split)
      highest.cred.level      splits as  LLRL-,    agree=0.627, adj=0.025, (0 split)
      total.cte.courses.taken &lt; 7.5  to the left,  agree=0.624, adj=0.015, (0 split)

Node number 5: 611 observations,    complexity param=0.002282333
  predicted class=No MN emp record, not attending ps  expected loss=0.2504092  P(node) =0.05704416
    class counts:   153   458
   probabilities: 0.250 0.750 
  left son=10 (16 obs) right son=11 (595 obs)
  Primary splits:
      total.cte.courses.taken   &lt; 7.5  to the right, improve=10.382150, (0 missing)
      range.school              splits as  RL,       improve= 5.907423, (0 missing)
      highest.cred.level        splits as  RRLL-,    improve= 2.955916, (0 missing)
      ACTCompositeScore         &lt; 15.5 to the left,  improve= 2.463991, (264 missing)
      ps.grad.InstitutionSector splits as  RL-RL-,   improve= 2.206602, (0 missing)

Node number 8: 1182 observations,    complexity param=0.002282333
  predicted class=No MN emp record, not attending ps  expected loss=0.4348562  P(node) =0.1103538
    class counts:   514   668
   probabilities: 0.435 0.565 
  left son=16 (333 obs) right son=17 (849 obs)
  Primary splits:
      cte.achievement           splits as  LRR,      improve=7.622633, (0 missing)
      ps.grad.InstitutionSector splits as  RL-RR-,   improve=5.252383, (0 missing)
      MCA.M                     &lt; 3.5  to the left,  improve=3.345885, (16 missing)
      ACTCompositeScore         &lt; 17.5 to the left,  improve=2.321077, (323 missing)
      SpecialEdStatus           splits as  LR,       improve=2.042476, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 3.5  to the right, agree=0.803, adj=0.3, (0 split)

Node number 9: 731 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.25171  P(node) =0.0682476
    class counts:   184   547
   probabilities: 0.252 0.748 

Node number 10: 16 observations
  predicted class=Meaningful emp NE                   expected loss=0.1875  P(node) =0.001493791
    class counts:    13     3
   probabilities: 0.812 0.187 

Node number 11: 595 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.2352941  P(node) =0.05555037
    class counts:   140   455
   probabilities: 0.235 0.765 

Node number 16: 333 observations,    complexity param=0.002282333
  predicted class=Meaningful emp NE                   expected loss=0.4744745  P(node) =0.03108953
    class counts:   175   158
   probabilities: 0.526 0.474 
  left son=32 (34 obs) right son=33 (299 obs)
  Primary splits:
      total.cte.courses.taken &lt; 1.5  to the left,  improve=3.332444, (0 missing)
      MCA.M                   &lt; 2.5  to the left,  improve=2.256498, (7 missing)
      MCA.R                   &lt; 2.5  to the right, improve=1.652734, (7 missing)
      RaceEthnicity           splits as  LLRLR,    improve=1.606931, (0 missing)
      SpecialEdStatus         splits as  LR,       improve=1.481131, (0 missing)

Node number 17: 849 observations,    complexity param=0.002282333
  predicted class=No MN emp record, not attending ps  expected loss=0.3992933  P(node) =0.07926431
    class counts:   339   510
   probabilities: 0.399 0.601 
  left son=34 (78 obs) right son=35 (771 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RL-RR-,   improve=6.230763, (0 missing)
      MCA.S                     &lt; 2.5  to the left,  improve=2.755209, (284 missing)
      ACTCompositeScore         &lt; 17.5 to the left,  improve=2.151730, (192 missing)
      MCA.M                     &lt; 3.5  to the left,  improve=1.981446, (9 missing)
      RaceEthnicity             splits as  LRRRR,    improve=1.238569, (0 missing)

Node number 32: 34 observations
  predicted class=Meaningful emp NE                   expected loss=0.2647059  P(node) =0.003174307
    class counts:    25     9
   probabilities: 0.735 0.265 

Node number 33: 299 observations,    complexity param=0.002282333
  predicted class=Meaningful emp NE                   expected loss=0.4983278  P(node) =0.02791523
    class counts:   150   149
   probabilities: 0.502 0.498 
  left son=66 (170 obs) right son=67 (129 obs)
  Primary splits:
      MCA.M                   &lt; 2.5  to the left,  improve=2.6023490, (4 missing)
      MCA.R                   &lt; 2.5  to the right, improve=2.1626440, (4 missing)
      RaceEthnicity           splits as  LLRLR,    improve=1.8415800, (0 missing)
      SpecialEdStatus         splits as  LR,       improve=1.1794870, (0 missing)
      total.cte.courses.taken &lt; 4.5  to the left,  improve=0.9387483, (0 missing)
  Surrogate splits:
      MCA.R                     &lt; 3.5  to the left,  agree=0.783, adj=0.504, (2 split)
      ps.grad.InstitutionSector splits as  RR-RL-,   agree=0.698, adj=0.310, (2 split)
      highest.cred.level        splits as  LRLR-,    agree=0.695, adj=0.302, (0 split)
      took.ACT                  splits as  LR,       agree=0.654, adj=0.209, (0 split)
      total.cte.courses.taken   &lt; 8.5  to the left,  agree=0.566, adj=0.008, (0 split)

Node number 34: 78 observations,    complexity param=0.002282333
  predicted class=Meaningful emp NE                   expected loss=0.4102564  P(node) =0.007282233
    class counts:    46    32
   probabilities: 0.590 0.410 
  left son=68 (54 obs) right son=69 (24 obs)
  Primary splits:
      total.cte.courses.taken &lt; 1.5  to the left,  improve=3.1972930, (0 missing)
      ACTCompositeScore       &lt; 19.5 to the left,  improve=1.7876680, (8 missing)
      cte.achievement         splits as  -RL,      improve=1.6500050, (0 missing)
      MCA.S                   &lt; 2.5  to the left,  improve=1.5013810, (19 missing)
      pseo.participant        splits as  RL,       improve=0.2095238, (36 missing)
  Surrogate splits:
      cte.achievement splits as  -RL, agree=0.833, adj=0.458, (0 split)

Node number 35: 771 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3800259  P(node) =0.07198207
    class counts:   293   478
   probabilities: 0.380 0.620 

Node number 66: 170 observations,    complexity param=0.002282333
  predicted class=Meaningful emp NE                   expected loss=0.4411765  P(node) =0.01587153
    class counts:    95    75
   probabilities: 0.559 0.441 
  left son=132 (118 obs) right son=133 (52 obs)
  Primary splits:
      MCA.R                     &lt; 2.5  to the right, improve=4.159716, (4 missing)
      ps.grad.InstitutionSector splits as  LL-LR-,   improve=3.147339, (0 missing)
      highest.cred.level        splits as  RLRL-,    improve=3.147339, (0 missing)
      took.ACT                  splits as  RL,       improve=1.947833, (0 missing)
      ACTCompositeScore         &lt; 20.5 to the right, improve=1.824684, (92 missing)
  Surrogate splits:
      SpecialEdStatus splits as  LR, agree=0.771, adj=0.255, (4 split)
      english.learner splits as  LR, agree=0.705, adj=0.039, (0 split)

Node number 67: 129 observations,    complexity param=0.002282333
  predicted class=No MN emp record, not attending ps  expected loss=0.4263566  P(node) =0.01204369
    class counts:    55    74
   probabilities: 0.426 0.574 
  left son=134 (24 obs) right son=135 (105 obs)
  Primary splits:
      highest.cred.level      splits as  RRLL-,    improve=4.6888700, (0 missing)
      total.cte.courses.taken &lt; 4.5  to the left,  improve=3.1521120, (0 missing)
      ACTCompositeScore       &lt; 24.5 to the right, improve=2.6510860, (25 missing)
      MCA.S                   &lt; 3.5  to the right, improve=0.8324016, (35 missing)
      took.ACT                splits as  LR,       improve=0.5438521, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 8.5  to the right, agree=0.822, adj=0.042, (0 split)

Node number 68: 54 observations
  predicted class=Meaningful emp NE                   expected loss=0.3148148  P(node) =0.005041546
    class counts:    37    17
   probabilities: 0.685 0.315 

Node number 69: 24 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.375  P(node) =0.002240687
    class counts:     9    15
   probabilities: 0.375 0.625 

Node number 132: 118 observations,    complexity param=0.001690617
  predicted class=Meaningful emp NE                   expected loss=0.3644068  P(node) =0.01101671
    class counts:    75    43
   probabilities: 0.636 0.364 
  left son=264 (86 obs) right son=265 (32 obs)
  Primary splits:
      highest.cred.level        splits as  LLRL-,    improve=2.4444470, (0 missing)
      ps.grad.InstitutionSector splits as  LL-LR-,   improve=2.2491330, (0 missing)
      took.ACT                  splits as  RL,       improve=1.0667890, (0 missing)
      RaceEthnicity             splits as  LL-LR,    improve=0.7305150, (0 missing)
      ACTCompositeScore         &lt; 20.5 to the right, improve=0.7009729, (55 missing)

Node number 133: 52 observations,    complexity param=0.002113271
  predicted class=No MN emp record, not attending ps  expected loss=0.3846154  P(node) =0.004854822
    class counts:    20    32
   probabilities: 0.385 0.615 
  left son=266 (9 obs) right son=267 (43 obs)
  Primary splits:
      total.cte.courses.taken &lt; 6.5  to the right, improve=3.36473900, (0 missing)
      ACTCompositeScore       &lt; 16.5 to the right, improve=0.34285710, (37 missing)
      MCA.S                   &lt; 1.5  to the left,  improve=0.15824180, (32 missing)
      economic.status         splits as  LR,       improve=0.07788462, (0 missing)
      highest.cred.level      splits as  LRR--,    improve=0.02279202, (0 missing)

Node number 134: 24 observations
  predicted class=Meaningful emp NE                   expected loss=0.2916667  P(node) =0.002240687
    class counts:    17     7
   probabilities: 0.708 0.292 

Node number 135: 105 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3619048  P(node) =0.009803006
    class counts:    38    67
   probabilities: 0.362 0.638 

Node number 264: 86 observations
  predicted class=Meaningful emp NE                   expected loss=0.3023256  P(node) =0.008029129
    class counts:    60    26
   probabilities: 0.698 0.302 

Node number 265: 32 observations,    complexity param=0.001690617
  predicted class=No MN emp record, not attending ps  expected loss=0.46875  P(node) =0.002987583
    class counts:    15    17
   probabilities: 0.469 0.531 
  left son=530 (14 obs) right son=531 (18 obs)
  Primary splits:
      total.cte.courses.taken &lt; 4.5  to the right, improve=3.00099200, (0 missing)
      MCA.R                   &lt; 3.5  to the right, improve=0.42952310, (1 missing)
      economic.status         splits as  RL,       improve=0.02840909, (0 missing)
      MCA.M                   &lt; 1.5  to the right, improve=0.01328273, (1 missing)
  Surrogate splits:
      MCA.M    &lt; 1.5  to the right, agree=0.656, adj=0.214, (0 split)
      took.ACT splits as  RL,       agree=0.625, adj=0.143, (0 split)

Node number 266: 9 observations
  predicted class=Meaningful emp NE                   expected loss=0.2222222  P(node) =0.0008402577
    class counts:     7     2
   probabilities: 0.778 0.222 

Node number 267: 43 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.3023256  P(node) =0.004014564
    class counts:    13    30
   probabilities: 0.302 0.698 

Node number 530: 14 observations
  predicted class=Meaningful emp NE                   expected loss=0.2857143  P(node) =0.001307068
    class counts:    10     4
   probabilities: 0.714 0.286 

Node number 531: 18 observations
  predicted class=No MN emp record, not attending ps  expected loss=0.2777778  P(node) =0.001680515
    class counts:     5    13
   probabilities: 0.278 0.722 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning no.mn.emp.grad.year.10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
[1] cte.achievement           Dem_Desc                 
[3] highest.cred.level        MCA.M                    
[5] MCA.R                     ps.grad.InstitutionSector
[7] ps.grad.location          range.school             
[9] total.cte.courses.taken  

Root node error: 2366/10711 = 0.22089

n= 10711 

         CP nsplit rel error  xerror     xstd
1 0.0022823      0   1.00000 1.00000 0.018146
2 0.0021133     11   0.96281 0.98056 0.018019
3 0.0016906     12   0.96069 0.97760 0.017999
4 0.0010144     14   0.95731 0.97380 0.017973</code></pre>
</div>
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning no.mn.emp.grad.year.10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7767371</code></pre>
</div>
</div>
<p><br></p>
<p>This is a bit more complex of a tree compared to the pre-pruned model. Honestly, it’s too complex to interpret.</p>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>range.school</li>
<li>total.cte.courses.taken</li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
</ul></li>
<li>Less important
<ul>
<li>MCA.R</li>
<li>MCA.M</li>
<li>took.ACT</li>
<li>SpecialEdStatus</li>
<li>english.learner</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>pseo.participant</li>
<li>SpecialEdStatus</li>
<li>ps.grad</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
               99.0877364                55.7178807                49.4947251 
             range.school   total.cte.courses.taken                  Dem_Desc 
               30.3002111                26.2381925                12.1345948 
          cte.achievement                     MCA.R                     MCA.M 
                9.0880593                 5.4709773                 3.2454189 
                 took.ACT           SpecialEdStatus           english.learner 
                2.3827030                 1.0603198                 0.1631261 
            RaceEthnicity 
                0.1191613 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> no.mn.emp.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance no.mn.emp.grad.year.10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The pre-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.7449357        0.7782618         0.7767371</code></pre>
</div>
</div>
</section>
<section id="summary-8" class="level3">
<h3 class="anchored" data-anchor-id="summary-8">Summary</h3>
<p>The pre-pruned tree provided better accuracy than the base model so let’s use the most important variables from both.</p>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>range.school</li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
</ul></li>
<li>Less important
<ul>
<li>total.cte.courses.taken</li>
<li>took.ACT</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>english.learner</li>
<li>ACTCompositeScore</li>
<li>MCA.R</li>
<li>MCA.S</li>
<li>MCA.M</li>
<li>pseo.participant</li>
<li>SpecialEdStatus</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="important-variables-through-time-2" class="level2">
<h2 class="anchored" data-anchor-id="important-variables-through-time-2">Important variables through time</h2>
<p>The following table provides the level of important for each grad.year.x in the above analysis. Here are the primary themes;</p>
<ul>
<li>Variables that are never important
<ul>
<li>economic.status</li>
</ul></li>
<li>A few that just don’t make the cut either
<ul>
<li>pseo.participante</li>
<li>MCA.S</li>
<li>ps.grad</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>grad.year.covid</li>
</ul></li>
<li>Varaibles that are very important 5 and 10 years after graduating high school
<ul>
<li>Dem_Desc</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad.location</li>
</ul></li>
<li>Others that seem important
<ul>
<li>range.school</li>
<li>cte.achievement</li>
<li>total.cte.courses.taken</li>
<li>SpecialEdStatus</li>
<li>took.ACT</li>
<li>RaceEthnicity</li>
</ul></li>
<li>One variable that stays important throughout the entire analysis
<ul>
<li>SpecialEdStatus</li>
</ul></li>
<li>One variable that starts as important but loses importance over time
<ul>
<li>ACTCompositeScore</li>
</ul></li>
<li>There are a few variables that are important five and ten years after graduating high school;
<ul>
<li>ps.grad.location</li>
<li>highest.cred.earned</li>
<li>ps.grad</li>
<li>ps.grad.InstitutionSector</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>A few that are important once and less so once
<ul>
<li>economic.status</li>
<li>cte.achievement</li>
<li>RaceEthnicity</li>
<li>took.ACT</li>
</ul></li>
<li>A couple of variables that stay either important or less so throughout the years
<ul>
<li>economic.status</li>
<li>Dem_Desc</li>
<li>RaceEthnicity</li>
<li>cte.achievement</li>
<li>ACTCompositeScore</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>Variables that had some importance five and ten years after graduating high school
<ul>
<li>Dem_Desc</li>
<li>range.school</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>english.learner</li>
<li>english.learner</li>
</ul></li>
</ul>
<p>The variables to keep by group are;</p>
<ul>
<li>Demographics
<ul>
<li><del>grad.year.covid</del></li>
<li><del>economic.status</del></li>
<li>RaceEthnicity</li>
<li>SpecialEdStatus</li>
<li>english.learner</li>
</ul></li>
<li>CTE engagement
<ul>
<li>cte.achievement</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>HS Characteristics
<ul>
<li>Dem_Desc</li>
<li>range.school</li>
</ul></li>
<li>Prep for PS
<ul>
<li><del>pseo.participant</del></li>
<li><del>MCA.M</del></li>
<li><del>MCA.R</del></li>
<li><del>MCA.S</del></li>
<li>ACTCompositeScore</li>
<li>took.act</li>
</ul></li>
<li>Post-secondary path
<ul>
<li><del>ps.grad</del></li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad.location</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-3ee377f8ddfef6ef6d4a" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3ee377f8ddfef6ef6d4a">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;grad.year.covid&quot;,&quot;economic.status&quot;,&quot;range.school&quot;,&quot;pseo.participant&quot;,&quot;SpecialEdStatus&quot;,&quot;RaceEthnicity&quot;,&quot;Dem_Desc&quot;,&quot;took.ACT&quot;,&quot;cte.achievement&quot;,&quot;english.learner&quot;,&quot;ps.grad&quot;,&quot;ps.grad.InstitutionSector&quot;,&quot;highest.cred.level&quot;,&quot;ps.grad.location&quot;,&quot;ACTCompositeScore&quot;,&quot;MCA.M&quot;,&quot;MCA.R&quot;,&quot;MCA.S&quot;,&quot;total.cte.courses.taken&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["grad.year.covid","economic.status","range.school","pseo.participant","SpecialEdStatus","RaceEthnicity","Dem_Desc","took.ACT","cte.achievement","english.learner","ps.grad","ps.grad.InstitutionSector","highest.cred.level","ps.grad.location","ACTCompositeScore","MCA.M","MCA.R","MCA.S","total.cte.courses.taken"],["Demographics","Demographics","HS Characteristics","Prep for PS","Demographics","Demographics","HS Characteristics","Prep for PS","CTE Engagement","Demographics","Post-secondary path","Post-secondary path","Post-secondary path","Post-secondary path","Prep for PS","Prep for PS","Prep for PS","Prep for PS","CTE Engagement"],["Important","","Important","","Important","Less so","","Important","","Important","","","","","Important","","","",""],["","","Less so","Less so","Less so","Less so","Important","Less so","Less so","","Important","Important","Important","Important","Less so","Less so","Less so","","Less so"],["","","Important","","","Less so","Important","Less so","Important","","","Important","Important","Important","","","","","Less so"]],"container":"<table class=\"cell-border stripe\">\n  <thead>\n    <tr>\n      <th>ind.var<\/th>\n      <th>var.group<\/th>\n      <th>year.one<\/th>\n      <th>year.five<\/th>\n      <th>year.ten<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-center","targets":[1,2]},{"name":"ind.var","targets":0},{"name":"var.group","targets":1},{"name":"year.one","targets":2},{"name":"year.five","targets":3},{"name":"year.ten","targets":4}],"pageLength":20,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,20,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="meaningful-emp-in-ne" class="level1">
<h1>Meaningful emp in NE</h1>
<p>First, let’s re-categorize the dependent variables so that they are binary.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne <span class="ot">&lt;-</span> master <span class="sc">%&gt;%</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">grad.year.1 =</span> <span class="fu">ifelse</span>(grad.year<span class="fl">.1</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Meaningful emp NE"</span>), <span class="st">"Meaningful emp NE"</span>, </span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(grad.year<span class="fl">.1</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Meaningful emp MN"</span>, <span class="st">"Not meaningful, not attending ps"</span>, <span class="st">"No MN emp record, not attending ps"</span>), <span class="st">"No meaningful emp NE"</span>,</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(grad.year<span class="fl">.1</span> <span class="sc">==</span> <span class="st">"After 2023"</span>, <span class="st">"After 2023"</span>,</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">ifelse</span>(grad.year<span class="fl">.1</span> <span class="sc">==</span> <span class="st">"Attending ps"</span>, <span class="st">"Attending ps"</span>, <span class="fu">as.character</span>(grad.year<span class="fl">.1</span>))))),</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.1 =</span> <span class="fu">as.factor</span>(grad.year<span class="fl">.1</span>),</span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.5 =</span> <span class="fu">ifelse</span>(grad.year<span class="fl">.5</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Meaningful emp NE"</span>), <span class="st">"Meaningful emp NE"</span>, </span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(grad.year<span class="fl">.5</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Meaningful emp MN"</span>, <span class="st">"Not meaningful, not attending ps"</span>, <span class="st">"No MN emp record, not attending ps"</span>), <span class="st">"No meaningful emp NE"</span>,</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(grad.year<span class="fl">.5</span> <span class="sc">==</span> <span class="st">"After 2023"</span>, <span class="st">"After 2023"</span>,</span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">ifelse</span>(grad.year<span class="fl">.5</span> <span class="sc">==</span> <span class="st">"Attending ps"</span>, <span class="st">"Attending ps"</span>, <span class="fu">as.character</span>(grad.year<span class="fl">.5</span>))))),</span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.5 =</span> <span class="fu">as.factor</span>(grad.year<span class="fl">.5</span>),</span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.10 =</span> <span class="fu">ifelse</span>(grad.year<span class="fl">.10</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Meaningful emp NE"</span>), <span class="st">"Meaningful emp NE"</span>, </span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">ifelse</span>(grad.year<span class="fl">.10</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Meaningful emp MN"</span>, <span class="st">"Not meaningful, not attending ps"</span>, <span class="st">"No MN emp record, not attending ps"</span>), <span class="st">"No meaningful emp NE"</span>,</span>
<span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(grad.year<span class="fl">.10</span> <span class="sc">==</span> <span class="st">"After 2023"</span>, <span class="st">"After 2023"</span>,</span>
<span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">ifelse</span>(grad.year<span class="fl">.10</span> <span class="sc">==</span> <span class="st">"Attending ps"</span>, <span class="st">"Attending ps"</span>, <span class="fu">as.character</span>(grad.year<span class="fl">.10</span>))))),</span>
<span id="cb254-16"><a href="#cb254-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.10 =</span> <span class="fu">as.factor</span>(grad.year<span class="fl">.10</span>),</span>
<span id="cb254-17"><a href="#cb254-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.1 =</span> <span class="fu">fct_relevel</span>(grad.year<span class="fl">.1</span>, <span class="st">"Meaningful emp NE"</span>, <span class="st">"No meaningful emp NE"</span>, <span class="st">"Attending ps"</span>, <span class="st">"After 2023"</span>),</span>
<span id="cb254-18"><a href="#cb254-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.5 =</span> <span class="fu">fct_relevel</span>(grad.year<span class="fl">.5</span>, <span class="st">"Meaningful emp NE"</span>, <span class="st">"No meaningful emp NE"</span>, <span class="st">"Attending ps"</span>, <span class="st">"After 2023"</span>),</span>
<span id="cb254-19"><a href="#cb254-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad.year.10 =</span> <span class="fu">fct_relevel</span>(grad.year<span class="fl">.10</span>, <span class="st">"Meaningful emp NE"</span>, <span class="st">"No meaningful emp NE"</span>, <span class="st">"Attending ps"</span>, <span class="st">"After 2023"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<section id="one-year-after-graduation-3" class="level2">
<h2 class="anchored" data-anchor-id="one-year-after-graduation-3">One year after graduation</h2>
<p>Since our dependent variable includes a state in which someone is attending post-secondary and the post-secondary variables are related to an individual finishing post-secondary, we will remove “ps.grad.InstitutionSector” and the “highest.cred.level” variable from the analysis.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.1</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="base-model-9" class="level3">
<h3 class="anchored" data-anchor-id="base-model-9">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(meaningful.emp.ne.grad.year<span class="fl">.1</span>), <span class="fu">nrow</span>(meaningful.emp.ne.grad.year<span class="fl">.1</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year<span class="fl">.1</span>[sample_ind,]</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year<span class="fl">.1</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is .95105 and the nsplit is 2.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp NE grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] grad.year.covid           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 2901/15927 = 0.18214

n= 15927 

           CP nsplit rel error  xerror     xstd
1  2.6887e-02      0   1.00000 1.00000 0.016791
2  2.2061e-02      1   0.97311 0.99862 0.016782
3  5.1706e-03      2   0.95105 0.95105 0.016463
4  3.1024e-03      3   0.94588 0.95209 0.016471
5  2.9300e-03      4   0.94278 0.95726 0.016506
6  1.6086e-03      6   0.93692 0.95863 0.016515
7  1.4937e-03      9   0.93209 0.95553 0.016494
8  1.3788e-03     12   0.92761 0.95588 0.016496
9  1.2065e-03     13   0.92623 0.95657 0.016501
10 1.0341e-03     22   0.91486 0.95312 0.016478
11 8.6177e-04     24   0.91279 0.95450 0.016487
12 6.8942e-04     35   0.90314 0.96001 0.016525
13 6.0324e-04     42   0.89728 0.96174 0.016536
14 5.7451e-04     49   0.89245 0.96484 0.016557
15 5.1706e-04     60   0.88556 0.96656 0.016569
16 4.8259e-04     66   0.88245 0.96967 0.016590
17 4.4320e-04     72   0.87935 0.97036 0.016594
18 3.4471e-04     81   0.87487 0.97070 0.016597
19 2.5853e-04     95   0.87004 0.98656 0.016702
20 2.2981e-04    103   0.86798 1.00103 0.016797
21 2.1544e-04    119   0.86350 1.00345 0.016813
22 2.0683e-04    149   0.85522 1.00552 0.016826
23 1.7235e-04    159   0.85315 1.02551 0.016955
24 1.4773e-04    169   0.85143 1.02792 0.016970
25 1.1490e-04    176   0.85040 1.03171 0.016994
26 1.0341e-04    179   0.85005 1.04137 0.017055
27 8.6177e-05    189   0.84902 1.04791 0.017096
28 4.5961e-05    197   0.84833 1.06239 0.017186
29 4.3089e-05    212   0.84764 1.07067 0.017236
30 3.1337e-05    233   0.84660 1.07067 0.017236
31 0.0000e+00    244   0.84626 1.07239 0.017247</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp NE grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p>Below are the values in variable importance and there are a couple of themes of importance;</p>
<ol type="1">
<li>post-secondary pathway</li>
<li>cte involvement</li>
<li>Prep for post-secondary</li>
<li>demographics, range school,</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
               424.875296                308.828111                216.667009 
                  ps.grad   total.cte.courses.taken         ACTCompositeScore 
               163.407834                 82.781890                 61.685269 
          cte.achievement                     MCA.R                     MCA.M 
                50.583084                 47.596136                 45.735542 
            RaceEthnicity              range.school           economic.status 
                44.886519                 37.954034                 33.493354 
                    MCA.S                  Dem_Desc           grad.year.covid 
                31.560168                 26.357208                 23.820909 
                 took.ACT           SpecialEdStatus          pseo.participant 
                22.629558                 19.631001                 15.400998 
          english.learner 
                 7.386756 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance meaningful emp NE grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8095796</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="pre-pruning-9" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-9">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 1,138</li>
<li>minbucket: round(minsplit / 3) - 379</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grow a tree with minsplit of 40 and max depth of 10</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.1</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">3</span>, <span class="at">minsplit =</span> <span class="dv">1138</span>, <span class="at">minbucket =</span> <span class="dv">379</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp NE grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 3, minsplit = 1138, 
        minbucket = 379))

Variables actually used in tree construction:
[1] highest.cred.level ps.grad.location  

Root node error: 2901/15927 = 0.18214

n= 15927 

        CP nsplit rel error  xerror     xstd
1 0.026887      0   1.00000 1.00000 0.016791
2 0.022061      1   0.97311 1.00034 0.016793
3 0.000000      2   0.95105 0.95105 0.016463</code></pre>
</div>
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp NE grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8258386</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .827 accuracy. Let’s see what variables are important in this model.</p>
<p>Overall, these are the most important themes;</p>
<ul>
<li>Most important - post-secondary pathways
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
</ul></li>
<li>Less important
<ul>
<li>SpecialEdStatus</li>
<li>Prep for post-secondary
<ul>
<li>took.ACT</li>
<li>MCA.R</li>
</ul></li>
<li>english.learner</li>
<li>grad.year.covid</li>
</ul></li>
<li>Missing:
<ul>
<li>economic.status</li>
<li>range.school</li>
<li>pseo.participant</li>
<li>RaceEthnicity</li>
<li>Dem_Desc</li>
<li>CTE engagement</li>
<li>ACTCompositeScore</li>
<li>MCA.S</li>
<li>MCA.M</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
              409.7165793               275.7306040               199.0706306 
                  ps.grad           SpecialEdStatus                  took.ACT 
              129.2114194                 1.5851381                 0.6674266 
                    MCA.R           english.learner           grad.year.covid 
                0.5839983                 0.5283794                 0.4171416 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance meaningful emp SW grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-9" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-9">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. There are two methods for identifying the CP code;</p>
<ol type="1">
<li>Use the cp value with the lowest xerror from the base model.</li>
<li>Use the cp value with the next lowest xerror that is within the standard error.</li>
</ol>
<p>In this case, the lowest cp has only a couple of nsplits, so we will use that value.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-15"><a href="#cb272-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb272-16"><a href="#cb272-16" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model, <span class="at">cp =</span> .<span class="dv">0031024</span>)</span>
<span id="cb272-17"><a href="#cb272-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-18"><a href="#cb272-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb272-19"><a href="#cb272-19" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))
  n= 15927 

           CP nsplit rel error    xerror       xstd
1 0.026887280      0 1.0000000 1.0000000 0.01679054
2 0.022061358      1 0.9731127 0.9986212 0.01678154
3 0.005170631      2 0.9510514 0.9510514 0.01646346
4 0.003102400      3 0.9458807 0.9520855 0.01647053

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       40                        27                        19 
                  ps.grad             RaceEthnicity 
                       13                         1 

Node number 1: 15927 observations,    complexity param=0.02688728
  predicted class=No meaningful emp NE  expected loss=0.1821435  P(node) =1
    class counts:  2901 13026
   probabilities: 0.182 0.818 
  left son=2 (1374 obs) right son=3 (14553 obs)
  Primary splits:
      ps.grad.location          splits as  RLRLRR, improve=409.7166, (3590 missing)
      ps.grad.InstitutionSector splits as  RLRRLR, improve=324.4186, (3590 missing)
      highest.cred.level        splits as  LLLRR,  improve=279.3982, (3590 missing)
      ps.grad                   splits as  LRL,    improve=223.2052, (0 missing)
      SpecialEdStatus           splits as  LR,     improve= 44.3790, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RLRRLR, agree=0.964, adj=0.673, (0 split)
      highest.cred.level        splits as  LRLRR,  agree=0.939, adj=0.453, (0 split)
      ps.grad                   splits as  -RL,    agree=0.924, adj=0.315, (2951 split)

Node number 2: 1374 observations,    complexity param=0.02206136
  predicted class=Meaningful emp NE     expected loss=0.4716157  P(node) =0.0862686
    class counts:   726   648
   probabilities: 0.528 0.472 
  left son=4 (890 obs) right son=5 (484 obs)
  Primary splits:
      highest.cred.level        splits as  LLRR-,   improve=13.459770, (1 missing)
      took.ACT                  splits as  RL,      improve= 7.832194, (0 missing)
      MCA.M                     &lt; 1.5 to the right, improve= 5.724150, (30 missing)
      SpecialEdStatus           splits as  LR,      improve= 4.902956, (0 missing)
      ps.grad.InstitutionSector splits as  LL-LR-,  improve= 4.626896, (1 missing)
  Surrogate splits:
      SpecialEdStatus splits as  LR,      agree=0.689, adj=0.118, (1 split)
      took.ACT        splits as  RL,      agree=0.665, adj=0.050, (0 split)
      MCA.R           &lt; 2.5 to the right, agree=0.663, adj=0.043, (0 split)
      english.learner splits as  LR,      agree=0.661, adj=0.039, (0 split)
      grad.year.covid splits as  RL,      agree=0.658, adj=0.031, (0 split)

Node number 3: 14553 observations
  predicted class=No meaningful emp NE  expected loss=0.1494537  P(node) =0.9137314
    class counts:  2175 12378
   probabilities: 0.149 0.851 

Node number 4: 890 observations
  predicted class=Meaningful emp NE     expected loss=0.4202247  P(node) =0.05587995
    class counts:   516   374
   probabilities: 0.580 0.420 

Node number 5: 484 observations,    complexity param=0.005170631
  predicted class=No meaningful emp NE  expected loss=0.4338843  P(node) =0.03038865
    class counts:   210   274
   probabilities: 0.434 0.566 
  left son=10 (27 obs) right son=11 (457 obs)
  Primary splits:
      RaceEthnicity           splits as  RRRRLR,  improve=6.763489, (0 missing)
      grad.year.covid         splits as  LR,      improve=6.178141, (0 missing)
      MCA.M                   &lt; 1.5 to the right, improve=4.555672, (14 missing)
      range.school            splits as  RL,      improve=4.356021, (0 missing)
      total.cte.courses.taken &lt; 3.5 to the right, improve=2.538637, (0 missing)
  Surrogate splits:
      grad.year.covid splits as  LR, agree=0.95, adj=0.111, (0 split)

Node number 10: 27 observations
  predicted class=Meaningful emp NE     expected loss=0.2222222  P(node) =0.001695235
    class counts:    21     6
   probabilities: 0.778 0.222 

Node number 11: 457 observations
  predicted class=No meaningful emp NE  expected loss=0.4135667  P(node) =0.02869341
    class counts:   189   268
   probabilities: 0.414 0.586 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune, <span class="at">nn =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp NE grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.1 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0))

Variables actually used in tree construction:
[1] highest.cred.level ps.grad.location   RaceEthnicity     

Root node error: 2901/15927 = 0.18214

n= 15927 

         CP nsplit rel error  xerror     xstd
1 0.0268873      0   1.00000 1.00000 0.016791
2 0.0220614      1   0.97311 0.99862 0.016782
3 0.0051706      2   0.95105 0.95105 0.016463
4 0.0031024      3   0.94588 0.95209 0.016471</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp NE grad year 1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb278"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.1</span>)</span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.826278</code></pre>
</div>
</div>
<p><br></p>
<p>We now have a very simple tree, that might be a little too simple. Big piece, though, is that 91% of the individuals that did not graduate from college in the region did not have meaningful employment in Northeast.</p>
<ol type="1">
<li>ps.grad.location: in region | inside and outside region
<ul>
<li>No - 91% don’t have meaningful employment in region</li>
<li>Yes
<ul>
<li>highest.cred.level: Associate degree | Bachelor degree
<ul>
<li>Yes- more likely to have meaningful employment in region</li>
<li>No - less likely to have meaningful employment in region</li>
</ul></li>
</ul></li>
</ul></li>
</ol>
<p>It tells me the following;</p>
<ul>
<li>Most important
<ul>
<li>post-secondary pathways
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
</ul></li>
</ul></li>
<li>Barely important
<ul>
<li>Demographics
<ul>
<li>RaceEthnicity</li>
<li>SpecialEdStatus</li>
<li>english.learner</li>
<li>grad.year.covid</li>
</ul></li>
<li>A couple of post-secondary prep
<ul>
<li>took.ACT</li>
<li>MCA.R</li>
</ul></li>
</ul></li>
<li>Missing from base run
<ul>
<li>Demographics
<ul>
<li>economic.status</li>
</ul></li>
<li>Location of high school - ALL
<ul>
<li>range.school</li>
<li>Dem_Desc</li>
</ul></li>
<li>Nearly all of the Prep for post-secondary
<ul>
<li>pseo.participant</li>
<li>ACTCompositeScore</li>
<li>MCA.M</li>
<li>MCA.S</li>
</ul></li>
<li>CTE engagement - all
<ul>
<li>cte.achievement</li>
<li>total.cte.courses.taken</li>
</ul></li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb280"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
              409.7165793               275.7306040               199.0706306 
                  ps.grad             RaceEthnicity           SpecialEdStatus 
              129.2114194                 6.7634893                 1.5851381 
          grad.year.covid                  took.ACT                     MCA.R 
                1.1686404                 0.6674266                 0.5839983 
          english.learner 
                0.5283794 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">1.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb282-7"><a href="#cb282-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb282-8"><a href="#cb282-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb282-9"><a href="#cb282-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb282-10"><a href="#cb282-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb282-11"><a href="#cb282-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb282-12"><a href="#cb282-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance meaningful emp NE grad year 1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The post-pruned tree does get a bit better accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.8095796        0.8258386          0.826278</code></pre>
</div>
</div>
</section>
<section id="summary-9" class="level3">
<h3 class="anchored" data-anchor-id="summary-9">Summary</h3>
<p>The variable importance across the models do not vary much. The most consistent variables that were high in the importance values were;</p>
<ul>
<li>All of the post-secondary pathways
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
</ul></li>
<li>Demographics
<ul>
<li>SpecialEdStatus</li>
<li>english.learner</li>
<li>grad.year.covid</li>
</ul></li>
<li>post-secondary prep</li>
<li>Missing from base run
<ul>
<li>CTE stuff</li>
<li>Gender</li>
<li>RaceEthnicity</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="five-years-after-graduation-1" class="level2">
<h2 class="anchored" data-anchor-id="five-years-after-graduation-1">Five years after graduation</h2>
<p>Next we will look at the variables importance at five years after graduation. At this point we will bring back the post-secondary variables.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="base-model-10" class="level3">
<h3 class="anchored" data-anchor-id="base-model-10">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb285"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb285-2"><a href="#cb285-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-3"><a href="#cb285-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(meaningful.emp.ne.grad.year<span class="fl">.5</span>), <span class="fu">nrow</span>(meaningful.emp.ne.grad.year<span class="fl">.5</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb285-4"><a href="#cb285-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-5"><a href="#cb285-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year<span class="fl">.5</span>[sample_ind,]</span>
<span id="cb285-6"><a href="#cb285-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-7"><a href="#cb285-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year<span class="fl">.5</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The summary shows that the lowest cross-validated error is .99974 and the nsplit is 17.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp ne grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    cp = 0)

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] english.learner           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 3866/19682 = 0.19642

n= 19682 

           CP nsplit rel error  xerror     xstd
1  1.3795e-03      0   1.00000 1.00000 0.014417
2  1.0347e-03     12   0.98189 1.00207 0.014429
3  8.1911e-04     17   0.97672 0.99974 0.014416
4  6.4666e-04     28   0.96611 1.00776 0.014459
5  6.2080e-04     31   0.96405 1.01138 0.014479
6  5.1733e-04     37   0.95965 1.01138 0.014479
7  4.3111e-04     40   0.95810 1.01449 0.014496
8  4.0237e-04     51   0.95318 1.01526 0.014500
9  3.8800e-04     61   0.94904 1.01655 0.014507
10 3.4489e-04     82   0.94077 1.01862 0.014518
11 3.2333e-04     88   0.93870 1.02561 0.014555
12 3.0178e-04     94   0.93637 1.02768 0.014566
13 2.5867e-04    106   0.93223 1.04682 0.014666
14 2.2992e-04    143   0.92111 1.05070 0.014686
15 2.1555e-04    152   0.91904 1.05406 0.014704
16 2.0693e-04    166   0.91593 1.06027 0.014736
17 1.9400e-04    182   0.90973 1.06105 0.014740
18 1.8476e-04    195   0.90714 1.06932 0.014782
19 1.7244e-04    202   0.90585 1.07165 0.014794
20 1.5918e-04    215   0.90352 1.07501 0.014811
21 1.5520e-04    230   0.90093 1.07967 0.014834
22 1.4109e-04    240   0.89938 1.07967 0.014834
23 1.2933e-04    251   0.89783 1.09545 0.014913
24 1.0347e-04    281   0.89395 1.09959 0.014933
25 8.6222e-05    286   0.89343 1.11252 0.014996
26 7.7600e-05    319   0.89058 1.11666 0.015016
27 6.4666e-05    329   0.88981 1.12597 0.015061
28 5.7481e-05    333   0.88955 1.12649 0.015064
29 5.1733e-05    342   0.88903 1.13270 0.015093
30 4.7030e-05    347   0.88877 1.13399 0.015099
31 4.3111e-05    358   0.88826 1.13864 0.015121
32 3.6952e-05    370   0.88774 1.14123 0.015134
33 3.2333e-05    390   0.88696 1.14278 0.015141
34 2.5867e-05    398   0.88670 1.14304 0.015142
35 0.0000e+00    408   0.88645 1.14563 0.015154</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp ne grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p>Below are the values in variable important and there are a couple of themes;</p>
<ol type="1">
<li>Post-secondary pathway are significant</li>
<li>CTE engagement is significant</li>
<li>Post-secondary prep work is significant</li>
<li>School rurality and whether it’s on the range is important</li>
<li>Demographics are a bit lower</li>
</ol>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                238.01574                 195.31583                 147.72051 
  total.cte.courses.taken         ACTCompositeScore                   ps.grad 
                142.90866                 130.56454                  89.34645 
                    MCA.M           cte.achievement                  Dem_Desc 
                 79.51139                  79.37004                  66.86706 
                    MCA.R           economic.status                  took.ACT 
                 60.68153                  50.78932                  49.17332 
             range.school          pseo.participant                     MCA.S 
                 44.77667                  40.50150                  39.98983 
            RaceEthnicity           SpecialEdStatus           english.learner 
                 37.80572                  29.48465                  16.64308 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance meaningful emp ne grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7792793</code></pre>
</div>
</div>
</section>
<section id="pre-pruning-10" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-10">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 1,406</li>
<li>minbucket: round(minsplit / 3) - 469</li>
</ul>
<p>Using these parameters provided a tree with no decision splits. So, I made adjustments to get to the best accuracy I could find and ended up with the following;</p>
<ul>
<li>cp = 0</li>
<li>maxdepth = 6</li>
<li>minsplit = 150</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grow a tree with minsplit of 40 and max depth of 10</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.5</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">150</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp ne grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 150))

Variables actually used in tree construction:
[1] cte.achievement  Dem_Desc         MCA.M            MCA.R           
[5] ps.grad.location range.school    

Root node error: 3866/19682 = 0.19642

n= 19682 

          CP nsplit rel error  xerror     xstd
1 0.00159510      0   1.00000 1.00000 0.014417
2 0.00051733      6   0.99043 0.99327 0.014381
3 0.00000000      7   0.98991 0.99379 0.014383</code></pre>
</div>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp ne grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8079659</code></pre>
</div>
</div>
<p>The pre-pruning resulted in a significantly less complex tree with a .8079659 accuracy. Let’s see what variables are important in this model.</p>
<p>The primary nodes are;</p>
<ol type="1">
<li>ps.grad.location: in region | Inside and outside region
<ul>
<li>No: 84% chance with no meaningful employment in NE</li>
<li>Yes:
<ul>
<li>Non-range school</li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
<li>MCA.R</li>
<li>MCA.M</li>
</ul></li>
</ul></li>
</ol>
<p>One interesting node is that ther was a 50% probability that an individual would have meaningful employment in the region if their MCA - Math score was greater than 3. But that only covered 2% of population.</p>
<p>Primary variable themes are;</p>
<ul>
<li>Most important:
<ul>
<li>Post-secondary pathway
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
</ul></li>
<li>range.school &amp; Dem_Desc</li>
<li>CTE engagement</li>
</ul></li>
<li>Less important
<ul>
<li>Prep for post-secondary
<ul>
<li>MCA.M</li>
<li>MCA.R</li>
<li>took.ACT</li>
</ul></li>
</ul></li>
<li>Very low
<ul>
<li>SpecialEdStatus</li>
<li>EnglishLearner</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing from previous
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>pseo.participant</li>
<li>ACTCompositeScore</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
              208.0052050               128.7607645                83.0463415 
                  ps.grad                  Dem_Desc              range.school 
               50.2950265                43.8778614                11.1843358 
          cte.achievement                     MCA.M                     MCA.R 
               11.1533367                 5.2066387                 3.7240881 
  total.cte.courses.taken                  took.ACT           SpecialEdStatus 
                3.2050466                 0.5637762                 0.4825291 
          english.learner             RaceEthnicity 
                0.2171381                 0.1952229 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb301-8"><a href="#cb301-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb301-9"><a href="#cb301-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb301-10"><a href="#cb301-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb301-11"><a href="#cb301-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span> <span class="co"># smaller font if needed</span></span>
<span id="cb301-12"><a href="#cb301-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance meaningful emp ne grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="post-pruning-10" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-10">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. Next, we prune/cut the tree with the optimal CP value as the parameter as shown in below code.</p>
<p>We will start out by using the optimal method which is just choosing the cp value with the lowest xerror from the base model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb302-11"><a href="#cb302-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-12"><a href="#cb302-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb302-13"><a href="#cb302-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-14"><a href="#cb302-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb302-15"><a href="#cb302-15" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb302-16"><a href="#cb302-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-17"><a href="#cb302-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb302-18"><a href="#cb302-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    cp = 0)
  n= 19682 

            CP nsplit rel error    xerror       xstd
1 0.0013795482      0 1.0000000 1.0000000 0.01441726
2 0.0010346611     12 0.9818934 1.0020693 0.01442852
3 0.0008191067     17 0.9767201 0.9997413 0.01441585

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       35                        22                        16 
                  ps.grad                  Dem_Desc           cte.achievement 
                        9                         7                         2 
             range.school   total.cte.courses.taken           SpecialEdStatus 
                        2                         1                         1 
         pseo.participant                     MCA.S                     MCA.M 
                        1                         1                         1 
                    MCA.R 
                        1 

Node number 1: 19682 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.1964231  P(node) =1
    class counts:  3866 15816
   probabilities: 0.196 0.804 
  left son=2 (4541 obs) right son=3 (15141 obs)
  Primary splits:
      ps.grad.location          splits as  RLRLRR,   improve=208.00520, (5099 missing)
      ps.grad.InstitutionSector splits as  RLRRLR,   improve=139.93280, (5099 missing)
      highest.cred.level        splits as  LRLLR,    improve=103.46840, (5099 missing)
      ACTCompositeScore         &lt; 25.5 to the left,  improve= 41.38834, (8738 missing)
      ps.grad                   splits as  LRL,      improve= 38.69369, (0 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RLRRLR, agree=0.881, adj=0.619, (0 split)
      highest.cred.level        splits as  LRLRR,  agree=0.813, adj=0.399, (0 split)
      ps.grad                   splits as  -RL,    agree=0.764, adj=0.242, (4932 split)

Node number 2: 4541 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.3201938  P(node) =0.2307184
    class counts:  1454  3087
   probabilities: 0.320 0.680 
  left son=4 (3321 obs) right son=5 (1220 obs)
  Primary splits:
      range.school      splits as  LR,       improve=11.184340, (0 missing)
      Dem_Desc          splits as  RRL,      improve=10.119550, (0 missing)
      ACTCompositeScore &lt; 22.5 to the left,  improve= 9.460576, (1375 missing)
      ps.grad.location  splits as  -L-R--,   improve= 6.290685, (0 missing)
      cte.achievement   splits as  LLR,      improve= 5.989616, (0 missing)

Node number 3: 15141 observations
  predicted class=No meaningful emp NE  expected loss=0.1593026  P(node) =0.7692816
    class counts:  2412 12729
   probabilities: 0.159 0.841 

Node number 4: 3321 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.3414634  P(node) =0.1687329
    class counts:  1134  2187
   probabilities: 0.341 0.659 
  left son=8 (2211 obs) right son=9 (1110 obs)
  Primary splits:
      Dem_Desc                splits as  RRL,      improve=31.581360, (0 missing)
      cte.achievement         splits as  LRR,      improve= 7.224739, (0 missing)
      ACTCompositeScore       &lt; 22.5 to the left,  improve= 5.725447, (917 missing)
      ps.grad.location        splits as  -L-R--,   improve= 5.103429, (0 missing)
      total.cte.courses.taken &lt; 2.5  to the right, improve= 4.934736, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 9.5  to the left,  agree=0.668, adj=0.008, (0 split)
      RaceEthnicity           splits as  RLLLL,    agree=0.667, adj=0.004, (0 split)

Node number 5: 1220 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.2622951  P(node) =0.06198557
    class counts:   320   900
   probabilities: 0.262 0.738 
  left son=10 (92 obs) right son=11 (1128 obs)
  Primary splits:
      Dem_Desc           splits as  -LR,      improve=12.296500, (0 missing)
      pseo.participant   splits as  LR,       improve= 8.113080, (342 missing)
      ACTCompositeScore  &lt; 21.5 to the left,  improve= 4.758211, (458 missing)
      highest.cred.level splits as  RRLL-,    improve= 3.615573, (0 missing)
      cte.achievement    splits as  LLR,      improve= 2.505148, (0 missing)

Node number 8: 2211 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.3903211  P(node) =0.1123361
    class counts:   863  1348
   probabilities: 0.390 0.610 
  left son=16 (546 obs) right son=17 (1665 obs)
  Primary splits:
      cte.achievement           splits as  LRR,      improve=11.153340, (0 missing)
      ACTCompositeScore         &lt; 22.5 to the left,  improve= 6.924763, (556 missing)
      MCA.M                     &lt; 3.5  to the left,  improve= 5.953314, (30 missing)
      highest.cred.level        splits as  LRRL-,    improve= 5.885147, (0 missing)
      ps.grad.InstitutionSector splits as  RL-RL-,   improve= 4.104675, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 3.5  to the right, agree=0.813, adj=0.244, (0 split)

Node number 9: 1110 observations
  predicted class=No meaningful emp NE  expected loss=0.2441441  P(node) =0.05639671
    class counts:   271   839
   probabilities: 0.244 0.756 

Node number 10: 92 observations,    complexity param=0.001379548
  predicted class=Meaningful emp NE     expected loss=0.4891304  P(node) =0.004674322
    class counts:    47    45
   probabilities: 0.511 0.489 
  left son=20 (30 obs) right son=21 (62 obs)
  Primary splits:
      total.cte.courses.taken &lt; 2.5  to the right, improve=3.184712, (0 missing)
      cte.achievement         splits as  LLR,      improve=3.120578, (0 missing)
      ACTCompositeScore       &lt; 24.5 to the left,  improve=3.083317, (31 missing)
      pseo.participant        splits as  LR,       improve=2.931881, (26 missing)
      MCA.M                   &lt; 2.5  to the left,  improve=1.335250, (0 missing)
  Surrogate splits:
      cte.achievement    splits as  LRR,      agree=0.880, adj=0.633, (0 split)
      highest.cred.level splits as  RRLR-,    agree=0.783, adj=0.333, (0 split)
      took.ACT           splits as  LR,       agree=0.750, adj=0.233, (0 split)
      MCA.R              &lt; 2.5  to the left,  agree=0.739, adj=0.200, (0 split)
      MCA.M              &lt; 1.5  to the left,  agree=0.707, adj=0.100, (0 split)

Node number 11: 1128 observations
  predicted class=No meaningful emp NE  expected loss=0.2420213  P(node) =0.05731125
    class counts:   273   855
   probabilities: 0.242 0.758 

Node number 16: 546 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.478022  P(node) =0.02774108
    class counts:   261   285
   probabilities: 0.478 0.522 
  left son=32 (503 obs) right son=33 (43 obs)
  Primary splits:
      SpecialEdStatus    splits as  LR,       improve=6.740963, (0 missing)
      ACTCompositeScore  &lt; 13.5 to the right, improve=3.312646, (193 missing)
      MCA.R              &lt; 2.5  to the right, improve=2.364393, (3 missing)
      MCA.S              &lt; 1.5  to the right, improve=2.278220, (212 missing)
      highest.cred.level splits as  LRRL-,    improve=2.049233, (0 missing)
  Surrogate splits:
      english.learner splits as  LR, agree=0.929, adj=0.093, (0 split)

Node number 17: 1665 observations
  predicted class=No meaningful emp NE  expected loss=0.3615616  P(node) =0.08459506
    class counts:   602  1063
   probabilities: 0.362 0.638 

Node number 20: 30 observations
  predicted class=Meaningful emp NE     expected loss=0.3  P(node) =0.001524235
    class counts:    21     9
   probabilities: 0.700 0.300 

Node number 21: 62 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.4193548  P(node) =0.003150086
    class counts:    26    36
   probabilities: 0.419 0.581 
  left son=42 (30 obs) right son=43 (32 obs)
  Primary splits:
      pseo.participant          splits as  LR,       improve=3.6737420, (13 missing)
      ACTCompositeScore         &lt; 24.5 to the left,  improve=2.2500000, (12 missing)
      ps.grad.InstitutionSector splits as  RL-LR-,   improve=0.9410231, (0 missing)
      cte.achievement           splits as  RLR,      improve=0.8002151, (0 missing)
      total.cte.courses.taken   &lt; 0.5  to the right, improve=0.6641366, (0 missing)
  Surrogate splits:
      MCA.M                   &lt; 2.5  to the left,  agree=0.633, adj=0.217, (13 split)
      took.ACT                splits as  LR,       agree=0.612, adj=0.174, (0 split)
      MCA.R                   &lt; 3.5  to the left,  agree=0.612, adj=0.174, (0 split)
      total.cte.courses.taken &lt; 0.5  to the right, agree=0.612, adj=0.174, (0 split)
      cte.achievement         splits as  RLR,      agree=0.592, adj=0.130, (0 split)

Node number 32: 503 observations,    complexity param=0.001379548
  predicted class=Meaningful emp NE     expected loss=0.499006  P(node) =0.02555635
    class counts:   252   251
   probabilities: 0.501 0.499 
  left son=64 (218 obs) right son=65 (285 obs)
  Primary splits:
      MCA.M                     &lt; 2.5  to the left,  improve=2.919498, (9 missing)
      MCA.S                     &lt; 1.5  to the right, improve=2.657934, (197 missing)
      ps.grad.InstitutionSector splits as  RL-RL-,   improve=1.992801, (0 missing)
      highest.cred.level        splits as  LRLL-,    improve=1.922138, (0 missing)
      ACTCompositeScore         &lt; 29.5 to the right, improve=1.517939, (161 missing)
  Surrogate splits:
      MCA.R                   &lt; 3.5  to the left,  agree=0.757, adj=0.429, (8 split)
      took.ACT                splits as  LR,       agree=0.670, adj=0.224, (1 split)
      total.cte.courses.taken &lt; 2.5  to the left,  agree=0.601, adj=0.062, (0 split)
      RaceEthnicity           splits as  RRLLR,    agree=0.585, adj=0.024, (0 split)
      highest.cred.level      splits as  RRLR-,    agree=0.583, adj=0.019, (0 split)

Node number 33: 43 observations
  predicted class=No meaningful emp NE  expected loss=0.2093023  P(node) =0.002184737
    class counts:     9    34
   probabilities: 0.209 0.791 

Node number 42: 30 observations
  predicted class=Meaningful emp NE     expected loss=0.4  P(node) =0.001524235
    class counts:    18    12
   probabilities: 0.600 0.400 

Node number 43: 32 observations
  predicted class=No meaningful emp NE  expected loss=0.25  P(node) =0.001625851
    class counts:     8    24
   probabilities: 0.250 0.750 

Node number 64: 218 observations,    complexity param=0.001379548
  predicted class=Meaningful emp NE     expected loss=0.4266055  P(node) =0.01107611
    class counts:   125    93
   probabilities: 0.573 0.427 
  left son=128 (162 obs) right son=129 (56 obs)
  Primary splits:
      MCA.S             &lt; 1.5  to the right, improve=3.684586, (142 missing)
      ACTCompositeScore &lt; 21.5 to the right, improve=2.916751, (107 missing)
      ps.grad.location  splits as  -L-R--,   improve=2.616594, (0 missing)
      MCA.R             &lt; 2.5  to the right, improve=2.029805, (2 missing)
      pseo.participant  splits as  RL,       improve=1.958430, (174 missing)
  Surrogate splits:
      MCA.R         &lt; 2.5  to the right, agree=0.803, adj=0.25, (140 split)
      RaceEthnicity splits as  R-RLL,    agree=0.776, adj=0.15, (1 split)

Node number 65: 285 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.445614  P(node) =0.01448024
    class counts:   127   158
   probabilities: 0.446 0.554 
  left son=130 (19 obs) right son=131 (266 obs)
  Primary splits:
      ACTCompositeScore         &lt; 27.5 to the right, improve=2.705916, (54 missing)
      ps.grad.InstitutionSector splits as  RL-RL-,   improve=2.052715, (0 missing)
      total.cte.courses.taken   &lt; 7.5  to the right, improve=1.363819, (0 missing)
      highest.cred.level        splits as  RRLL-,    improve=1.169591, (0 missing)
      took.ACT                  splits as  LR,       improve=0.708215, (0 missing)
  Surrogate splits:
      RaceEthnicity      splits as  RR-LR, agree=0.922, adj=0.053, (54 split)
      highest.cred.level splits as  RRRL-, agree=0.922, adj=0.053, (0 split)

Node number 128: 162 observations
  predicted class=Meaningful emp NE     expected loss=0.382716  P(node) =0.008230871
    class counts:   100    62
   probabilities: 0.617 0.383 

Node number 129: 56 observations,    complexity param=0.001379548
  predicted class=No meaningful emp NE  expected loss=0.4464286  P(node) =0.002845239
    class counts:    25    31
   probabilities: 0.446 0.554 
  left son=258 (23 obs) right son=259 (33 obs)
  Primary splits:
      highest.cred.level        splits as  LRR--,    improve=3.304395, (0 missing)
      ps.grad.InstitutionSector splits as  -R-RL-,   improve=2.411432, (0 missing)
      ACTCompositeScore         &lt; 15.5 to the right, improve=0.400000, (36 missing)
      total.cte.courses.taken   &lt; 1.5  to the left,  improve=0.250000, (0 missing)
      took.ACT                  splits as  LR,       improve=0.134127, (0 missing)
  Surrogate splits:
      economic.status         splits as  RL,       agree=0.607, adj=0.043, (0 split)
      total.cte.courses.taken &lt; 3.5  to the left,  agree=0.607, adj=0.043, (0 split)

Node number 130: 19 observations
  predicted class=Meaningful emp NE     expected loss=0.3157895  P(node) =0.000965349
    class counts:    13     6
   probabilities: 0.684 0.316 

Node number 131: 266 observations,    complexity param=0.001034661
  predicted class=No meaningful emp NE  expected loss=0.4285714  P(node) =0.01351489
    class counts:   114   152
   probabilities: 0.429 0.571 
  left son=262 (186 obs) right son=263 (80 obs)
  Primary splits:
      ps.grad.InstitutionSector splits as  RL-RL-,   improve=2.454531, (0 missing)
      highest.cred.level        splits as  LRLL-,    improve=1.315490, (0 missing)
      total.cte.courses.taken   &lt; 7.5  to the right, improve=1.271080, (0 missing)
      ACTCompositeScore         &lt; 20.5 to the left,  improve=1.212519, (54 missing)
      took.ACT                  splits as  LR,       improve=1.096336, (0 missing)
  Surrogate splits:
      highest.cred.level      splits as  LRLR-,    agree=0.846, adj=0.487, (0 split)
      total.cte.courses.taken &lt; 1.5  to the right, agree=0.711, adj=0.037, (0 split)

Node number 258: 23 observations
  predicted class=Meaningful emp NE     expected loss=0.3478261  P(node) =0.00116858
    class counts:    15     8
   probabilities: 0.652 0.348 

Node number 259: 33 observations
  predicted class=No meaningful emp NE  expected loss=0.3030303  P(node) =0.001676659
    class counts:    10    23
   probabilities: 0.303 0.697 

Node number 262: 186 observations,    complexity param=0.001034661
  predicted class=No meaningful emp NE  expected loss=0.4731183  P(node) =0.009450259
    class counts:    88    98
   probabilities: 0.473 0.527 
  left son=524 (16 obs) right son=525 (170 obs)
  Primary splits:
      total.cte.courses.taken &lt; 7.5  to the right, improve=0.8076534, (0 missing)
      ACTCompositeScore       &lt; 20.5 to the left,  improve=0.6624972, (49 missing)
      pseo.participant        splits as  LR,       improve=0.5015480, (42 missing)
      highest.cred.level      splits as  RRL--,    improve=0.3207432, (0 missing)
      MCA.M                   &lt; 3.5  to the right, improve=0.2555232, (0 missing)

Node number 263: 80 observations
  predicted class=No meaningful emp NE  expected loss=0.325  P(node) =0.004064628
    class counts:    26    54
   probabilities: 0.325 0.675 

Node number 524: 16 observations
  predicted class=Meaningful emp NE     expected loss=0.375  P(node) =0.0008129255
    class counts:    10     6
   probabilities: 0.625 0.375 

Node number 525: 170 observations,    complexity param=0.001034661
  predicted class=No meaningful emp NE  expected loss=0.4588235  P(node) =0.008637334
    class counts:    78    92
   probabilities: 0.459 0.541 
  left son=1050 (70 obs) right son=1051 (100 obs)
  Primary splits:
      MCA.S                   &lt; 2.5  to the left,  improve=0.8022222, (20 missing)
      total.cte.courses.taken &lt; 5.5  to the left,  improve=0.7420430, (0 missing)
      ACTCompositeScore       &lt; 16.5 to the left,  improve=0.5569680, (44 missing)
      highest.cred.level      splits as  RLL--,    improve=0.4723573, (0 missing)
      pseo.participant        splits as  LR,       improve=0.2171199, (38 missing)
  Surrogate splits:
      MCA.R              &lt; 3.5  to the left,  agree=0.720, adj=0.300, (20 split)
      highest.cred.level splits as  RRL--,    agree=0.647, adj=0.117, (0 split)
      MCA.M              &lt; 3.5  to the left,  agree=0.647, adj=0.117, (0 split)
      RaceEthnicity      splits as  RL--R,    agree=0.613, adj=0.033, (0 split)
      english.learner    splits as  RL,       agree=0.607, adj=0.017, (0 split)

Node number 1050: 70 observations,    complexity param=0.001034661
  predicted class=Meaningful emp NE     expected loss=0.4857143  P(node) =0.003556549
    class counts:    36    34
   probabilities: 0.514 0.486 
  left son=2100 (42 obs) right son=2101 (28 obs)
  Primary splits:
      pseo.participant        splits as  RL,       improve=1.3077910, (16 missing)
      MCA.M                   &lt; 3.5  to the right, improve=1.1840630, (0 missing)
      highest.cred.level      splits as  LLR--,    improve=1.0028600, (0 missing)
      ACTCompositeScore       &lt; 21.5 to the right, improve=0.9832105, (22 missing)
      total.cte.courses.taken &lt; 3.5  to the right, improve=0.6857143, (0 missing)
  Surrogate splits:
      took.ACT                splits as  RL,       agree=0.667, adj=0.28, (16 split)
      total.cte.courses.taken &lt; 5.5  to the left,  agree=0.593, adj=0.12, (0 split)
      MCA.S                   &lt; 1.5  to the right, agree=0.574, adj=0.08, (0 split)
      RaceEthnicity           splits as  RL--L,    agree=0.556, adj=0.04, (0 split)
      english.learner         splits as  LR,       agree=0.556, adj=0.04, (0 split)

Node number 1051: 100 observations,    complexity param=0.001034661
  predicted class=No meaningful emp NE  expected loss=0.42  P(node) =0.005080784
    class counts:    42    58
   probabilities: 0.420 0.580 
  left son=2102 (20 obs) right son=2103 (80 obs)
  Primary splits:
      highest.cred.level      splits as  RRL--,    improve=2.6450000, (0 missing)
      pseo.participant        splits as  LR,       improve=2.3894330, (22 missing)
      ACTCompositeScore       &lt; 19.5 to the left,  improve=1.3675210, (22 missing)
      total.cte.courses.taken &lt; 5.5  to the left,  improve=0.8880217, (0 missing)
      took.ACT                splits as  LR,       improve=0.8878322, (0 missing)

Node number 2100: 42 observations
  predicted class=Meaningful emp NE     expected loss=0.3809524  P(node) =0.002133929
    class counts:    26    16
   probabilities: 0.619 0.381 

Node number 2101: 28 observations
  predicted class=No meaningful emp NE  expected loss=0.3571429  P(node) =0.00142262
    class counts:    10    18
   probabilities: 0.357 0.643 

Node number 2102: 20 observations
  predicted class=Meaningful emp NE     expected loss=0.35  P(node) =0.001016157
    class counts:    13     7
   probabilities: 0.650 0.350 

Node number 2103: 80 observations
  predicted class=No meaningful emp NE  expected loss=0.3625  P(node) =0.004064628
    class counts:    29    51
   probabilities: 0.363 0.638 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp ne grad year 5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.5 ~ ., data = train, method = "class", 
    cp = 0)

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  highest.cred.level       
 [5] MCA.M                     MCA.S                    
 [7] ps.grad.InstitutionSector ps.grad.location         
 [9] pseo.participant          range.school             
[11] SpecialEdStatus           total.cte.courses.taken  

Root node error: 3866/19682 = 0.19642

n= 19682 

          CP nsplit rel error  xerror     xstd
1 0.00137955      0   1.00000 1.00000 0.014417
2 0.00103466     12   0.98189 1.00207 0.014429
3 0.00081911     17   0.97672 0.99974 0.014416</code></pre>
</div>
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp ne grad year 5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.5</span>)</span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8064248</code></pre>
</div>
</div>
<p><br></p>
<p>When using the cp value with the lowest xerror, we end up with a slightly complex tree, but it’s the best we can get. The tree nodes provide the following</p>
<ul>
<li>ps.grad.location: In region | inside and outside region
<ul>
<li>No: 80% probability for no meaningful employment in region</li>
<li>Yes
<ul>
<li>Range school</li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
<li>cte.courses.taken</li>
<li>SpecialEdStatus</li>
<li>pseo.participant</li>
<li>MCA.M</li>
<li>MCA.S</li>
<li>ACTCompositeScore</li>
<li>highest.cred.level</li>
<li>ps.grad.institution.sector</li>
</ul></li>
</ul></li>
</ul>
<p>A few that indicate higher probability of having meaningful employment in the region;</p>
<ul>
<li>total.cte.courses.taken &gt;= 3</li>
<li>MCA.S &gt;= 3</li>
<li>MCA.M &lt; 3</li>
</ul>
<p>Here is the variabilities by importance</p>
<ul>
<li>Most important
<ul>
<li>post-secondary pathway
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
</ul></li>
<li>Dem_Desc</li>
<li>cte.achievement</li>
<li>range.school</li>
</ul></li>
<li>Less important
<ul>
<li>SpecialEdStatus</li>
<li>pseo.participant</li>
<li>MCA.S</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>demographics and prep for post-secondary</li>
</ul></li>
</ul>
<p>Missing variables</p>
<ul>
<li>grad.year.covid</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
              208.0052050               131.2152959                91.5455100 
                  ps.grad                  Dem_Desc           cte.achievement 
               50.2950265                43.8778614                13.6495050 
             range.school   total.cte.courses.taken           SpecialEdStatus 
               11.1843358                 8.1775611                 6.7409634 
         pseo.participant                     MCA.S                     MCA.M 
                4.9815330                 4.5914319                 4.1302019 
                    MCA.R         ACTCompositeScore                  took.ACT 
                3.6888811                 2.7059157                 2.4016042 
            RaceEthnicity           english.learner           economic.status 
                0.9574755                 0.6927484                 0.1436693 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">5.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb312-11"><a href="#cb312-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span>) <span class="co"># smaller font if needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance grad year +5 county-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The pre-pruned tree is the most accurate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.7792793        0.8079659         0.8064248</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="summary-10" class="level3">
<h3 class="anchored" data-anchor-id="summary-10">Summary</h3>
<p>The pre-pruned tree ended up being the most accurate.</p>
<ul>
<li>Most important:
<ul>
<li>Post-secondary pathway
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
</ul></li>
<li>range.school &amp; Dem_Desc</li>
<li>CTE engagement</li>
</ul></li>
<li>Less important
<ul>
<li>Prep for post-secondary
<ul>
<li>MCA.M</li>
<li>MCA.R</li>
<li>took.ACT</li>
</ul></li>
</ul></li>
<li>Very low
<ul>
<li>SpecialEdStatus</li>
<li>EnglishLearner</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing from previous
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>pseo.participant</li>
<li>ACTCompositeScore</li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
<section id="ten-years-after-graduation-2" class="level2">
<h2 class="anchored" data-anchor-id="ten-years-after-graduation-2">Ten years after graduation</h2>
<p>Next we will look at the variables importance at five years after graduation. At this point we will bring back the post-secondary variables.</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">grad.year.covid</td>
</tr>
<tr class="even">
<td style="text-align: left;">economic.status</td>
</tr>
<tr class="odd">
<td style="text-align: left;">range.school</td>
</tr>
<tr class="even">
<td style="text-align: left;">pseo.participant</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SpecialEdStatus</td>
</tr>
<tr class="even">
<td style="text-align: left;">RaceEthnicity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Dem_Desc</td>
</tr>
<tr class="even">
<td style="text-align: left;">took.ACT</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cte.achievement</td>
</tr>
<tr class="even">
<td style="text-align: left;">english.learner</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ps.grad</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.InstitutionSector</td>
</tr>
<tr class="odd">
<td style="text-align: left;">highest.cred.level</td>
</tr>
<tr class="even">
<td style="text-align: left;">ps.grad.location</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTCompositeScore</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.M</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MCA.R</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCA.S</td>
</tr>
<tr class="odd">
<td style="text-align: left;">total.cte.courses.taken</td>
</tr>
<tr class="even">
<td style="text-align: left;">grad.year.10</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<section id="base-model-11" class="level3">
<h3 class="anchored" data-anchor-id="base-model-11">Base model</h3>
<p>First we will split the data into two sets, Train and Test, in a 70:30 ratio. The Train set is used for training and creating the model. The Test set is considered to be a dummy production environment to test predictions and evaluate the accuracy of the model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>sample_ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(meaningful.emp.ne.grad.year<span class="fl">.10</span>), <span class="fu">nrow</span>(meaningful.emp.ne.grad.year<span class="fl">.10</span>) <span class="sc">*</span>.<span class="dv">7</span>)</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year<span class="fl">.10</span>[sample_ind,]</span>
<span id="cb315-6"><a href="#cb315-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-7"><a href="#cb315-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year<span class="fl">.10</span>[<span class="sc">-</span>sample_ind,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we create a decision tree model by calling the rpart function. Let’s first create a base model with default parameters and value. The CP (complexity parameter) is used to control tree growth. If the cost of adding a variable is higher then the value of CP, then tree growth stops.</p>
<p>The base model shows that the cp value with the lowest xerror is 1.0157 and has 3 nsplits.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp ne grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    cp = 0)

Variables actually used in tree construction:
 [1] ACTCompositeScore         cte.achievement          
 [3] Dem_Desc                  economic.status          
 [5] english.learner           highest.cred.level       
 [7] MCA.M                     MCA.R                    
 [9] MCA.S                     ps.grad                  
[11] ps.grad.InstitutionSector ps.grad.location         
[13] pseo.participant          RaceEthnicity            
[15] range.school              SpecialEdStatus          
[17] took.ACT                  total.cte.courses.taken  

Root node error: 2414/13817 = 0.17471

n= 13817 

           CP nsplit rel error xerror     xstd
1  9.6658e-04      0   1.00000 1.0000 0.018490
2  7.1014e-04      3   0.99710 1.0157 0.018604
3  6.4439e-04     12   0.98964 1.0220 0.018648
4  6.2138e-04     37   0.96479 1.0224 0.018651
5  5.5233e-04     41   0.96230 1.0220 0.018648
6  5.1781e-04     47   0.95899 1.0215 0.018645
7  4.1425e-04     54   0.95443 1.0199 0.018633
8  3.7659e-04     60   0.95195 1.0265 0.018681
9  3.1069e-04     76   0.94449 1.0385 0.018766
10 2.7617e-04     80   0.94325 1.0501 0.018847
11 2.4855e-04     83   0.94242 1.0510 0.018853
12 2.0713e-04     91   0.93993 1.0655 0.018953
13 1.7754e-04    125   0.93289 1.0729 0.019004
14 1.6570e-04    148   0.92502 1.0766 0.019029
15 1.3808e-04    167   0.92129 1.0862 0.019093
16 1.2428e-04    188   0.91839 1.0907 0.019124
17 1.0356e-04    203   0.91632 1.0969 0.019166
18 9.2056e-05    211   0.91549 1.0994 0.019182
19 8.2850e-05    220   0.91466 1.1036 0.019210
20 5.9179e-05    225   0.91425 1.1060 0.019226
21 5.1781e-05    232   0.91384 1.1127 0.019270
22 0.0000e+00    240   0.91342 1.1160 0.019291</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/decision tree plot meaningful emp ne grad year 10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The resulting model produced a VERY complex tree with too many nodes that it isn’t interpretable. However, examining the complexity parameters shows that I have an increasing cross-validated error which provides evidence of a decision tree with too much complexity.</p>
<p>Below are the values in variable important and it shows the following themes are important;</p>
<ul>
<li>Most important
<ul>
<li>Post-secondary pathway
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
<li>ps.grad</li>
</ul></li>
<li>CTE engagement
<ul>
<li>cte.courses.taken</li>
<li>cte.achievement</li>
</ul></li>
<li>Prep for post-secondary
<ul>
<li>ACTCompositeScore</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>MCA.S</li>
<li>took.ACT</li>
<li>pseo.participant</li>
</ul></li>
<li>High school location
<ul>
<li>Dem_Desc</li>
<li>range.school</li>
</ul></li>
</ul></li>
<li>Less important
<ul>
<li>Demographics
<ul>
<li>SpecialEdStatus</li>
<li>RaceEthnicity</li>
<li>economic.status</li>
<li>english.learner</li>
</ul></li>
</ul></li>
<li>Missing
<ul>
<li>grad.year.covid</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector   total.cte.courses.taken 
                95.669986                 90.300353                 89.028674 
       highest.cred.level         ACTCompositeScore                     MCA.M 
                76.012665                 75.021749                 58.005181 
                    MCA.R           cte.achievement              range.school 
                49.141629                 47.589675                 40.364727 
                 Dem_Desc                  took.ACT           SpecialEdStatus 
                29.427388                 27.443998                 24.274821 
                    MCA.S             RaceEthnicity          pseo.participant 
                22.697927                 19.237786                 15.143534 
                  ps.grad           economic.status           english.learner 
                13.980125                 13.427490                  9.807456 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>variable.importance</span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb319-4"><a href="#cb319-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb319-5"><a href="#cb319-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb319-6"><a href="#cb319-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb319-7"><a href="#cb319-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb319-8"><a href="#cb319-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb319-9"><a href="#cb319-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb319-10"><a href="#cb319-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb319-11"><a href="#cb319-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span>) <span class="co"># smaller font if needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/base model variable importance meaningful emp ne grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, the accuracy of the model is computed and stored in a variable base_accuracy so we can compare it to our pruned trees later.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>base_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>base_accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8096927</code></pre>
</div>
</div>
</section>
<section id="pre-pruning-11" class="level3">
<h3 class="anchored" data-anchor-id="pre-pruning-11">Pre-pruning</h3>
<p>Next, we need to prune. We can either pre-prune or post-prune. We will start with pre-pruning and use each method - max depth, min depth, and min bucket. It’s recommended that I start with the following parameters;</p>
<ul>
<li>maxdepth: 3 to 6</li>
<li>minsplit: 5% of n which is 987</li>
<li>minbucket: round(minsplit / 3) - 329</li>
</ul>
<p>That provided a tree with zero splits. So the following parameters were used;</p>
<ul>
<li>maxdepth = 6</li>
<li>minsplit = 80</li>
<li>minbucket = eliminated</li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb322"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grow a tree with minsplit of 40 and max depth of 10</span></span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.preprune <span class="ot">&lt;-</span> <span class="fu">rpart</span>(grad.year<span class="fl">.10</span> <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">method =</span> <span class="st">"class"</span>, </span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>, <span class="at">maxdepth =</span> <span class="dv">6</span>, <span class="at">minsplit =</span> <span class="dv">80</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp ne grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    control = rpart.control(cp = 0, maxdepth = 6, minsplit = 80))

Variables actually used in tree construction:
[1] Dem_Desc                ps.grad.location        total.cte.courses.taken

Root node error: 2414/13817 = 0.17471

n= 13817 

          CP nsplit rel error xerror     xstd
1 0.00096658      0    1.0000 1.0000 0.018490
2 0.00000000      3    0.9971 1.0062 0.018535</code></pre>
</div>
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.preprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning plot meaningful emp ne grad year 10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.preprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a>accuracy_preprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb327-6"><a href="#cb327-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb327-7"><a href="#cb327-7" aria-hidden="true" tabindex="-1"></a>accuracy_preprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8341776</code></pre>
</div>
</div>
<p><br></p>
<p>The pre-pruning resulted in a significantly less complex tree with a .8341776 accuracy. Let’s see what variables are important in this model.</p>
<ul>
<li>ps.grad.location: In region
<ul>
<li>No: 85% probability that the student will have meaningful employment in the region</li>
<li>Yes
<ul>
<li>Dem_Desc</li>
<li>total.cte.courses &gt;= 7</li>
</ul></li>
</ul></li>
</ul>
<p>Variable importance shows the following;</p>
<ul>
<li>Most important
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InsitutionSector</li>
<li>highest.cred.level</li>
<li>Dem_Desc</li>
<li>total.cte.courses.taken</li>
</ul></li>
<li>Variables that are missing
<ul>
<li>Demographics: All
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>SpecialEdStauts</li>
<li>RaceEthnicity</li>
<li>english.learner</li>
</ul></li>
<li>High school characteristics
<ul>
<li>range.school</li>
</ul></li>
<li>Prep for post-secondary: All
<ul>
<li>pseo.participant</li>
<li>took.ACT</li>
<li>ACTCompositeScore</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>MCA.S</li>
</ul></li>
<li>CTE Engagement
<ul>
<li>cte.achievement</li>
</ul></li>
<li>Post-secondary path
<ul>
<li>ps.grad</li>
</ul></li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb329"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                 74.82899                  36.26638                  30.70332 
                 Dem_Desc   total.cte.courses.taken 
                 13.40212                  11.53003 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb331"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.preprune<span class="sc">$</span>variable.importance</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-5"><a href="#cb331-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb331-6"><a href="#cb331-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb331-7"><a href="#cb331-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb331-8"><a href="#cb331-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb331-9"><a href="#cb331-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb331-10"><a href="#cb331-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb331-11"><a href="#cb331-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span>) <span class="co"># smaller font if needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/pre pruning variable importance meaningful emp ne grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
</section>
<section id="post-pruning-11" class="level3">
<h3 class="anchored" data-anchor-id="post-pruning-11">Post-pruning</h3>
<p>Next, let’s try postpruning. The idea here is to allow the decision tree to grow fully and observe the CP value. Next, we prune/cut the tree with the optimal CP value as the parameter as shown in below code.</p>
<p>We will start out by using the optimal method which is just choosing the cp value with the lowest xerror from the base model.</p>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>cp_table <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable</span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>min_xerror <span class="ot">&lt;-</span> <span class="fu">min</span>(cp_table[, <span class="st">"xerror"</span>])</span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>min_xerror_se <span class="ot">&lt;-</span> cp_table[<span class="fu">which.min</span>(cp_table[,<span class="st">"xerror"</span>]), <span class="st">"xstd"</span>]</span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> min_xerror <span class="sc">+</span> min_xerror_se</span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a>one_se_index <span class="ot">&lt;-</span> <span class="fu">which</span>(cp_table[, <span class="st">"xerror"</span>] <span class="sc">&lt;=</span> threshold)[<span class="dv">1</span>] </span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-10"><a href="#cb332-10" aria-hidden="true" tabindex="-1"></a>cp_1se <span class="ot">&lt;-</span> cp_table[one_se_index, <span class="st">"CP"</span>]</span>
<span id="cb332-11"><a href="#cb332-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-12"><a href="#cb332-12" aria-hidden="true" tabindex="-1"></a>optimal_cp <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">10.</span>model<span class="sc">$</span>cptable[<span class="fu">which.min</span>(meaningful.emp.ne.grad.year.<span class="fl">5.</span>model<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb332-13"><a href="#cb332-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-14"><a href="#cb332-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Prune the hr_base_model based on the optimal cp value</span></span>
<span id="cb332-15"><a href="#cb332-15" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune <span class="ot">&lt;-</span> <span class="fu">prune</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model, <span class="at">cp =</span> optimal_cp)</span>
<span id="cb332-16"><a href="#cb332-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-17"><a href="#cb332-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Summary</span></span>
<span id="cb332-18"><a href="#cb332-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    cp = 0)
  n= 13817 

            CP nsplit rel error   xerror       xstd
1 0.0009665838      0 1.0000000 1.000000 0.01848988
2 0.0007101432      3 0.9971002 1.015742 0.01860376
3 0.0006443892     12 0.9896437 1.021955 0.01864826

Variable importance
         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                       34                        17                        15 
  total.cte.courses.taken                  Dem_Desc              range.school 
                        7                         6                         5 
                    MCA.M         ACTCompositeScore           SpecialEdStatus 
                        4                         4                         3 
                    MCA.R                  took.ACT          pseo.participant 
                        2                         1                         1 
          cte.achievement 
                        1 

Node number 1: 13817 observations,    complexity param=0.0009665838
  predicted class=No meaningful emp NE  expected loss=0.1747123  P(node) =1
    class counts:  2414 11403
   probabilities: 0.175 0.825 
  left son=2 (3161 obs) right son=3 (10656 obs)
  Primary splits:
      ps.grad.location          splits as  RLRRRR,   improve=74.82899, (3523 missing)
      ps.grad.InstitutionSector splits as  RLRRLR,   improve=47.47255, (3523 missing)
      highest.cred.level        splits as  LRLRR,    improve=36.52843, (3523 missing)
      Dem_Desc                  splits as  RRL,      improve=29.91859, (0 missing)
      ACTCompositeScore         &lt; 25.5 to the left,  improve=16.40332, (6508 missing)
  Surrogate splits:
      ps.grad.InstitutionSector splits as  RRRRLR, agree=0.842, adj=0.485, (0 split)
      highest.cred.level        splits as  LRLRR,  agree=0.819, adj=0.410, (0 split)

Node number 2: 3161 observations,    complexity param=0.0009665838
  predicted class=No meaningful emp NE  expected loss=0.2654223  P(node) =0.2287761
    class counts:   839  2322
   probabilities: 0.265 0.735 
  left son=4 (2399 obs) right son=5 (762 obs)
  Primary splits:
      Dem_Desc                  splits as  RRL,      improve=13.402120, (0 missing)
      ACTCompositeScore         &lt; 22.5 to the left,  improve= 4.701445, (1165 missing)
      ps.grad.InstitutionSector splits as  RL-LL-,   improve= 4.688029, (0 missing)
      total.cte.courses.taken   &lt; 6.5  to the right, improve= 2.935598, (0 missing)
      economic.status           splits as  LR,       improve= 2.838957, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 13.5 to the left,  agree=0.759, adj=0.001, (0 split)

Node number 3: 10656 observations
  predicted class=No meaningful emp NE  expected loss=0.1478041  P(node) =0.7712239
    class counts:  1575  9081
   probabilities: 0.148 0.852 

Node number 4: 2399 observations,    complexity param=0.0007101432
  predicted class=No meaningful emp NE  expected loss=0.2913714  P(node) =0.1736267
    class counts:   699  1700
   probabilities: 0.291 0.709 
  left son=8 (1588 obs) right son=9 (811 obs)
  Primary splits:
      range.school              splits as  LR,       improve=10.985600, (0 missing)
      ACTCompositeScore         &lt; 22.5 to the left,  improve= 5.700316, (848 missing)
      ps.grad.InstitutionSector splits as  RL-LL-,   improve= 3.611701, (0 missing)
      SpecialEdStatus           splits as  LR,       improve= 2.401535, (0 missing)
      economic.status           splits as  LR,       improve= 1.921290, (0 missing)
  Surrogate splits:
      total.cte.courses.taken &lt; 8.5  to the left,  agree=0.664, adj=0.006, (0 split)

Node number 5: 762 observations,    complexity param=0.0009665838
  predicted class=No meaningful emp NE  expected loss=0.183727  P(node) =0.05514945
    class counts:   140   622
   probabilities: 0.184 0.816 
  left son=10 (29 obs) right son=11 (733 obs)
  Primary splits:
      total.cte.courses.taken   &lt; 6.5  to the right, improve=11.512440, (0 missing)
      range.school              splits as  RL,       improve= 5.832547, (0 missing)
      ps.grad.InstitutionSector splits as  RL-LL-,   improve= 2.867758, (0 missing)
      highest.cred.level        splits as  LRLL-,    improve= 2.484231, (0 missing)
      MCA.R                     &lt; 1.5  to the left,  improve= 1.498508, (13 missing)

Node number 8: 1588 observations
  predicted class=No meaningful emp NE  expected loss=0.3255668  P(node) =0.1149309
    class counts:   517  1071
   probabilities: 0.326 0.674 

Node number 9: 811 observations,    complexity param=0.0007101432
  predicted class=No meaningful emp NE  expected loss=0.2244143  P(node) =0.05869581
    class counts:   182   629
   probabilities: 0.224 0.776 
  left son=18 (515 obs) right son=19 (296 obs)
  Primary splits:
      ACTCompositeScore         &lt; 22.5 to the left,  improve=4.014482, (381 missing)
      MCA.M                     &lt; 1.5  to the right, improve=3.043449, (5 missing)
      ps.grad.InstitutionSector splits as  RR-RL-,   improve=2.171842, (0 missing)
      highest.cred.level        splits as  LRLR-,    improve=2.171842, (0 missing)
      economic.status           splits as  LR,       improve=1.880955, (0 missing)
  Surrogate splits:
      MCA.R                     &lt; 3.5  to the left,  agree=0.728, adj=0.339, (373 split)
      MCA.M                     &lt; 3.5  to the left,  agree=0.707, adj=0.288, (4 split)
      ps.grad.InstitutionSector splits as  RR-RL-,   agree=0.681, adj=0.226, (4 split)
      highest.cred.level        splits as  LRLR-,    agree=0.681, adj=0.226, (0 split)
      total.cte.courses.taken   &lt; 7.5  to the left,  agree=0.595, adj=0.017, (0 split)

Node number 10: 29 observations
  predicted class=Meaningful emp NE     expected loss=0.3793103  P(node) =0.002098864
    class counts:    18    11
   probabilities: 0.621 0.379 

Node number 11: 733 observations
  predicted class=No meaningful emp NE  expected loss=0.1664393  P(node) =0.05305059
    class counts:   122   611
   probabilities: 0.166 0.834 

Node number 18: 515 observations,    complexity param=0.0007101432
  predicted class=No meaningful emp NE  expected loss=0.2543689  P(node) =0.03727292
    class counts:   131   384
   probabilities: 0.254 0.746 
  left son=36 (341 obs) right son=37 (174 obs)
  Primary splits:
      MCA.M                   &lt; 1.5  to the right, improve=6.841946, (4 missing)
      total.cte.courses.taken &lt; 0.5  to the left,  improve=2.939602, (0 missing)
      economic.status         splits as  LR,       improve=2.286624, (0 missing)
      ACTCompositeScore       &lt; 21.5 to the right, improve=1.796135, (262 missing)
      cte.achievement         splits as  RRL,      improve=1.286650, (0 missing)
  Surrogate splits:
      MCA.R           &lt; 2.5  to the right, agree=0.720, adj=0.169, (1 split)
      SpecialEdStatus splits as  LR,       agree=0.693, adj=0.087, (3 split)
      english.learner splits as  LR,       agree=0.671, adj=0.023, (0 split)
      RaceEthnicity   splits as  LRRL-L,   agree=0.669, adj=0.017, (0 split)

Node number 19: 296 observations
  predicted class=No meaningful emp NE  expected loss=0.1722973  P(node) =0.02142288
    class counts:    51   245
   probabilities: 0.172 0.828 

Node number 36: 341 observations,    complexity param=0.0007101432
  predicted class=No meaningful emp NE  expected loss=0.313783  P(node) =0.02467974
    class counts:   107   234
   probabilities: 0.314 0.686 
  left son=72 (81 obs) right son=73 (260 obs)
  Primary splits:
      total.cte.courses.taken &lt; 0.5  to the left,  improve=2.9742770, (0 missing)
      cte.achievement         splits as  LRL,      improve=1.0544140, (0 missing)
      ACTCompositeScore       &lt; 21.5 to the right, improve=0.9156397, (149 missing)
      SpecialEdStatus         splits as  RL,       improve=0.8798516, (0 missing)
      economic.status         splits as  LR,       improve=0.6217805, (0 missing)
  Surrogate splits:
      cte.achievement splits as  RRL, agree=0.853, adj=0.383, (0 split)

Node number 37: 174 observations
  predicted class=No meaningful emp NE  expected loss=0.137931  P(node) =0.01259318
    class counts:    24   150
   probabilities: 0.138 0.862 

Node number 72: 81 observations,    complexity param=0.0007101432
  predicted class=No meaningful emp NE  expected loss=0.4320988  P(node) =0.005862343
    class counts:    35    46
   probabilities: 0.432 0.568 
  left son=144 (54 obs) right son=145 (27 obs)
  Primary splits:
      took.ACT           splits as  RL,       improve=2.4197530, (0 missing)
      ACTCompositeScore  &lt; 18.5 to the right, improve=1.5220620, (27 missing)
      MCA.M              &lt; 2.5  to the right, improve=1.4204550, (1 missing)
      MCA.S              &lt; 1.5  to the right, improve=1.2764490, (15 missing)
      highest.cred.level splits as  RLRR-,    improve=0.8188759, (0 missing)
  Surrogate splits:
      highest.cred.level splits as  LLRL-, agree=0.765, adj=0.296, (0 split)
      SpecialEdStatus    splits as  LR,    agree=0.691, adj=0.074, (0 split)
      cte.achievement    splits as  R-L,   agree=0.679, adj=0.037, (0 split)

Node number 73: 260 observations,    complexity param=0.0007101432
  predicted class=No meaningful emp NE  expected loss=0.2769231  P(node) =0.0188174
    class counts:    72   188
   probabilities: 0.277 0.723 
  left son=146 (11 obs) right son=147 (249 obs)
  Primary splits:
      SpecialEdStatus           splits as  RL,       improve=4.659039, (0 missing)
      total.cte.courses.taken   &lt; 7.5  to the left,  improve=1.929529, (0 missing)
      highest.cred.level        splits as  RRLR-,    improve=1.239262, (0 missing)
      ps.grad.InstitutionSector splits as  RL-RL-,   improve=1.188889, (0 missing)
      cte.achievement           splits as  LRR,      improve=1.007863, (0 missing)
  Surrogate splits:
      english.learner splits as  RL, agree=0.962, adj=0.091, (0 split)

Node number 144: 54 observations,    complexity param=0.0007101432
  predicted class=Meaningful emp NE     expected loss=0.4814815  P(node) =0.003908229
    class counts:    28    26
   probabilities: 0.519 0.481 
  left son=288 (41 obs) right son=289 (13 obs)
  Primary splits:
      ACTCompositeScore         &lt; 18.5 to the right, improve=1.5220620, (0 missing)
      MCA.M                     &lt; 2.5  to the right, improve=1.2967640, (0 missing)
      highest.cred.level        splits as  RLLR-,    improve=0.8962963, (0 missing)
      MCA.R                     &lt; 2.5  to the left,  improve=0.6164584, (0 missing)
      ps.grad.InstitutionSector splits as  RR-LR-,   improve=0.2129630, (0 missing)
  Surrogate splits:
      RaceEthnicity splits as  R----L,   agree=0.778, adj=0.077, (0 split)
      MCA.R         &lt; 2.5  to the right, agree=0.778, adj=0.077, (0 split)

Node number 145: 27 observations
  predicted class=No meaningful emp NE  expected loss=0.2592593  P(node) =0.001954114
    class counts:     7    20
   probabilities: 0.259 0.741 

Node number 146: 11 observations
  predicted class=Meaningful emp NE     expected loss=0.2727273  P(node) =0.0007961207
    class counts:     8     3
   probabilities: 0.727 0.273 

Node number 147: 249 observations
  predicted class=No meaningful emp NE  expected loss=0.2570281  P(node) =0.01802128
    class counts:    64   185
   probabilities: 0.257 0.743 

Node number 288: 41 observations,    complexity param=0.0007101432
  predicted class=Meaningful emp NE     expected loss=0.4146341  P(node) =0.002967359
    class counts:    24    17
   probabilities: 0.585 0.415 
  left son=576 (18 obs) right son=577 (23 obs)
  Primary splits:
      ACTCompositeScore         &lt; 20.5 to the left,  improve=2.3758690, (0 missing)
      MCA.R                     &lt; 3.5  to the left,  improve=1.6249270, (0 missing)
      highest.cred.level        splits as  RLLR-,    improve=0.3824390, (0 missing)
      pseo.participant          splits as  LR,       improve=0.1969882, (14 missing)
      ps.grad.InstitutionSector splits as  RR-RL-,   improve=0.1512429, (0 missing)
  Surrogate splits:
      MCA.R                     &lt; 3.5  to the left,  agree=0.683, adj=0.278, (0 split)
      ps.grad.InstitutionSector splits as  RR-RL-,   agree=0.634, adj=0.167, (0 split)
      highest.cred.level        splits as  LRRR-,    agree=0.634, adj=0.167, (0 split)
      MCA.M                     &lt; 2.5  to the left,  agree=0.634, adj=0.167, (0 split)
      SpecialEdStatus           splits as  RL,       agree=0.585, adj=0.056, (0 split)

Node number 289: 13 observations
  predicted class=No meaningful emp NE  expected loss=0.3076923  P(node) =0.0009408699
    class counts:     4     9
   probabilities: 0.308 0.692 

Node number 576: 18 observations
  predicted class=Meaningful emp NE     expected loss=0.2222222  P(node) =0.001302743
    class counts:    14     4
   probabilities: 0.778 0.222 

Node number 577: 23 observations,    complexity param=0.0007101432
  predicted class=No meaningful emp NE  expected loss=0.4347826  P(node) =0.001664616
    class counts:    10    13
   probabilities: 0.435 0.565 
  left son=1154 (9 obs) right son=1155 (14 obs)
  Primary splits:
      pseo.participant          splits as  LR,       improve=2.0000000000, (7 missing)
      ACTCompositeScore         &lt; 21.5 to the right, improve=1.3360940000, (0 missing)
      highest.cred.level        splits as  RLLR-,    improve=0.4472050000, (0 missing)
      ps.grad.InstitutionSector splits as  LR-RL-,   improve=0.3043478000, (0 missing)
      MCA.R                     &lt; 3.5  to the right, improve=0.0007763975, (0 missing)
  Surrogate splits:
      highest.cred.level        splits as  RRL--,    agree=0.625, adj=0.250, (6 split)
      economic.status           splits as  RL,       agree=0.562, adj=0.125, (1 split)
      ps.grad.InstitutionSector splits as  LR-RR-,   agree=0.562, adj=0.125, (0 split)
      MCA.S                     &lt; 2.5  to the right, agree=0.562, adj=0.125, (0 split)

Node number 1154: 9 observations
  predicted class=Meaningful emp NE     expected loss=0.3333333  P(node) =0.0006513715
    class counts:     6     3
   probabilities: 0.667 0.333 

Node number 1155: 14 observations
  predicted class=No meaningful emp NE  expected loss=0.2857143  P(node) =0.001013245
    class counts:     4    10
   probabilities: 0.286 0.714 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot tree</span></span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp ne grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the complexity plot</span></span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="fu">printcp</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Classification tree:
rpart(formula = grad.year.10 ~ ., data = train, method = "class", 
    cp = 0)

Variables actually used in tree construction:
[1] ACTCompositeScore       Dem_Desc                MCA.M                  
[4] ps.grad.location        pseo.participant        range.school           
[7] SpecialEdStatus         took.ACT                total.cte.courses.taken

Root node error: 2414/13817 = 0.17471

n= 13817 

          CP nsplit rel error xerror     xstd
1 0.00096658      0   1.00000 1.0000 0.018490
2 0.00071014      3   0.99710 1.0157 0.018604
3 0.00064439     12   0.98964 1.0220 0.018648</code></pre>
</div>
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotcp</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/postpruning meaningful emp ne grad year 10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the accuracy of the pruned tree</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune, test, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>accuracy_postprun <span class="ot">&lt;-</span> <span class="fu">mean</span>(test<span class="sc">$</span>pred <span class="sc">==</span> test<span class="sc">$</span>grad.year<span class="fl">.10</span>)</span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>accuracy_postprun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8336711</code></pre>
</div>
</div>
<p><br></p>
<p>The accuracy is still a bit lower than pre-pruning - .8336711</p>
<p>We end up with a bit more of a complicated tree. Here are the important paths</p>
<ul>
<li>ps.grad.location: In region
<ul>
<li>No: 83% probability individual has no meaningful employment in region</li>
<li>Yes
<ul>
<li>Dem_Desc</li>
<li>range.school</li>
<li>total.cte.courses.taken</li>
<li>ACTCompositeScore</li>
<li>MCA.M</li>
<li>took.ACT</li>
<li>SpecialEdStatus</li>
<li>pseo.participant</li>
</ul></li>
</ul></li>
</ul>
<p>Importance of variables are;</p>
<ul>
<li>Most important
<ul>
<li>Post-secondary pathway
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InstitutionSector</li>
<li>highest.cred.level</li>
</ul></li>
<li>total.cte.courses.taken</li>
<li>Dem_Desc</li>
<li>range.school</li>
</ul></li>
<li>Less important
<ul>
<li>Prep for post-secondary
<ul>
<li>MCA.M</li>
<li>ACTCompositeScore</li>
<li>MCA.R</li>
<li>took.ACT</li>
</ul></li>
</ul></li>
<li>Not important
<ul>
<li>english.learner</li>
<li>pseo.participant</li>
<li>cte.achievement</li>
<li>economic.status</li>
<li>MCA.S</li>
<li>RaceEthnicity</li>
</ul></li>
<li>Missing data
<ul>
<li>grad.year.covid</li>
<li>ps.grad</li>
</ul></li>
</ul>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         ps.grad.location ps.grad.InstitutionSector        highest.cred.level 
                74.828991                 37.819581                 33.223492 
  total.cte.courses.taken                  Dem_Desc              range.school 
                14.640080                 13.402116                 10.985603 
                    MCA.M         ACTCompositeScore           SpecialEdStatus 
                 8.394639                  7.912413                  5.566954 
                    MCA.R                  took.ACT          pseo.participant 
                 3.291470                  2.419753                  2.000000 
          cte.achievement           english.learner           economic.status 
                 1.227924                  0.582664                  0.250000 
                    MCA.S             RaceEthnicity 
                 0.250000                  0.236418 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> meaningful.emp.ne.grad.year.<span class="fl">10.</span>model.postprune<span class="sc">$</span>variable.importance</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>importance <span class="ot">&lt;-</span> <span class="fu">sort</span>(importance, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(importance,</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Variable Importance"</span>,</span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Variables"</span>,</span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Importance"</span>,</span>
<span id="cb342-9"><a href="#cb342-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb342-10"><a href="#cb342-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>,        <span class="co"># make axis labels vertical</span></span>
<span id="cb342-11"><a href="#cb342-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.8</span>) <span class="co"># smaller font if needed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="analysis_local_employment_CART_files/figure-html/post pruning variable importance meaningful emp ne grad year 10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Now let’s compare the accuracy. The prepruned tree/model looks to be the best.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb343"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(base_accuracy, accuracy_preprun, accuracy_postprun)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  base_accuracy accuracy_preprun accuracy_postprun
1     0.8096927        0.8341776         0.8336711</code></pre>
</div>
</div>
</section>
<section id="summary-11" class="level3">
<h3 class="anchored" data-anchor-id="summary-11">Summary</h3>
<p>Overall, the variables that were the most consistently important throughout the analysis were the following;</p>
<p>The pre-pruning resulted in a significantly less complex tree with a .8341776 accuracy. Let’s see what variables are important in this model.</p>
<p>Variable importance shows the following;</p>
<ul>
<li>Most important
<ul>
<li>Nearly all of the post-secondary paths
<ul>
<li>ps.grad.location</li>
<li>ps.grad.InsitutionSector</li>
<li>highest.cred.level</li>
</ul></li>
<li>One high school characteristics
<ul>
<li>Dem_Desc</li>
</ul></li>
<li>One CTE engagement
<ul>
<li>total.cte.courses.taken</li>
</ul></li>
</ul></li>
<li>Variables that are missing
<ul>
<li>Demographics: All
<ul>
<li>grad.year.covid</li>
<li>economic.status</li>
<li>SpecialEdStauts</li>
<li>RaceEthnicity</li>
<li>english.learner</li>
</ul></li>
<li>High school characteristics
<ul>
<li>range.school</li>
</ul></li>
<li>Prep for post-secondary: All
<ul>
<li>pseo.participant</li>
<li>took.ACT</li>
<li>ACTCompositeScore</li>
<li>MCA.M</li>
<li>MCA.R</li>
<li>MCA.S</li>
</ul></li>
<li>CTE Engagement
<ul>
<li>cte.achievement</li>
</ul></li>
<li>Post-secondary path
<ul>
<li>ps.grad</li>
</ul></li>
</ul></li>
</ul>
<p><br></p>
</section>
</section>
</section>
<section id="summary-across-time" class="level1">
<h1>Summary across time</h1>
<section id="one-year-after-graduating-high-school" class="level2">
<h2 class="anchored" data-anchor-id="one-year-after-graduating-high-school">One year after graduating high school</h2>
<p>Every single variable related to pathways after high school were very important in whether someone had meaningful employment in the region. Somewhat important were nearly all of the demographic variables, a couple of variables for post-secondary prep.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 28%">
<col style="width: 18%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Variable group</th>
<th>Most important</th>
<th>Maybe important</th>
<th>Missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Post-secondary pathways</td>
<td><p>ps.grad.location,</p>
<p>ps.grad.InstitutionSector,</p>
<p>highest.cred.level,</p>
<p>ps.grad</p></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Demographics</td>
<td></td>
<td><p>RaceEthnicity,</p>
<p>SpecialEdStatus,</p>
<p>english.learner,</p>
<p>grad.year.covid</p></td>
<td>economic.status</td>
</tr>
<tr class="odd">
<td>Prep for post-secondary</td>
<td></td>
<td><p>took.ACT,</p>
<p>MCA.R</p></td>
<td><p>pseo.participant,</p>
<p>ACTCompositeScore,</p>
<p>MCA.M,</p>
<p>MCA.S</p></td>
</tr>
<tr class="even">
<td>Location of high school</td>
<td></td>
<td></td>
<td><p>Dem_Desc,</p>
<p>range.school</p></td>
</tr>
<tr class="odd">
<td>CTE Engagement</td>
<td></td>
<td></td>
<td><p>cte.achievement,</p>
<p>total.cte.courses.taken</p></td>
</tr>
</tbody>
</table>
<p><br></p>
</section>
<section id="five-year-after-graduating-high-school" class="level2">
<h2 class="anchored" data-anchor-id="five-year-after-graduating-high-school">Five year after graduating high school</h2>
<p>Every single variable related to pathways after high school were very important in whether someone had meaningful employment in the region. In addition, the rurality of an individual’s high school and whether they were located on the range moved up to being very important.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 28%">
<col style="width: 18%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Variable group</th>
<th>Most important</th>
<th>Maybe important</th>
<th>Missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Post-secondary pathways</td>
<td><p>ps.grad.location,</p>
<p>ps.grad.InstitutionSector,</p>
<p>highest.cred.level,</p>
<p>ps.grad</p></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>Demographics</td>
<td></td>
<td><p>RaceEthnicity,</p>
<p>SpecialEdStatus,</p>
<p>english.learner</p></td>
<td><p>economic.status,</p>
<p>grad.year.covid</p></td>
</tr>
<tr class="odd">
<td>Prep for post-secondary</td>
<td></td>
<td><p>took.ACT,</p>
<p>MCA.R,</p>
<p>MCA.M</p></td>
<td><p>pseo.participant,</p>
<p>ACTCompositeScore,</p>
<p>MCA.S</p></td>
</tr>
<tr class="even">
<td>Location of high school</td>
<td><p>Dem_Desc,</p>
<p>range.school</p></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>CTE Engagement</td>
<td></td>
<td></td>
<td><p>cte.achievement,</p>
<p>total.cte.courses.taken</p></td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>